!function(t,e){"function"==typeof define&&define.amd?define("p5.sound",["p5"],function(t){e(t)}):e("object"==typeof exports?require("../p5"):t.p5)}(this,function(c){var r,n,o,s,t,e,a,h,d,u,i,p,l,f,m,y,v,_,g,T,b,x,S,w,A,P,k,O,F,q,M,E,V,R,C,D,N,B,U,I,G,L,j,Z,X,Y,z,W,Q,H,$,J,K,tt,et,it,nt,ot,st,rt,at,ut,ct,ht,pt,lt,dt,ft;function mt(t){return"running"===t.state}function yt(t,e,i){if(t.input)Array.isArray(t.input)?(n.prototype.isUndef(i)&&(i=0),this.connect(t.input[i])):this.connect(t.input,e,i);else try{t instanceof AudioNode?o.call(this,t,e,i):o.call(this,t,e)}catch(e){throw new Error("error connecting to node: "+t+"\n"+e)}}function vt(){for(var t=F.audiocontext,e=t.createBuffer(1,2048,t.sampleRate),i=e.getChannelData(0),n=0;n<2048;n++)i[n]=1;return(t=t.createBufferSource()).buffer=e,t.loop=!0,t}function _t(t,e){D.call(this,"peaking"),this.disconnect(),this.set(t,e),this.biquad.gain.value=0,delete this.input,delete this.output,delete this._drywet,delete this.wet}function gt(t){for(var e,i="number"==typeof t?t:50,n=new Float32Array(44100),o=Math.PI/180,s=0;s<44100;++s)n[s]=(3+i)*(e=2*s/44100-1)*20*o/(Math.PI+i*Math.abs(e));return n}function Tt(t,e,i,n,o){var s,r=t.oscillator;for(s in t.mathOps)t.mathOps[s]instanceof o&&(r.disconnect(),t.mathOps[s].dispose(),i=s,i<t.mathOps.length-2&&(n=t.mathOps[s+1]));return i===t.mathOps.length-1&&t.mathOps.push(n),(r=0<s?t.mathOps[s-1]:r).disconnect(),r.connect(e),e.connect(n),t.mathOps[i]=e,t}(function(){function i(t){t&&(t.setTargetAtTime||(t.setTargetAtTime=t.setTargetValueAtTime))}window,window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=window.webkitAudioContext,"function"!=typeof AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),"function"!=typeof AudioContext.prototype.createDelay&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),"function"!=typeof AudioContext.prototype.createScriptProcessor&&(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode),"function"!=typeof AudioContext.prototype.createPeriodicWave&&(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var t=this.internal_createGain();return i(t.gain),t},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=function(t){return i((t=t?this.internal_createDelay(t):this.internal_createDelay()).delayTime),t},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var n=this.internal_createBufferSource();return n.start?(n.internal_start=n.start,n.start=function(t,e,i){void 0!==i?n.internal_start(t||0,e,i):n.internal_start(t||0,e||0)}):n.start=function(t,e,i){e||i?this.noteGrainOn(t||0,e,i):this.noteOn(t||0)},n.stop?(n.internal_stop=n.stop,n.stop=function(t){n.internal_stop(t||0)}):n.stop=function(t){this.noteOff(t||0)},i(n.playbackRate),n},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=function(){var t=this.internal_createDynamicsCompressor();return i(t.threshold),i(t.knee),i(t.ratio),i(t.reduction),i(t.attack),i(t.release),t},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var t=this.internal_createBiquadFilter();return i(t.frequency),i(t.detune),i(t.Q),i(t.gain),t},"function"!=typeof AudioContext.prototype.createOscillator&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,AudioContext.prototype.createOscillator=function(){var e=this.internal_createOscillator();return e.start?(e.internal_start=e.start,e.start=function(t){e.internal_start(t||0)}):e.start=function(t){this.noteOn(t||0)},e.stop?(e.internal_stop=e.stop,e.stop=function(t){e.internal_stop(t||0)}):e.stop=function(t){this.noteOff(t||0)},e.setPeriodicWave||(e.setPeriodicWave=e.setWaveTable),i(e.frequency),i(e.detune),e})),window.hasOwnProperty("webkitOfflineAudioContext")&&!window.hasOwnProperty("OfflineAudioContext")&&(window.OfflineAudioContext=window.webkitOfflineAudioContext),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var e=document.createElement("audio");c.prototype.isSupported=function(){return!!e.canPlayType},c.prototype.isFileSupported=function(t){switch(t.toLowerCase()){case"mp3":return!!e.canPlayType&&e.canPlayType("audio/mpeg;");case"wav":return!!e.canPlayType&&e.canPlayType('audio/wav; codecs="1"');case"ogg":return!!e.canPlayType&&e.canPlayType('audio/ogg; codecs="vorbis"');case"aac":case"m4a":case"mp4":return!!e.canPlayType&&(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;"));case"aif":case"aiff":return!!e.canPlayType&&e.canPlayType("audio/x-aiff;");default:return!1}}})(),(r=function(t,e){this._dragged=!1,this._element=t,this._bindedMove=this._moved.bind(this),this._bindedEnd=this._ended.bind(this,e),t.addEventListener("touchstart",this._bindedEnd),t.addEventListener("touchmove",this._bindedMove),t.addEventListener("touchend",this._bindedEnd),t.addEventListener("mouseup",this._bindedEnd)}).prototype._moved=function(t){this._dragged=!0},r.prototype._ended=function(t){var e,i;this._dragged||(i=(e=t).createBuffer(1,1,e.sampleRate),(t=e.createBufferSource()).buffer=i,t.connect(e.destination),t.start(0),e.resume&&e.resume()),this._dragged=!1},r.prototype.dispose=function(){this._element.removeEventListener("touchstart",this._bindedEnd),this._element.removeEventListener("touchmove",this._bindedMove),this._element.removeEventListener("touchend",this._bindedEnd),this._element.removeEventListener("mouseup",this._bindedEnd),this._bindedMove=null,this._bindedEnd=null,this._element=null},R=function(n,t,e){var i=new Promise(function(t){var e,i=t;(mt(e=n)?i:function t(){mt(e)?i():(requestAnimationFrame(t),e.resume&&e.resume())})()}),o=[];return function t(e,i,n){var o;if(Array.isArray(e)||NodeList&&e instanceof NodeList)for(var s=0;s<e.length;s++)t(e[s],i,n);else"string"==typeof e?t(document.querySelectorAll(e),i,n):e.jquery&&"function"==typeof e.toArray?t(e.toArray(),i,n):Element&&e instanceof Element&&(o=new r(e,n),i.push(o))}(t=t||document.body,o,n),i.then(function(){for(var t=0;t<o.length;t++)o[t].dispose();o=null,e&&e()}),i},function(r){"use strict";r.Emitter=function(){this._events={}},r.extend(r.Emitter),r.Emitter.prototype.on=function(t,e){for(var i=t.split(/\W+/),n=0;n<i.length;n++){var o=i[n];this._events.hasOwnProperty(o)||(this._events[o]=[]),this._events[o].push(e)}return this},r.Emitter.prototype.off=function(t,e){for(var i=t.split(/\W+/),n=0;n<i.length;n++)if(t=i[n],this._events.hasOwnProperty(t))if(r.prototype.isUndef(e))this._events[t]=[];else for(var o=this._events[t],s=0;s<o.length;s++)o[s]===e&&o.splice(s,1);return this},r.Emitter.prototype.emit=function(t){if(this._events){var e=Array.apply(null,arguments).slice(1);if(this._events.hasOwnProperty(t))for(var i=this._events[t],n=0,o=i.length;n<o;n++)i[n].apply(this,e)}return this},r.Emitter.mixin=function(t){var e=["on","off","emit"];t._events={};for(var i=0;i<e.length;i++){var n=e[i],o=r.Emitter.prototype[n];t[n]=o}},r.Emitter.prototype.dispose=function(){return r.prototype.dispose.call(this),this._events=null,this},r.Emitter}(it=function(){"use strict";function h(t,e){this.isUndef(t)||1===t?this.input=this.context.createGain():1<t&&(this.input=new Array(t)),this.isUndef(e)||1===e?this.output=this.context.createGain():1<e&&(this.output=new Array(t))}var e;return h.prototype.set=function(t,e,i){var n;this.isObject(t)?i=e:this.isString(t)&&((n={})[t]=e,t=n);t:for(var o in t){e=t[o];var s=this;if(-1!==o.indexOf(".")){for(var r=o.split("."),a=0;a<r.length-1;a++)if((s=s[r[a]])instanceof h){r.splice(0,a+1);var u=r.join(".");s.set(u,e);continue t}o=r[r.length-1]}var c=s[o];this.isUndef(c)||(h.Signal&&c instanceof h.Signal||h.Param&&c instanceof h.Param?c.value!==e&&(this.isUndef(i)?c.value=e:c.rampTo(e,i)):c instanceof AudioParam?c.value!==e&&(c.value=e):c instanceof h?c.set(e):c!==e&&(s[o]=e))}return this},h.prototype.get=function(t){this.isUndef(t)?t=this._collectDefaults(this.constructor):this.isString(t)&&(t=[t]);for(var e={},i=0;i<t.length;i++){var n=t[i],o=this,s=e;if(-1!==n.indexOf(".")){for(var r=n.split("."),a=0;a<r.length-1;a++){var u=r[a];s[u]=s[u]||{},s=s[u],o=o[u]}n=r[r.length-1]}var c=o[n];this.isObject(t[n])?s[n]=c.get():h.Signal&&c instanceof h.Signal||h.Param&&c instanceof h.Param||c instanceof AudioParam?s[n]=c.value:c instanceof h?s[n]=c.get():this.isFunction(c)||this.isUndef(c)||(s[n]=c)}return e},h.prototype._collectDefaults=function(t){var e=[];if(this.isUndef(t.defaults)||(e=Object.keys(t.defaults)),!this.isUndef(t._super))for(var i=this._collectDefaults(t._super),n=0;n<i.length;n++)-1===e.indexOf(i[n])&&e.push(i[n]);return e},h.prototype.toString=function(){for(var t in h){var e=t[0].match(/^[A-Z]$/),i=h[t]===this.constructor;if(this.isFunction(h[t])&&e&&i)return t}return"Tone"},Object.defineProperty(h.prototype,"numberOfInputs",{get:function(){return this.input?this.isArray(this.input)?this.input.length:1:0}}),Object.defineProperty(h.prototype,"numberOfOutputs",{get:function(){return this.output?this.isArray(this.output)?this.output.length:1:0}}),h.prototype.dispose=function(){return this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this},h.prototype.connect=function(t,e,i){return Array.isArray(this.output)?(e=this.defaultArg(e,0),this.output[e].connect(t,0,i)):this.output.connect(t,e,i),this},h.prototype.disconnect=function(t,e,i){this.isArray(this.output)?this.isNumber(t)?this.output[t].disconnect():(e=this.defaultArg(e,0),this.output[e].disconnect(t,0,i)):this.output.disconnect.apply(this.output,arguments)},h.prototype.connectSeries=function(){if(1<arguments.length)for(var t=arguments[0],e=1;e<arguments.length;e++){var i=arguments[e];t.connect(i),t=i}return this},h.prototype.chain=function(){if(0<arguments.length)for(var t=this,e=0;e<arguments.length;e++){var i=arguments[e];t.connect(i),t=i}return this},h.prototype.fan=function(){if(0<arguments.length)for(var t=0;t<arguments.length;t++)this.connect(arguments[t]);return this},AudioNode.prototype.chain=h.prototype.chain,AudioNode.prototype.fan=h.prototype.fan,h.prototype.defaultArg=function(t,e){if(this.isObject(t)&&this.isObject(e)){var i,n,o={};for(i in t)o[i]=this.defaultArg(e[i],t[i]);for(n in e)o[n]=this.defaultArg(t[n],e[n]);return o}return this.isUndef(t)?e:t},h.prototype.optionsObject=function(t,e,i){var n={};if(1===t.length&&this.isObject(t[0]))n=t[0];else for(var o=0;o<e.length;o++)n[e[o]]=t[o];return this.isUndef(i)?n:this.defaultArg(n,i)},h.prototype.isUndef=function(t){return void 0===t},h.prototype.isFunction=function(t){return"function"==typeof t},h.prototype.isNumber=function(t){return"number"==typeof t},h.prototype.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object},h.prototype.isBoolean=function(t){return"boolean"==typeof t},h.prototype.isArray=function(t){return Array.isArray(t)},h.prototype.isString=function(t){return"string"==typeof t},h.noOp=function(){},h.prototype._readOnly=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this._readOnly(t[e]);else Object.defineProperty(this,t,{writable:!1,enumerable:!0})},h.prototype._writable=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this._writable(t[e]);else Object.defineProperty(this,t,{writable:!0})},h.State={Started:"started",Stopped:"stopped",Paused:"paused"},h.prototype.equalPowerScale=function(t){var e=.5*Math.PI;return Math.sin(t*e)},h.prototype.dbToGain=function(t){return Math.pow(2,t/6)},h.prototype.gainToDb=function(t){return Math.log(t)/Math.LN10*20},h.prototype.intervalToFrequencyRatio=function(t){return Math.pow(2,t/12)},h.prototype.now=function(){return h.context.now()},h.now=function(){return h.context.now()},h.extend=function(t,e){function i(){}h.prototype.isUndef(e)&&(e=h),i.prototype=e.prototype,t.prototype=new i,(t.prototype.constructor=t)._super=e},Object.defineProperty(h,"context",{get:function(){return e},set:function(t){e=h.Context&&t instanceof h.Context?t:new h.Context(t),h.Context&&h.Context.emit("init",e)}}),Object.defineProperty(h.prototype,"context",{get:function(){return h.context}}),h.setContext=function(t){h.context=t},Object.defineProperty(h.prototype,"blockTime",{get:function(){return 128/this.context.sampleRate}}),Object.defineProperty(h.prototype,"sampleTime",{get:function(){return 1/this.context.sampleRate}}),Object.defineProperty(h,"supported",{get:function(){var t=window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"),e=window.hasOwnProperty("Promise"),i=window.hasOwnProperty("Worker");return t&&e&&i}}),h.version="r10",window.TONE_SILENCE_VERSION_LOGGING,h}()),n=it,!window.hasOwnProperty("AudioContext")&&window.hasOwnProperty("webkitAudioContext")&&(window.AudioContext=window.webkitAudioContext),n.Context=function(t){for(var e in n.Emitter.call(this),t=t||new window.AudioContext,this._context=t,this._context)this._defineProperty(this._context,e);this._latencyHint="interactive",this._lookAhead=.1,this._updateInterval=this._lookAhead/3,this._computedUpdateInterval=0,this._worker=this._createWorker(),this._constants={}},n.extend(n.Context,n.Emitter),n.Emitter.mixin(n.Context),n.Context.prototype._defineProperty=function(e,i){this.isUndef(this[i])&&Object.defineProperty(this,i,{get:function(){return"function"==typeof e[i]?e[i].bind(e):e[i]},set:function(t){e[i]=t}})},n.Context.prototype.now=function(){return this._context.currentTime},n.Context.prototype._createWorker=function(){window.URL=window.URL||window.webkitURL;var t=new Blob(["var timeoutTime = "+(1e3*this._updateInterval).toFixed(1)+";self.onmessage = function(msg){\ttimeoutTime = parseInt(msg.data);};function tick(){\tsetTimeout(tick, timeoutTime);\tself.postMessage('tick');}tick();"]),t=URL.createObjectURL(t);return(t=new Worker(t)).addEventListener("message",function(){this.emit("tick")}.bind(this)),t.addEventListener("message",function(){var t,e=this.now();this.isNumber(this._lastUpdate)&&(t=e-this._lastUpdate,this._computedUpdateInterval=Math.max(t,.97*this._computedUpdateInterval)),this._lastUpdate=e}.bind(this)),t},n.Context.prototype.getConstant=function(t){if(this._constants[t])return this._constants[t];for(var e=this._context.createBuffer(1,128,this._context.sampleRate),i=e.getChannelData(0),n=0;n<i.length;n++)i[n]=t;var o=this._context.createBufferSource();return o.channelCount=1,o.channelCountMode="explicit",o.buffer=e,o.loop=!0,o.start(0),this._constants[t]=o},Object.defineProperty(n.Context.prototype,"lag",{get:function(){var t=this._computedUpdateInterval-this._updateInterval;return Math.max(t,0)}}),Object.defineProperty(n.Context.prototype,"lookAhead",{get:function(){return this._lookAhead},set:function(t){this._lookAhead=t}}),Object.defineProperty(n.Context.prototype,"updateInterval",{get:function(){return this._updateInterval},set:function(t){this._updateInterval=Math.max(t,n.prototype.blockTime),this._worker.postMessage(Math.max(1e3*t,1))}}),Object.defineProperty(n.Context.prototype,"latencyHint",{get:function(){return this._latencyHint},set:function(t){var e=t;if(this._latencyHint=t,this.isString(t))switch(t){case"interactive":e=.1,this._context.latencyHint=t;break;case"playback":e=.8,this._context.latencyHint=t;break;case"balanced":e=.25,this._context.latencyHint=t;break;case"fastest":e=.01}this.lookAhead=e,this.updateInterval=e/3}}),n.supported?(o=AudioNode.prototype.connect,s=AudioNode.prototype.disconnect,AudioNode.prototype.connect!==yt&&(AudioNode.prototype.connect=yt,AudioNode.prototype.disconnect=function(t,e,i){if(t&&t.input&&Array.isArray(t.input))n.prototype.isUndef(i)&&(i=0),this.disconnect(t.input[i],e,i);else if(t&&t.input)this.disconnect(t.input,e,i);else try{s.apply(this,arguments)}catch(e){throw new Error("error disconnecting node: "+t+"\n"+e)}}),n.context=new n.Context):console.warn("This browser does not support Tone.js"),n.Context,S=function(n,t){const o=new window.AudioContext;return t.context.dispose(),t.setContext(o),c.prototype.getAudioContext=function(){return o},c.prototype.userStartAudio=function(t,e){var i=t;return t instanceof c.Element?i=t.elt:t instanceof Array&&t[0]instanceof c.Element&&(i=t.map(function(t){return t.elt})),n(o,i,e)},o}(R,it),e=S,a=new function(){this.input=e.createGain(),this.output=e.createGain(),this.limiter=e.createDynamicsCompressor(),this.limiter.threshold.value=-3,this.limiter.ratio.value=20,this.limiter.knee.value=1,this.audiocontext=e,this.output.disconnect(),this.input.connect(this.limiter),this.limiter.connect(this.output),this.meter=e.createGain(),this.fftMeter=e.createGain(),this.output.connect(this.meter),this.output.connect(this.fftMeter),this.output.connect(this.audiocontext.destination),this.soundArray=[],this.parts=[],this.extensions=[]},c.prototype.getMasterVolume=function(){return a.output.gain.value},c.prototype.masterVolume=function(t,e,i){if("number"==typeof t){var e=e||0,i=i||0,n=a.audiocontext.currentTime,o=a.output.gain.value;a.output.gain.cancelScheduledValues(n+i),a.output.gain.linearRampToValueAtTime(o,n+i),a.output.gain.linearRampToValueAtTime(t,n+i+e)}else{if(!t)return a.output.gain;t.connect(a.output.gain)}},c.prototype.soundOut=c.soundOut=a,c.soundOut._silentNode=a.audiocontext.createGain(),c.soundOut._silentNode.gain.value=0,c.soundOut._silentNode.connect(a.audiocontext.destination),t=a,h=function(){function a(t,e,i){for(var n=i.length,o=0;o<n;o++)t.setUint8(e+o,i.charCodeAt(o))}var u=t;c.prototype.sampleRate=function(){return u.audiocontext.sampleRate},c.prototype.freqToMidi=function(t){return t=Math.log(t/440)/Math.log(2),Math.round(12*t)+69};var i=c.prototype.midiToFreq=function(t){return 440*Math.pow(2,(t-69)/12)};return c.prototype.soundFormats=function(){u.extensions=[];for(var t=0;t<arguments.length;t++){if(arguments[t]=arguments[t].toLowerCase(),!(-1<["mp3","wav","ogg","m4a","aac"].indexOf(arguments[t])))throw arguments[t]+" is not a valid sound format!";u.extensions.push(arguments[t])}},c.prototype.disposeSound=function(){for(var t=0;t<u.soundArray.length;t++)u.soundArray[t].dispose()},c.prototype.registerMethod("remove",c.prototype.disposeSound),c.prototype._checkFileFormats=function(t){if("string"==typeof t){var e,i=(e=t).split(".").pop();if(-1<["mp3","wav","ogg","m4a","aac"].indexOf(i)){if(!c.prototype.isFileSupported(i))for(var n=e.split("."),o=n[n.length-1],s=0;s<u.extensions.length;s++){var r=u.extensions[s];if(c.prototype.isFileSupported(r)){for(o="",2===n.length&&(o+=n[0]),s=1;s<=n.length-2;s++)o+="."+n[s];e=o+=".",e+=r;break}}}else for(s=0;s<u.extensions.length;s++)if(r=u.extensions[s],c.prototype.isFileSupported(r)){e=e+"."+r;break}}else if("object"==typeof t)for(s=0;s<t.length;s++)if(r=t[s].split(".").pop(),c.prototype.isFileSupported(r)){e=t[s];break}return e},c.prototype._mathChain=function(t,e,i,n,o){for(var s in t.mathOps)t.mathOps[s]instanceof o&&(t.mathOps[s].dispose(),i=s,i<t.mathOps.length-1&&(n=t.mathOps[s+1]));return t.mathOps[i-1].disconnect(),t.mathOps[i-1].connect(e),e.connect(n),t.mathOps[i]=e,t},{convertToWav:function(t){var e=function(t,e){for(var i=t.length+e.length,n=new Float32Array(i),o=0,s=0;s<i;)n[s++]=t[o],n[s++]=e[o],o++;return n}(i=t.getChannelData(0),1<t.numberOfChannels?t.getChannelData(1):i),i=new window.ArrayBuffer(44+2*e.length),n=new window.DataView(i);a(n,0,"RIFF"),n.setUint32(4,36+2*e.length,!0),a(n,8,"WAVE"),a(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,2,!0),n.setUint32(24,u.audiocontext.sampleRate,!0),n.setUint32(28,4*u.audiocontext.sampleRate,!0),n.setUint16(32,4,!0),n.setUint16(34,16,!0),a(n,36,"data"),n.setUint32(40,2*e.length,!0);for(var o=e.length,s=44,r=0;r<o;r++)n.setInt16(s,32767*e[r],!0),s+=2;return n},midiToFreq:i,noteToFreq:function(t){if("string"!=typeof t)return t;var e={A:21,B:23,C:24,D:26,E:28,F:29,G:31}[t[0].toUpperCase()];switch(e+=12*(~~t.slice(-1)-1),t[1]){case"#":e+=1;break;case"b":--e}return i(e)}}}(),d=function(t,e,i){var n=new Error;return n.name=t,n.originalStack=n.stack+e,e=n.stack+e,n.failedPath=i,e=(e=e.split("\n")).filter(function(t){return!t.match(/(p5.|native code|globalInit)/g)}),n.stack=e.join("\n"),n},void 0!==(u=t.audiocontext).createStereoPanner?(c.Panner=function(t,e){this.stereoPanner=this.input=u.createStereoPanner(),t.connect(this.stereoPanner),this.stereoPanner.connect(e)},c.Panner.prototype.pan=function(t,e){e=u.currentTime+(e||0),this.stereoPanner.pan.linearRampToValueAtTime(t,e)},c.Panner.prototype.inputChannels=function(){},c.Panner.prototype.connect=function(t){this.stereoPanner.connect(t)},c.Panner.prototype.disconnect=function(){this.stereoPanner&&this.stereoPanner.disconnect()}):(c.Panner=function(t,e,i){this.input=u.createGain(),t.connect(this.input),this.left=u.createGain(),this.right=u.createGain(),this.left.channelInterpretation="discrete",this.right.channelInterpretation="discrete",1<i?(this.splitter=u.createChannelSplitter(2),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0)):(this.input.connect(this.left),this.input.connect(this.right)),this.output=u.createChannelMerger(2),this.left.connect(this.output,0,1),this.right.connect(this.output,0,0),this.output.connect(e)},c.Panner.prototype.pan=function(t,e){var i=u.currentTime+(e||0),e=(t+1)/2,t=Math.cos(e*Math.PI/2),e=Math.sin(e*Math.PI/2);this.left.gain.linearRampToValueAtTime(e,i),this.right.gain.linearRampToValueAtTime(t,i)},c.Panner.prototype.inputChannels=function(t){1===t?(this.input.disconnect(),this.input.connect(this.left),this.input.connect(this.right)):2===t&&(this.splitter=u.createChannelSplitter(2),this.input.disconnect(),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0))},c.Panner.prototype.connect=function(t){this.output.connect(t)},c.Panner.prototype.disconnect=function(){this.output&&this.output.disconnect()}),function(){function p(t){if(isFinite(t)&&0!==t){for(;t<90;)t*=2;for(;180<t&&90<t;)t/=2;return t}}var a=d,r=t,u=r.audiocontext,e=h.midiToFreq,i=h.convertToWav;function o(t,e,i,n){this.callback=t,this.time=e,this.id=i,this.val=n}c.SoundFile=function(t,e,i,n){if(void 0!==t){if("string"==typeof t||"string"==typeof t[0]){var o=c.prototype._checkFileFormats(t);this.url=o}else if("object"==typeof t&&!(window.File&&window.FileReader&&window.FileList&&window.Blob))throw"Unable to load file because the File API is not supported";t.file&&(t=t.file),this.file=t}this._onended=function(){},this._looping=!1,this._playing=!1,this._paused=!1,this._pauseTime=0,this._cues=[],this._cueIDCounter=0,this._lastPos=0,this._counterNode=null,this._scopeNode=null,this.bufferSourceNodes=[],this.bufferSourceNode=null,this.buffer=null,this.playbackRate=1,this.input=r.audiocontext.createGain(),this.output=r.audiocontext.createGain(),this.reversed=!1,this.startTime=0,this.endTime=null,this.pauseTime=0,this.mode="sustain",this.startMillis=null,this.panPosition=0,this.panner=new c.Panner(this.output,r.input,2),(this.url||this.file)&&this.load(e,i),r.soundArray.push(this),this._whileLoading="function"==typeof n?n:function(){},this._onAudioProcess=function(t){t=t.inputBuffer.getChannelData(0),this._lastPos=t[t.length-1]||0,this._onTimeUpdate(self._lastPos)}.bind(this),this._clearOnEnd=function(t){const e=t.target,i=this;e._playing=!1,e.removeEventListener("ended",i._clearOnEnd),i._onended(i),i.bufferSourceNodes.forEach(function(t,e){!1===t._playing&&i.bufferSourceNodes.splice(e)}),0===i.bufferSourceNodes.length&&(i._playing=!1)}.bind(this)},c.prototype.registerPreloadMethod("loadSound",c.prototype),c.prototype.loadSound=function(t,e,i,n){-1<window.location.origin.indexOf("file://")&&"undefined"===window.cordova&&window.alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var o=this;return new c.SoundFile(t,function(){"function"==typeof e&&e.apply(o,arguments),"function"==typeof o._decrementPreload&&o._decrementPreload()},i,n)},c.SoundFile.prototype.load=function(i,n){var o,t,s=this,r=(new Error).stack;void 0!==this.url&&""!==this.url?((o=new XMLHttpRequest).addEventListener("progress",function(t){s._updateProgress(t)},!1),o.open("GET",this.url,!0),o.responseType="arraybuffer",o.onload=function(){var t,e;200===o.status?s.panner&&u.decodeAudioData(o.response,function(t){s.panner&&(s.buffer=t,s.panner.inputChannels(t.numberOfChannels),i&&i(s))},function(){var t,e;s.panner&&(t=new a("decodeAudioData",r,s.url),e="AudioContext error at decodeAudioData for "+s.url,n?(t.msg=e,n(t)):console.error(e+"\n The error stack trace includes: \n"+t.stack))}):s.panner&&(t=new a("loadSound",r,s.url),e="Unable to load "+s.url+". The request status was: "+o.status+" ("+o.statusText+")",n?(t.message=e,n(t)):console.error(e+"\n The error stack trace includes: \n"+t.stack))},o.onerror=function(){var t=new a("loadSound",r,s.url),e="There was no response from the server at "+s.url+". Check the url and internet connectivity.";n?(t.message=e,n(t)):console.error(e+"\n The error stack trace includes: \n"+t.stack)},o.send()):void 0!==this.file&&((t=new FileReader).onload=function(){s.panner&&u.decodeAudioData(t.result,function(t){s.panner&&(s.buffer=t,s.panner.inputChannels(t.numberOfChannels),i&&i(s))})},t.onerror=function(t){s.panner&&onerror&&onerror(t)},t.readAsArrayBuffer(this.file))},c.SoundFile.prototype._updateProgress=function(t){var e;t.lengthComputable?(e=t.loaded/t.total*.99,this._whileLoading(e,t)):this._whileLoading("size unknown")},c.SoundFile.prototype.isLoaded=function(){return!!this.buffer},c.SoundFile.prototype.play=function(t,e,i,n,o){if(this.output){var s;if((t=t||0)<0&&(t=0),t+=r.audiocontext.currentTime,void 0!==e&&this.rate(e),void 0!==i&&this.setVolume(i),!this.buffer)throw"not ready to play file, buffer has yet to load. Try preload()";if(this._pauseTime=0,"restart"===this.mode&&this.buffer&&this.bufferSourceNode&&(this.bufferSourceNode.stop(t),this._counterNode.stop(t)),"untildone"!==this.mode||!this.isPlaying()){if(this.bufferSourceNode=this._initSourceNode(),delete this._counterNode,this._counterNode=this._initCounterNode(),n){if(!(0<=n&&n<this.buffer.duration))throw"start time out of range";s=n}else s=0;o=o&&(o<=this.buffer.duration-s?o:this.buffer.duration),this._paused?(this.bufferSourceNode.start(t,this.pauseTime,o),this._counterNode.start(t,this.pauseTime,o)):(this.bufferSourceNode.start(t,s,o),this._counterNode.start(t,s,o)),this._playing=!0,this._paused=!1,this.bufferSourceNodes.push(this.bufferSourceNode),this.bufferSourceNode._arrayIndex=this.bufferSourceNodes.length-1,this.bufferSourceNode.addEventListener("ended",this._clearOnEnd),this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping,!0===this._looping&&(o=o||s-1e-15,this.bufferSourceNode.loopStart=s,this.bufferSourceNode.loopEnd=o,this._counterNode.loopStart=s,this._counterNode.loopEnd=o)}}else console.warn("SoundFile.play() called after dispose")},c.SoundFile.prototype.playMode=function(t){if("restart"===(t=t.toLowerCase())&&this.buffer&&this.bufferSourceNode)for(var e=0;e<this.bufferSourceNodes.length-1;e++){var i=r.audiocontext.currentTime;this.bufferSourceNodes[e].stop(i)}if("restart"!==t&&"sustain"!==t&&"untildone"!==t)throw'Invalid play mode. Must be either "restart" or "sustain"';this.mode=t},c.SoundFile.prototype.pause=function(t){t=(t||0)+r.audiocontext.currentTime,this.isPlaying()&&this.buffer&&this.bufferSourceNode?(this.pauseTime=this.currentTime(),this.bufferSourceNode.stop(t),this._counterNode.stop(t),this._paused=!0,this._playing=!1,this._pauseTime=this.currentTime()):this._pauseTime=0},c.SoundFile.prototype.loop=function(t,e,i,n,o){this._looping=!0,this.play(t,e,i,n,o)},c.SoundFile.prototype.setLoop=function(t){if(!0===t)this._looping=!0;else{if(!1!==t)throw"Error: setLoop accepts either true or false";this._looping=!1}this.bufferSourceNode&&(this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping)},c.SoundFile.prototype.isLooping=function(){return!(!this.bufferSourceNode||!0!==this._looping||!0!==this.isPlaying())},c.SoundFile.prototype.isPlaying=function(){return this._playing},c.SoundFile.prototype.isPaused=function(){return this._paused},c.SoundFile.prototype.stop=function(t){var e=t||0;"sustain"===this.mode||"untildone"===this.mode?(this.stopAll(e),this._playing=!1,this.pauseTime=0,this._paused=!1):this.buffer&&this.bufferSourceNode&&(t=r.audiocontext.currentTime,e=e||0,this.pauseTime=0,this.bufferSourceNode.stop(t+e),this._counterNode.stop(t+e),this._playing=!1,this._paused=!1)},c.SoundFile.prototype.stopAll=function(t){var e=r.audiocontext.currentTime,i=t||0;if(this.buffer&&this.bufferSourceNode){for(var n in this.bufferSourceNodes){const o=this.bufferSourceNodes[n];if(o)try{o.stop(e+i)}catch(t){}}this._counterNode.stop(e+i),this._onended(this)}},c.SoundFile.prototype.setVolume=function(t,e,i){if("number"==typeof t){var n=e||0,o=i||0,e=r.audiocontext.currentTime,i=this.output.gain.value;this.output.gain.cancelScheduledValues(e+o),this.output.gain.linearRampToValueAtTime(i,e+o),this.output.gain.linearRampToValueAtTime(t,e+o+n)}else{if(!t)return this.output.gain;t.connect(this.output.gain)}},c.SoundFile.prototype.amp=c.SoundFile.prototype.setVolume,c.SoundFile.prototype.fade=c.SoundFile.prototype.setVolume,c.SoundFile.prototype.getVolume=function(){return this.output.gain.value},c.SoundFile.prototype.pan=function(t,e){this.panPosition=t,this.panner.pan(t,e)},c.SoundFile.prototype.getPan=function(){return this.panPosition},c.SoundFile.prototype.rate=function(t){var e,i=!1;return void 0===t||(0===(this.playbackRate=t)?t=1e-13:t<0&&!this.reversed?(t=Math.abs(t),i=!0):0<t&&this.reversed&&(i=!0),this.bufferSourceNode&&(e=r.audiocontext.currentTime,this.bufferSourceNode.playbackRate.cancelScheduledValues(e),this.bufferSourceNode.playbackRate.linearRampToValueAtTime(Math.abs(t),e),this._counterNode.playbackRate.cancelScheduledValues(e),this._counterNode.playbackRate.linearRampToValueAtTime(Math.abs(t),e)),i&&this.reverseBuffer()),this.playbackRate},c.SoundFile.prototype.setPitch=function(t){t=e(t)/e(60),this.rate(t)},c.SoundFile.prototype.getPlaybackRate=function(){return this.playbackRate},c.SoundFile.prototype.duration=function(){return this.buffer?this.buffer.duration:0},c.SoundFile.prototype.currentTime=function(){return this.reversed?Math.abs(this._lastPos-this.buffer.length)/u.sampleRate:this._lastPos/u.sampleRate},c.SoundFile.prototype.jump=function(t,e){if(t<0||t>this.buffer.duration)throw"jump time out of range";if(e>this.buffer.duration-t)throw"end time out of range";t=t||0,e=e||void 0,this.isPlaying()&&this.stop(0),this.play(0,this.playbackRate,this.output.gain.value,t,e)},c.SoundFile.prototype.channels=function(){return this.buffer.numberOfChannels},c.SoundFile.prototype.sampleRate=function(){return this.buffer.sampleRate},c.SoundFile.prototype.frames=function(){return this.buffer.length},c.SoundFile.prototype.getPeaks=function(t){if(!this.buffer)throw"Cannot load peaks yet, buffer is not loaded";if(t=t||5*window.width,this.buffer){for(var e=this.buffer,i=e.length/t,n=~~(i/10)||1,o=e.numberOfChannels,s=new Float32Array(Math.round(t)),r=0;r<o;r++)for(var a=e.getChannelData(r),u=0;u<t;u++){for(var c=~~(u*i),h=~~(c+i),p=0,l=c;l<h;l+=n){var d=a[l];(p<d||p<-d)&&(p=d)}(0===r||Math.abs(p)>s[u])&&(s[u]=p)}return s}},c.SoundFile.prototype.reverseBuffer=function(){if(!this.buffer)throw"SoundFile is not done loading";var t=this._lastPos/u.sampleRate,e=this.getVolume();this.setVolume(0,.001);for(var i=this.buffer.numberOfChannels,n=0;n<i;n++)this.buffer.getChannelData(n).reverse();this.reversed=!this.reversed,t&&this.jump(this.duration()-t),this.setVolume(e,.001)},c.SoundFile.prototype.onended=function(t){return this._onended=t,this},c.SoundFile.prototype.add=function(){},c.SoundFile.prototype.dispose=function(){var t=r.audiocontext.currentTime,e=r.soundArray.indexOf(this);if(r.soundArray.splice(e,1),this.stop(t),this.buffer&&this.bufferSourceNode){for(var i=0;i<this.bufferSourceNodes.length-1;i++)if(null!==this.bufferSourceNodes[i]){this.bufferSourceNodes[i].disconnect();try{this.bufferSourceNodes[i].stop(t)}catch(t){console.warning("no buffer source node to dispose")}this.bufferSourceNodes[i]=null}if(this.isPlaying()){try{this._counterNode.stop(t)}catch(t){console.log(t)}this._counterNode=null}}this.output&&(this.output.disconnect(),this.output=null),this.panner&&(this.panner.disconnect(),this.panner=null)},c.SoundFile.prototype.connect=function(t){t?t.hasOwnProperty("input")?this.panner.connect(t.input):this.panner.connect(t):this.panner.connect(r.input)},c.SoundFile.prototype.disconnect=function(){this.panner&&this.panner.disconnect()},c.SoundFile.prototype.getLevel=function(){console.warn("p5.SoundFile.getLevel has been removed from the library. Use p5.Amplitude instead")},c.SoundFile.prototype.setPath=function(t,e){t=c.prototype._checkFileFormats(t),this.url=t,this.load(e)},c.SoundFile.prototype.setBuffer=function(t){var e=t.length,i=t[0].length,n=u.createBuffer(e,i,u.sampleRate);t[0]instanceof Float32Array||(t[0]=new Float32Array(t[0]));for(var o=0;o<e;o++)n.getChannelData(o).set(t[o]);this.buffer=n,this.panner.inputChannels(e)},c.SoundFile.prototype._initCounterNode=function(){var t=this,e=u.currentTime,i=u.createBufferSource();return t._scopeNode&&(t._scopeNode.disconnect(),t._scopeNode.removeEventListener("audioprocess",t._onAudioProcess),delete t._scopeNode),t._scopeNode=u.createScriptProcessor(256,1,1),i.buffer=function(t){const e=t.length,i=u.createBuffer(1,t.length,u.sampleRate),n=i.getChannelData(0);for(var o=0;o<e;o++)n[o]=o;return i}(t.buffer),i.playbackRate.setValueAtTime(t.playbackRate,e),i.connect(t._scopeNode),t._scopeNode.connect(c.soundOut._silentNode),t._scopeNode.addEventListener("audioprocess",t._onAudioProcess),i},c.SoundFile.prototype._initSourceNode=function(){var t=u.createBufferSource();return t.buffer=this.buffer,t.playbackRate.value=this.playbackRate,t.connect(this.output),t},c.SoundFile.prototype.processPeaks=function(s,t,e,i){var n=this.buffer.length,o=this.buffer.sampleRate,r=this.buffer,a=[],u=t||.9,c=e||.22,h=i||200;(o=(n=new window.OfflineAudioContext(1,n,o)).createBufferSource()).buffer=r,(r=n.createBiquadFilter()).type="lowpass",o.connect(r),r.connect(n.destination),o.start(0),n.startRendering(),n.oncomplete=function(t){if(self.panner){for(var e=t.renderedBuffer,i=e.getChannelData(0);a=function(t,e){for(var i,n={},o=t.length,s=0;s<o;s++)t[s]>e&&(i=t[s],i=new l(i,s),n[s]=i,s+=6e3),s++;return n}(i,u),u-=.005,Object.keys(a).length<h&&c<=u;);t=function(t){for(var e=[],i=Object.keys(t).sort(),n=0;n<i.length;n++)for(var o=0;o<10;o++){var s,r,a=t[i[n]],u=t[i[n+o]];a&&u&&(s=a.sampleIndex,0<(r=u.sampleIndex-s)&&a.intervals.push(r),e.some(function(t){return t.interval===r?(t.count++,t):void 0})||e.push({interval:r,count:1}))}return e}(a),n=e.sampleRate,o=[],t.forEach(function(e){try{var i=p(Math.abs(60/(e.interval/n)));if(!o.some(function(t){return t.tempo===i?t.count+=e.count:void 0})){if(isNaN(i))return;o.push({tempo:Math.round(i),count:e.count})}}catch(t){throw t}}),t=o.sort(function(t,e){return e.count-t.count}).splice(0,5),this.tempo=t[0].tempo,e=function(t,e,i){for(var n=[],o=Object.keys(t).sort(),s=0;s<o.length;s++)for(var r=t[o[s]],a=0;a<r.intervals.length;a++){var u=p(Math.round(Math.abs(60/(r.intervals[a]/i))));Math.abs(u-e)<5&&n.push(r.sampleIndex/i)}return n.filter(function(t,e,i){return.01<i[e+1]-t||void 0})}(a,t[0].tempo,e.sampleRate),s(e)}var n,o}};var l=function(t,e){this.sampleIndex=e,this.amplitude=t,this.tempos=[],this.intervals=[]};c.SoundFile.prototype.addCue=function(t,e,i){var n=this._cueIDCounter++,i=new o(e,t,n,i);return this._cues.push(i),n},c.SoundFile.prototype.removeCue=function(t){for(var e=this._cues.length,i=0;i<e;i++)if(this._cues[i].id===t){this._cues.splice(i,1);break}this._cues.length},c.SoundFile.prototype.clearCues=function(){this._cues=[]},c.SoundFile.prototype._onTimeUpdate=function(t){for(var e=t/this.buffer.sampleRate,i=this._cues.length,n=0;n<i;n++){var o=this._cues[n],s=o.time,r=o.val;this._prevTime<s&&s<=e&&o.callback(r)}this._prevTime=e},c.SoundFile.prototype.save=function(t){var e=i(this.buffer);c.prototype.saveSound([e],t,"wav")},c.SoundFile.prototype.getBlob=function(){var t=i(this.buffer);return new Blob([t],{type:"audio/wav"})}}(),i=t,c.Amplitude=function(t){this.bufferSize=2048,this.audiocontext=i.audiocontext,this.processor=this.audiocontext.createScriptProcessor(this.bufferSize,2,1),this.input=this.processor,this.output=this.audiocontext.createGain(),this.smoothing=t||0,this.volume=0,this.average=0,this.stereoVol=[0,0],this.stereoAvg=[0,0],this.stereoVolNorm=[0,0],this.volMax=.001,this.normalize=!1,this.processor.onaudioprocess=this._audioProcess.bind(this),this.processor.connect(this.output),this.output.gain.value=0,this.output.connect(this.audiocontext.destination),i.meter.connect(this.processor),i.soundArray.push(this)},c.Amplitude.prototype.setInput=function(t,e){i.meter.disconnect(),e&&(this.smoothing=e),null==t?(console.log("Amplitude input source is not ready! Connecting to master output instead"),i.meter.connect(this.processor)):t instanceof c.Signal?t.output.connect(this.processor):t?(t.connect(this.processor),this.processor.disconnect(),this.processor.connect(this.output)):i.meter.connect(this.processor)},c.Amplitude.prototype.connect=function(t){t?t.hasOwnProperty("input")?this.output.connect(t.input):this.output.connect(t):this.output.connect(this.panner.connect(i.input))},c.Amplitude.prototype.disconnect=function(){this.output&&this.output.disconnect()},c.Amplitude.prototype._audioProcess=function(t){for(var e=0;e<t.inputBuffer.numberOfChannels;e++){for(var i,n=t.inputBuffer.getChannelData(e),o=n.length,s=0,r=0,a=0;a<o;a++)i=n[a],this.normalize?(s+=Math.max(Math.min(i/this.volMax,1),-1),r+=Math.max(Math.min(i/this.volMax,1),-1)*Math.max(Math.min(i/this.volMax,1),-1)):(s+=i,r+=i*i);var u=s/o,c=Math.sqrt(r/o);this.stereoVol[e]=Math.max(c,this.stereoVol[e]*this.smoothing),this.stereoAvg[e]=Math.max(u,this.stereoVol[e]*this.smoothing),this.volMax=Math.max(this.stereoVol[e],this.volMax)}var h=this,p=this.stereoVol.reduce(function(t,e,i){return h.stereoVolNorm[i-1]=Math.max(Math.min(h.stereoVol[i-1]/h.volMax,1),0),h.stereoVolNorm[i]=Math.max(Math.min(h.stereoVol[i]/h.volMax,1),0),t+e});this.volume=p/this.stereoVol.length,this.volNorm=Math.max(Math.min(this.volume/this.volMax,1),0)},c.Amplitude.prototype.getLevel=function(t){return void 0!==t?(this.normalize?this.stereoVolNorm:this.stereoVol)[t]:this.normalize?this.volNorm:this.volume},c.Amplitude.prototype.toggleNormalize=function(t){this.normalize="boolean"==typeof t?t:!this.normalize},c.Amplitude.prototype.smooth=function(t){0<=t&&t<1?this.smoothing=t:console.log("Error: smoothing must be between 0 and 1")},c.Amplitude.prototype.dispose=function(){var t=i.soundArray.indexOf(this);i.soundArray.splice(t,1),this.input&&(this.input.disconnect(),delete this.input),this.output&&(this.output.disconnect(),delete this.output),delete this.processor},function(){var u=t;c.FFT=function(t,e){this.input=this.analyser=u.audiocontext.createAnalyser(),Object.defineProperties(this,{bins:{get:function(){return this.analyser.fftSize/2},set:function(t){this.analyser.fftSize=2*t},configurable:!0,enumerable:!0},smoothing:{get:function(){return this.analyser.smoothingTimeConstant},set:function(t){this.analyser.smoothingTimeConstant=t},configurable:!0,enumerable:!0}}),this.smooth(t),this.bins=e||1024,u.fftMeter.connect(this.analyser),this.freqDomain=new Uint8Array(this.analyser.frequencyBinCount),this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount),this.bass=[20,140],this.lowMid=[140,400],this.mid=[400,2600],this.highMid=[2600,5200],this.treble=[5200,14e3],u.soundArray.push(this)},c.FFT.prototype.setInput=function(t){t?(t.output?t.output.connect(this.analyser):t.connect&&t.connect(this.analyser),u.fftMeter.disconnect()):u.fftMeter.connect(this.analyser)},c.FFT.prototype.waveform=function(){for(var t,e=0;e<arguments.length;e++)"number"==typeof arguments[e]&&(this.analyser.fftSize=2*arguments[e]),"string"==typeof arguments[e]&&(t=arguments[e]);if(t&&!c.prototype._isSafari())return s(this,this.timeDomain),this.analyser.getFloatTimeDomainData(this.timeDomain),this.timeDomain;r(this,this.timeDomain),this.analyser.getByteTimeDomainData(this.timeDomain);for(var i=new Array,n=0;n<this.timeDomain.length;n++){var o=c.prototype.map(this.timeDomain[n],0,255,-1,1);i.push(o)}return i},c.FFT.prototype.analyze=function(){for(var t,e=0;e<arguments.length;e++)"number"==typeof arguments[e]&&(this.bins=arguments[e],this.analyser.fftSize=2*this.bins),"string"==typeof arguments[e]&&(t=arguments[e]);if(t&&"db"===t.toLowerCase())return n(this),this.analyser.getFloatFrequencyData(this.freqDomain),this.freqDomain;o(this,this.freqDomain),this.analyser.getByteFrequencyData(this.freqDomain);var i=Array.apply([],this.freqDomain);return i.length,this.analyser.fftSize,i.constructor,Array,i},c.FFT.prototype.getEnergy=function(t,e){var i=u.audiocontext.sampleRate/2;if("bass"===t?(t=this.bass[0],e=this.bass[1]):"lowMid"===t?(t=this.lowMid[0],e=this.lowMid[1]):"mid"===t?(t=this.mid[0],e=this.mid[1]):"highMid"===t?(t=this.highMid[0],e=this.highMid[1]):"treble"===t&&(t=this.treble[0],e=this.treble[1]),"number"!=typeof t)throw"invalid input for getEnergy()";if(e){if(t&&e){e<t&&(n=e,e=t,t=n);for(var n=Math.round(t/i*this.freqDomain.length),o=Math.round(e/i*this.freqDomain.length),s=0,r=0,a=n;a<=o;a++)s+=this.freqDomain[a],r+=1;return s/r}throw"invalid input for getEnergy()"}return i=Math.round(t/i*this.freqDomain.length),this.freqDomain[i]},c.FFT.prototype.getFreq=function(t,e){return console.log("getFreq() is deprecated. Please use getEnergy() instead."),this.getEnergy(t,e)},c.FFT.prototype.getCentroid=function(){for(var t=u.audiocontext.sampleRate/2,e=0,i=0,n=0;n<this.freqDomain.length;n++)e+=n*this.freqDomain[n],i+=this.freqDomain[n];var o=0;return(o=0!==i?e/i:o)*(t/this.freqDomain.length)},c.FFT.prototype.smooth=function(t){return void 0!==t&&(this.smoothing=t),this.smoothing},c.FFT.prototype.dispose=function(){var t=u.soundArray.indexOf(this);u.soundArray.splice(t,1),this.analyser&&(this.analyser.disconnect(),delete this.analyser)},c.FFT.prototype.linAverages=function(t){for(var t=t||16,e=this.freqDomain,i=e.length,n=Math.floor(i/t),o=new Array(t),s=0,r=0;r<i;r++)o[s]=void 0!==o[s]?(o[s]+e[r])/2:e[r],r%n==n-1&&s++;return o},c.FFT.prototype.logAverages=function(t){for(var e=u.audiocontext.sampleRate/2,i=this.freqDomain,n=i.length,o=new Array(t.length),s=0,r=0;r<n;r++)Math.round(r*e/this.freqDomain.length)>t[s].hi&&s++,o[s]=void 0!==o[s]?(o[s]+i[r])/2:i[r];return o},c.FFT.prototype.getOctaveBands=function(t,e){var t=t||3,i=[],n={lo:(e=e||15.625)/Math.pow(2,1/(2*t)),ctr:e,hi:e*Math.pow(2,1/(2*t))};i.push(n);for(var o=u.audiocontext.sampleRate/2;n.hi<o;){var s={};s.lo=n.hi,s.ctr=n.ctr*Math.pow(2,1/t),s.hi=s.ctr*Math.pow(2,1/(2*t)),i.push(s),n=s}return i};var n=function(t){t.freqDomain instanceof Float32Array==0&&(t.freqDomain=new Float32Array(t.analyser.frequencyBinCount))},o=function(t){t.freqDomain instanceof Uint8Array==0&&(t.freqDomain=new Uint8Array(t.analyser.frequencyBinCount))},s=function(t){t.timeDomain instanceof Float32Array==0&&(t.timeDomain=new Float32Array(t.analyser.frequencyBinCount))},r=function(t){t.timeDomain instanceof Uint8Array==0&&(t.timeDomain=new Uint8Array(t.analyser.frequencyBinCount))}}(),function(n){"use strict";n.SignalBase=function(){},n.extend(n.SignalBase),n.SignalBase.prototype.connect=function(t,e,i){return n.Signal&&n.Signal===t.constructor||n.Param&&n.Param===t.constructor||n.TimelineSignal&&n.TimelineSignal===t.constructor?(t._param.cancelScheduledValues(0),t._param.value=0,t.overridden=!0):t instanceof AudioParam&&(t.cancelScheduledValues(0),t.value=0),n.prototype.connect.call(this,t,e,i),this},n.SignalBase}(it),function(t){"use strict";t.WaveShaper=function(t,e){this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(t)?this.curve=t:isFinite(t)||this.isUndef(t)?this._curve=new Float32Array(this.defaultArg(t,1024)):this.isFunction(t)&&(this._curve=new Float32Array(this.defaultArg(e,1024)),this.setMap(t))},t.extend(t.WaveShaper,t.SignalBase),t.WaveShaper.prototype.setMap=function(t){for(var e=0,i=this._curve.length;e<i;e++)this._curve[e]=t(e/(i-1)*2-1,e);return this._shaper.curve=this._curve,this},Object.defineProperty(t.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(t){this._curve=new Float32Array(t),this._shaper.curve=this._curve}}),Object.defineProperty(t.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(t){if(-1===["none","2x","4x"].indexOf(t))throw new RangeError("Tone.WaveShaper: oversampling must be either 'none', '2x', or '4x'");this._shaper.oversample=t}}),t.WaveShaper.prototype.dispose=function(){return t.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},t.WaveShaper}(it),(p=it).TimeBase=function(t,e){if(!(this instanceof p.TimeBase))return new p.TimeBase(t,e);this._expr=this._noOp,t instanceof p.TimeBase?this.copy(t):!this.isUndef(e)||this.isNumber(t)?(e=this.defaultArg(e,this._defaultUnits),e=this._primaryExpressions[e].method,this._expr=e.bind(this,t)):this.isString(t)?this.set(t):this.isUndef(t)&&(this._expr=this._defaultExpr())},p.extend(p.TimeBase),p.TimeBase.prototype.set=function(t){return this._expr=this._parseExprString(t),this},p.TimeBase.prototype.clone=function(){var t=new this.constructor;return t.copy(this),t},p.TimeBase.prototype.copy=function(t){return t=t._expr(),this.set(t)},p.TimeBase.prototype._primaryExpressions={n:{regexp:/^(\d+)n/i,method:function(t){return 1===(t=parseInt(t))?this._beatsToUnits(this._timeSignature()):this._beatsToUnits(4/t)}},t:{regexp:/^(\d+)t/i,method:function(t){return t=parseInt(t),this._beatsToUnits(8/(3*parseInt(t)))}},m:{regexp:/^(\d+)m/i,method:function(t){return this._beatsToUnits(parseInt(t)*this._timeSignature())}},i:{regexp:/^(\d+)i/i,method:function(t){return this._ticksToUnits(parseInt(t))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz/i,method:function(t){return this._frequencyToUnits(parseFloat(t))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(t,e,i){var n=0;return t&&"0"!==t&&(n+=this._beatsToUnits(this._timeSignature()*parseFloat(t))),e&&"0"!==e&&(n+=this._beatsToUnits(parseFloat(e))),i&&"0"!==i&&(n+=this._beatsToUnits(parseFloat(i)/4)),n}},s:{regexp:/^(\d+(?:\.\d+)?s)/,method:function(t){return this._secondsToUnits(parseFloat(t))}},samples:{regexp:/^(\d+)samples/,method:function(t){return parseInt(t)/this.context.sampleRate}},default:{regexp:/^(\d+(?:\.\d+)?)/,method:function(t){return this._primaryExpressions[this._defaultUnits].method.call(this,t)}}},p.TimeBase.prototype._binaryExpressions={"+":{regexp:/^\+/,precedence:2,method:function(t,e){return t()+e()}},"-":{regexp:/^\-/,precedence:2,method:function(t,e){return t()-e()}},"*":{regexp:/^\*/,precedence:1,method:function(t,e){return t()*e()}},"/":{regexp:/^\//,precedence:1,method:function(t,e){return t()/e()}}},p.TimeBase.prototype._unaryExpressions={neg:{regexp:/^\-/,method:function(t){return-t()}}},p.TimeBase.prototype._syntaxGlue={"(":{regexp:/^\(/},")":{regexp:/^\)/}},p.TimeBase.prototype._tokenize=function(t){for(var e=-1,i=[];0<t.length;){var n=function(t,e){for(var i=["_binaryExpressions","_unaryExpressions","_primaryExpressions","_syntaxGlue"],n=0;n<i.length;n++){var o,s=e[i[n]];for(o in s){var r=s[o],a=r.regexp;if(null!==(a=t.match(a)))return{method:r.method,precedence:r.precedence,regexp:r.regexp,value:a[0]}}}throw new SyntaxError("Tone.TimeBase: Unexpected token "+t)}(t=t.trim(),this);i.push(n),t=t.substr(n.value.length)}return{next:function(){return i[++e]},peek:function(){return i[e+1]}}},p.TimeBase.prototype._matchGroup=function(t,e,i){if(!this.isUndef(t))for(var n in e)if((n=e[n]).regexp.test(t.value)){if(this.isUndef(i))return n;if(n.precedence===i)return n}return!1},p.TimeBase.prototype._parseBinary=function(t,e){for(var i=(e=this.isUndef(e)?2:e)<0?this._parseUnary(t):this._parseBinary(t,e-1),n=t.peek();n&&this._matchGroup(n,this._binaryExpressions,e);)i=(n=t.next()).method.bind(this,i,this._parseBinary(t,e-1)),n=t.peek();return i},p.TimeBase.prototype._parseUnary=function(t){var e=t.peek(),i=this._matchGroup(e,this._unaryExpressions);return i?(t.next(),e=this._parseUnary(t),i.method.bind(this,e)):this._parsePrimary(t)},p.TimeBase.prototype._parsePrimary=function(t){if(e=t.peek(),this.isUndef(e))throw new SyntaxError("Tone.TimeBase: Unexpected end of expression");if(this._matchGroup(e,this._primaryExpressions)){var e,i=(e=t.next()).value.match(e.regexp);return e.method.bind(this,i[1],i[2],i[3])}if(e&&"("===e.value){if(t.next(),i=this._parseBinary(t),!(e=t.next())||")"!==e.value)throw new SyntaxError("Expected )");return i}throw new SyntaxError("Tone.TimeBase: Cannot process token "+e.value)},p.TimeBase.prototype._parseExprString=function(t){return this.isString(t)||(t=t.toString()),t=this._tokenize(t),this._parseBinary(t)},p.TimeBase.prototype._noOp=function(){return 0},p.TimeBase.prototype._defaultExpr=function(){return this._noOp},p.TimeBase.prototype._defaultUnits="s",p.TimeBase.prototype._frequencyToUnits=function(t){return 1/t},p.TimeBase.prototype._beatsToUnits=function(t){return 60/p.Transport.bpm.value*t},p.TimeBase.prototype._secondsToUnits=function(t){return t},p.TimeBase.prototype._ticksToUnits=function(t){return t*(this._beatsToUnits(1)/p.Transport.PPQ)},p.TimeBase.prototype._timeSignature=function(){return p.Transport.timeSignature},p.TimeBase.prototype._pushExpr=function(t,e,i){return t instanceof p.TimeBase||(t=new this.constructor(t,i)),this._expr=this._binaryExpressions[e].method.bind(this,this._expr,t._expr),this},p.TimeBase.prototype.add=function(t,e){return this._pushExpr(t,"+",e)},p.TimeBase.prototype.sub=function(t,e){return this._pushExpr(t,"-",e)},p.TimeBase.prototype.mult=function(t,e){return this._pushExpr(t,"*",e)},p.TimeBase.prototype.div=function(t,e){return this._pushExpr(t,"/",e)},p.TimeBase.prototype.valueOf=function(){return this._expr()},p.TimeBase.prototype.dispose=function(){this._expr=null},p.TimeBase,(l=it).Time=function(t,e){return this instanceof l.Time?(this._plusNow=!1,void l.TimeBase.call(this,t,e)):new l.Time(t,e)},l.extend(l.Time,l.TimeBase),l.Time.prototype._unaryExpressions=Object.create(l.TimeBase.prototype._unaryExpressions),l.Time.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(t){return l.Transport.nextSubdivision(t())}},l.Time.prototype._unaryExpressions.now={regexp:/^\+/,method:function(t){return this._plusNow=!0,t()}},l.Time.prototype.quantize=function(t,e){return e=this.defaultArg(e,1),this._expr=function(t,e,i){return t=t(),e=e.toSeconds(),t+(Math.round(t/e)*e-t)*i}.bind(this,this._expr,new this.constructor(t),e),this},l.Time.prototype.addNow=function(){return this._plusNow=!0,this},l.Time.prototype._defaultExpr=function(){return this._plusNow=!0,this._noOp},l.Time.prototype.copy=function(t){return l.TimeBase.prototype.copy.call(this,t),this._plusNow=t._plusNow,this},l.Time.prototype.toNotation=function(){var t=this.toSeconds(),e=this._toNotationHelper(t,["1m","2n","4n","8n","16n","32n","64n","128n"]);return(t=this._toNotationHelper(t,["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"])).split("+").length<e.split("+").length?t:e},l.Time.prototype._toNotationHelper=function(t,e){for(var i=this._notationToUnits(e[e.length-1]),n="",o=0;o<e.length;o++){var s=this._notationToUnits(e[o]),r=t/s;if(1-r%1<1e-6&&(r+=1e-6),0<(r=Math.floor(r))){if(n+=1===r?e[o]:r.toString()+"*"+e[o],(t-=r*s)<i)break;n+=" + "}}return""===n?"0":n},l.Time.prototype._notationToUnits=function(t){for(var e=this._primaryExpressions,i=[e.n,e.t,e.m],n=0;n<i.length;n++){var o=i[n],s=t.match(o.regexp);if(s)return o.method.call(this,s[1])}},l.Time.prototype.toBarsBeatsSixteenths=function(){var t=this._beatsToUnits(1),e=this.toSeconds()/t,t=e%1*4;return[Math.floor(e/this._timeSignature()),e=Math.floor(e)%this._timeSignature(),t=3<(t=t.toString()).length?parseFloat(t).toFixed(3):t].join(":")},l.Time.prototype.toTicks=function(){var t=this._beatsToUnits(1),t=this.valueOf()/t;return Math.floor(t*l.Transport.PPQ)},l.Time.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate},l.Time.prototype.toFrequency=function(){return 1/this.toSeconds()},l.Time.prototype.toSeconds=function(){return this.valueOf()},l.Time.prototype.toMilliseconds=function(){return 1e3*this.toSeconds()},l.Time.prototype.valueOf=function(){return this._expr()+(this._plusNow?this.now():0)},l.Time,function(i){i.Frequency=function(t,e){return this instanceof i.Frequency?void i.TimeBase.call(this,t,e):new i.Frequency(t,e)},i.extend(i.Frequency,i.TimeBase),i.Frequency.prototype._primaryExpressions=Object.create(i.TimeBase.prototype._primaryExpressions),i.Frequency.prototype._primaryExpressions.midi={regexp:/^(\d+(?:\.\d+)?midi)/,method:function(t){return this.midiToFrequency(t)}},i.Frequency.prototype._primaryExpressions.note={regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(t,e){return e=n[t.toLowerCase()]+12*(parseInt(e)+1),this.midiToFrequency(e)}},i.Frequency.prototype._primaryExpressions.tr={regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(t,e,i){var n=1;return t&&"0"!==t&&(n*=this._beatsToUnits(this._timeSignature()*parseFloat(t))),e&&"0"!==e&&(n*=this._beatsToUnits(parseFloat(e))),i&&"0"!==i&&(n*=this._beatsToUnits(parseFloat(i)/4)),n}},i.Frequency.prototype.transpose=function(t){return this._expr=function(t,e){return t()*this.intervalToFrequencyRatio(e)}.bind(this,this._expr,t),this},i.Frequency.prototype.harmonize=function(t){return this._expr=function(t,e){for(var i=t(),n=[],o=0;o<e.length;o++)n[o]=i*this.intervalToFrequencyRatio(e[o]);return n}.bind(this,this._expr,t),this},i.Frequency.prototype.toMidi=function(){return this.frequencyToMidi(this.valueOf())},i.Frequency.prototype.toNote=function(){var t=this.valueOf(),e=Math.log(t/i.Frequency.A4)/Math.LN2,t=Math.round(12*e)+57;return(e=Math.floor(t/12))<0&&(t+=-12*e),o[t%12]+e.toString()},i.Frequency.prototype.toSeconds=function(){return 1/this.valueOf()},i.Frequency.prototype.toFrequency=function(){return this.valueOf()},i.Frequency.prototype.toTicks=function(){var t=this._beatsToUnits(1),t=this.valueOf()/t;return Math.floor(t*i.Transport.PPQ)},i.Frequency.prototype._frequencyToUnits=function(t){return t},i.Frequency.prototype._ticksToUnits=function(t){return 1/(60*t/(i.Transport.bpm.value*i.Transport.PPQ))},i.Frequency.prototype._beatsToUnits=function(t){return 1/i.TimeBase.prototype._beatsToUnits.call(this,t)},i.Frequency.prototype._secondsToUnits=function(t){return 1/t},i.Frequency.prototype._defaultUnits="hz";var n={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];i.Frequency.A4=440,i.Frequency.prototype.midiToFrequency=function(t){return i.Frequency.A4*Math.pow(2,(t-69)/12)},i.Frequency.prototype.frequencyToMidi=function(t){return 69+12*Math.log(t/i.Frequency.A4)/Math.LN2},i.Frequency}(it),(f=it).TransportTime=function(t,e){return this instanceof f.TransportTime?void f.Time.call(this,t,e):new f.TransportTime(t,e)},f.extend(f.TransportTime,f.Time),f.TransportTime.prototype._unaryExpressions=Object.create(f.Time.prototype._unaryExpressions),f.TransportTime.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(t){var e=this._secondsToTicks(t()),t=Math.ceil(f.Transport.ticks/e);return this._ticksToUnits(t*e)}},f.TransportTime.prototype._secondsToTicks=function(t){var e=this._beatsToUnits(1);return Math.round(t/e*f.Transport.PPQ)},f.TransportTime.prototype.valueOf=function(){return this._secondsToTicks(this._expr())+(this._plusNow?f.Transport.ticks:0)},f.TransportTime.prototype.toTicks=function(){return this.valueOf()},f.TransportTime.prototype.toSeconds=function(){return this._expr()+(this._plusNow?f.Transport.seconds:0)},f.TransportTime.prototype.toFrequency=function(){return 1/this.toSeconds()},f.TransportTime,(m=it).Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",Seconds:"seconds",Notation:"notation"},m.prototype.toSeconds=function(t){return this.isNumber(t)?t:this.isUndef(t)?this.now():this.isString(t)?new m.Time(t).toSeconds():t instanceof m.TimeBase?t.toSeconds():void 0},m.prototype.toFrequency=function(t){return this.isNumber(t)?t:this.isString(t)||this.isUndef(t)?new m.Frequency(t).valueOf():t instanceof m.TimeBase?t.toFrequency():void 0},m.prototype.toTicks=function(t){return this.isNumber(t)||this.isString(t)?new m.TransportTime(t).toTicks():this.isUndef(t)?m.Transport.ticks:t instanceof m.TimeBase?t.toTicks():void 0},function(n){"use strict";n.Param=function(){var t=this.optionsObject(arguments,["param","units","convert"],n.Param.defaults);this._param=this.input=t.param,this.units=t.units,this.convert=t.convert,this.overridden=!1,this._lfo=null,this.isObject(t.lfo)?this.value=t.lfo:this.isUndef(t.value)||(this.value=t.value)},n.extend(n.Param),n.Param.defaults={units:n.Type.Default,convert:!0,param:void 0},Object.defineProperty(n.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(t){if(this.isObject(t)){if(this.isUndef(n.LFO))throw new Error("Include 'Tone.LFO' to use an LFO as a Param value.");this._lfo&&this._lfo.dispose(),this._lfo=new n.LFO(t).start(),this._lfo.connect(this.input)}else t=this._fromUnits(t),this._param.cancelScheduledValues(0),this._param.value=t}}),n.Param.prototype._fromUnits=function(t){if(!this.convert&&!this.isUndef(this.convert))return t;switch(this.units){case n.Type.Time:return this.toSeconds(t);case n.Type.Frequency:return this.toFrequency(t);case n.Type.Decibels:return this.dbToGain(t);case n.Type.NormalRange:return Math.min(Math.max(t,0),1);case n.Type.AudioRange:return Math.min(Math.max(t,-1),1);case n.Type.Positive:return Math.max(t,0);default:return t}},n.Param.prototype._toUnits=function(t){return!this.convert&&!this.isUndef(this.convert)||this.units!==n.Type.Decibels?t:this.gainToDb(t)},n.Param.prototype._minOutput=1e-5,n.Param.prototype.setValueAtTime=function(t,e){return t=this._fromUnits(t),(e=this.toSeconds(e))<=this.now()+this.blockTime?this._param.value=t:this._param.setValueAtTime(t,e),this},n.Param.prototype.setRampPoint=function(t){t=this.defaultArg(t,this.now());var e=this._param.value;return 0===e&&(e=this._minOutput),this._param.setValueAtTime(e,t),this},n.Param.prototype.linearRampToValueAtTime=function(t,e){return t=this._fromUnits(t),this._param.linearRampToValueAtTime(t,this.toSeconds(e)),this},n.Param.prototype.exponentialRampToValueAtTime=function(t,e){return t=this._fromUnits(t),t=Math.max(this._minOutput,t),this._param.exponentialRampToValueAtTime(t,this.toSeconds(e)),this},n.Param.prototype.exponentialRampToValue=function(t,e,i){return i=this.toSeconds(i),this.setRampPoint(i),this.exponentialRampToValueAtTime(t,i+this.toSeconds(e)),this},n.Param.prototype.linearRampToValue=function(t,e,i){return i=this.toSeconds(i),this.setRampPoint(i),this.linearRampToValueAtTime(t,i+this.toSeconds(e)),this},n.Param.prototype.setTargetAtTime=function(t,e,i){return t=this._fromUnits(t),t=Math.max(this._minOutput,t),i=Math.max(this._minOutput,i),this._param.setTargetAtTime(t,this.toSeconds(e),i),this},n.Param.prototype.setValueCurveAtTime=function(t,e,i){for(var n=0;n<t.length;n++)t[n]=this._fromUnits(t[n]);return this._param.setValueCurveAtTime(t,this.toSeconds(e),this.toSeconds(i)),this},n.Param.prototype.cancelScheduledValues=function(t){return this._param.cancelScheduledValues(this.toSeconds(t)),this},n.Param.prototype.rampTo=function(t,e,i){return e=this.defaultArg(e,0),this.units===n.Type.Frequency||this.units===n.Type.BPM||this.units===n.Type.Decibels?this.exponentialRampToValue(t,e,i):this.linearRampToValue(t,e,i),this},Object.defineProperty(n.Param.prototype,"lfo",{get:function(){return this._lfo}}),n.Param.prototype.dispose=function(){return n.prototype.dispose.call(this),this._param=null,this._lfo&&(this._lfo.dispose(),this._lfo=null),this},n.Param}(it),function(i){"use strict";window.GainNode&&!AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),i.Gain=function(){var t=this.optionsObject(arguments,["gain","units"],i.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new i.Param({param:this._gainNode.gain,units:t.units,value:t.gain,convert:t.convert}),this._readOnly("gain")},i.extend(i.Gain),i.Gain.defaults={gain:1,convert:!0},i.Gain.prototype.dispose=function(){i.Param.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},i.prototype.createInsOuts=function(t,e){1===t?this.input=new i.Gain:1<t&&(this.input=new Array(t)),1===e?this.output=new i.Gain:1<e&&(this.output=new Array(t))},i.Gain}(it),R=function(e){"use strict";return e.Signal=function(){var t=this.optionsObject(arguments,["value","units"],e.Signal.defaults);this.output=this._gain=this.context.createGain(),t.param=this._gain.gain,e.Param.call(this,t),this.input=this._param=this._gain.gain,this.context.getConstant(1).chain(this._gain)},e.extend(e.Signal,e.Param),e.Signal.defaults={value:0,units:e.Type.Default,convert:!0},e.Signal.prototype.connect=e.SignalBase.prototype.connect,e.Signal.prototype.dispose=function(){return e.Param.prototype.dispose.call(this),this._param=null,this._gain.disconnect(),this._gain=null,this},e.Signal}(it),y=function(e){"use strict";return e.Add=function(t){this.createInsOuts(2,0),this._sum=this.input[0]=this.input[1]=this.output=new e.Gain,this._param=this.input[1]=new e.Signal(t),this._param.connect(this._sum)},e.extend(e.Add,e.Signal),e.Add.prototype.dispose=function(){return e.prototype.dispose.call(this),this._sum.dispose(),this._sum=null,this._param.dispose(),this._param=null,this},e.Add}(it),v=function(e){"use strict";return e.Multiply=function(t){this.createInsOuts(2,0),this._mult=this.input[0]=this.output=new e.Gain,this._param=this.input[1]=this.output.gain,this._param.value=this.defaultArg(t,0)},e.extend(e.Multiply,e.Signal),e.Multiply.prototype.dispose=function(){return e.prototype.dispose.call(this),this._mult.dispose(),this._mult=null,this._param=null,this},e.Multiply}(it),_=function(i){"use strict";return i.Scale=function(t,e){this._outputMin=this.defaultArg(t,0),this._outputMax=this.defaultArg(e,1),this._scale=this.input=new i.Multiply(1),this._add=this.output=new i.Add(0),this._scale.connect(this._add),this._setRange()},i.extend(i.Scale,i.SignalBase),Object.defineProperty(i.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(t){this._outputMin=t,this._setRange()}}),Object.defineProperty(i.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(t){this._outputMax=t,this._setRange()}}),i.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},i.Scale.prototype.dispose=function(){return i.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},i.Scale}(it),g=R,T=y,b=v,x=_,c.Signal=function(t){return new g(t)},g.prototype.fade=g.prototype.linearRampToValueAtTime,b.prototype.fade=g.prototype.fade,T.prototype.fade=g.prototype.fade,x.prototype.fade=g.prototype.fade,g.prototype.setInput=function(t){t.connect(this)},b.prototype.setInput=g.prototype.setInput,T.prototype.setInput=g.prototype.setInput,x.prototype.setInput=g.prototype.setInput,g.prototype.add=function(t){return t=new T(t),this.connect(t),t},b.prototype.add=g.prototype.add,T.prototype.add=g.prototype.add,x.prototype.add=g.prototype.add,g.prototype.mult=function(t){return t=new b(t),this.connect(t),t},b.prototype.mult=g.prototype.mult,T.prototype.mult=g.prototype.mult,x.prototype.mult=g.prototype.mult,g.prototype.scale=function(t,e,i,n){var o,s=4===arguments.length?(o=c.prototype.map(i,t,e,0,1)-.5,c.prototype.map(n,t,e,0,1)-.5):(o=t,e),s=new x(o,s);return this.connect(s),s},b.prototype.scale=g.prototype.scale,T.prototype.scale=g.prototype.scale,x.prototype.scale=g.prototype.scale,pt=t,lt=y,dt=v,ft=_,c.Oscillator=function(t,e){var i;"string"==typeof t&&(i=e,e=t,t=i),"number"==typeof e&&(i=e,e=t,t=i),this.started=!1,this.phaseAmount=void 0,this.oscillator=pt.audiocontext.createOscillator(),this.f=t||440,this.oscillator.type=e||"sine",this.oscillator.frequency.setValueAtTime(this.f,pt.audiocontext.currentTime),this.output=pt.audiocontext.createGain(),this._freqMods=[],this.output.gain.value=.5,this.output.gain.setValueAtTime(.5,pt.audiocontext.currentTime),this.oscillator.connect(this.output),this.panPosition=0,this.connection=pt.input,this.panner=new c.Panner(this.output,this.connection,1),this.mathOps=[this.output],pt.soundArray.push(this)},c.Oscillator.prototype.start=function(t,e){if(this.started&&(n=pt.audiocontext.currentTime,this.stop(n)),!this.started){var i,n=e||this.f,e=this.oscillator.type;for(i in this.oscillator&&(this.oscillator.disconnect(),delete this.oscillator),this.oscillator=pt.audiocontext.createOscillator(),this.oscillator.frequency.value=Math.abs(n),this.oscillator.type=e,this.oscillator.connect(this.output),this.oscillator.start((t=t||0)+pt.audiocontext.currentTime),this.freqNode=this.oscillator.frequency,this._freqMods)void 0!==this._freqMods[i].connect&&this._freqMods[i].connect(this.oscillator.frequency);this.started=!0}},c.Oscillator.prototype.stop=function(t){var e;this.started&&(e=pt.audiocontext.currentTime,this.oscillator.stop((t||0)+e),this.started=!1)},c.Oscillator.prototype.amp=function(t,e,i){if("number"==typeof t){var e=e||0,i=i||0,n=pt.audiocontext.currentTime;this.output.gain.linearRampToValueAtTime(t,n+i+e)}else{if(!t)return this.output.gain;t.connect(this.output.gain)}},c.Oscillator.prototype.fade=c.Oscillator.prototype.amp,c.Oscillator.prototype.getAmp=function(){return this.output.gain.value},c.Oscillator.prototype.freq=function(t,e,i){if("number"!=typeof t||isNaN(t)){if(!t)return this.oscillator.frequency;(t=t.output||t).connect(this.oscillator.frequency),this._freqMods.push(t)}else{this.f=t;var n=pt.audiocontext.currentTime,i=i||0;0===(e=e||0)?this.oscillator.frequency.setValueAtTime(t,i+n):0<t?this.oscillator.frequency.exponentialRampToValueAtTime(t,i+e+n):this.oscillator.frequency.linearRampToValueAtTime(t,i+e+n),this.phaseAmount&&this.phase(this.phaseAmount)}},c.Oscillator.prototype.getFreq=function(){return this.oscillator.frequency.value},c.Oscillator.prototype.setType=function(t){this.oscillator.type=t},c.Oscillator.prototype.getType=function(){return this.oscillator.type},c.Oscillator.prototype.connect=function(t){t?t.hasOwnProperty("input")?(this.panner.connect(t.input),this.connection=t.input):(this.panner.connect(t),this.connection=t):this.panner.connect(pt.input)},c.Oscillator.prototype.disconnect=function(){this.output&&this.output.disconnect(),this.panner&&(this.panner.disconnect(),this.output&&this.output.connect(this.panner)),this.oscMods=[]},c.Oscillator.prototype.pan=function(t,e){this.panPosition=t,this.panner.pan(t,e)},c.Oscillator.prototype.getPan=function(){return this.panPosition},c.Oscillator.prototype.dispose=function(){var t=pt.soundArray.indexOf(this);pt.soundArray.splice(t,1),this.oscillator&&(t=pt.audiocontext.currentTime,this.stop(t),this.disconnect(),this.panner=null,this.oscillator=null),this.osc2&&this.osc2.dispose()},c.Oscillator.prototype.phase=function(t){var e=c.prototype.map(t,0,1,0,1/this.f),i=pt.audiocontext.currentTime;this.phaseAmount=t,this.dNode||(this.dNode=pt.audiocontext.createDelay(),this.oscillator.disconnect(),this.oscillator.connect(this.dNode),this.dNode.connect(this.output)),this.dNode.delayTime.setValueAtTime(e,i)},c.Oscillator.prototype.add=function(t){return Tt(this,new lt(t),this.mathOps.length-1,t=this.output,lt)},c.Oscillator.prototype.mult=function(t){return Tt(this,new dt(t),this.mathOps.length-1,t=this.output,dt)},c.Oscillator.prototype.scale=function(t,e,i,n){var o=4===arguments.length?(s=c.prototype.map(i,t,e,0,1)-.5,c.prototype.map(n,t,e,0,1)-.5):(s=t,e),o=new ft(s,o),s=this.mathOps.length-1;return Tt(this,o,s,this.output,ft)},c.SinOsc=function(t){c.Oscillator.call(this,t,"sine")},c.SinOsc.prototype=Object.create(c.Oscillator.prototype),c.TriOsc=function(t){c.Oscillator.call(this,t,"triangle")},c.TriOsc.prototype=Object.create(c.Oscillator.prototype),c.SawOsc=function(t){c.Oscillator.call(this,t,"sawtooth")},c.SawOsc.prototype=Object.create(c.Oscillator.prototype),c.SqrOsc=function(t){c.Oscillator.call(this,t,"square")},c.SqrOsc.prototype=Object.create(c.Oscillator.prototype),function(e){"use strict";e.Timeline=function(){var t=this.optionsObject(arguments,["memory"],e.Timeline.defaults);this._timeline=[],this._toRemove=[],this._iterating=!1,this.memory=t.memory},e.extend(e.Timeline),e.Timeline.defaults={memory:1/0},Object.defineProperty(e.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),e.Timeline.prototype.add=function(t){if(this.isUndef(t.time))throw new Error("Tone.Timeline: events must have a time attribute");var e;return this._timeline.length?(e=this._search(t.time),this._timeline.splice(e+1,0,t)):this._timeline.push(t),this.length>this.memory&&(t=this.length-this.memory,this._timeline.splice(0,t)),this},e.Timeline.prototype.remove=function(t){return this._iterating?this._toRemove.push(t):-1!==(t=this._timeline.indexOf(t))&&this._timeline.splice(t,1),this},e.Timeline.prototype.get=function(t){return-1!==(t=this._search(t))?this._timeline[t]:null},e.Timeline.prototype.peek=function(){return this._timeline[0]},e.Timeline.prototype.shift=function(){return this._timeline.shift()},e.Timeline.prototype.getAfter=function(t){return(t=this._search(t))+1<this._timeline.length?this._timeline[t+1]:null},e.Timeline.prototype.getBefore=function(t){var e=this._timeline.length;return 0<e&&this._timeline[e-1].time<t?this._timeline[e-1]:0<=(t=this._search(t))-1?this._timeline[t-1]:null},e.Timeline.prototype.cancel=function(t){if(1<this._timeline.length){var e=this._search(t);if(0<=e)if(this._timeline[e].time===t){for(var i=e;0<=i&&this._timeline[i].time===t;i--)e=i;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&this._timeline[0].time>=t&&(this._timeline=[]);return this},e.Timeline.prototype.cancelBefore=function(t){return!this._timeline.length||0<=(t=this._search(t))&&(this._timeline=this._timeline.slice(t+1)),this},e.Timeline.prototype._search=function(t){var e=0,i=this._timeline.length,n=i;if(0<i&&this._timeline[i-1].time<=t)return i-1;for(;e<n;){var o=Math.floor(e+(n-e)/2),s=this._timeline[o],r=this._timeline[o+1];if(s.time===t){for(var a=o;a<this._timeline.length;a++)this._timeline[a].time===t&&(o=a);return o}if(s.time<t&&r.time>t)return o;s.time>t?n=o:s.time<t&&(e=o+1)}return-1},e.Timeline.prototype._iterate=function(t,e,i){this._iterating=!0,e=this.defaultArg(e,0),i=this.defaultArg(i,this._timeline.length-1);for(var n=e;n<=i;n++)t(this._timeline[n]);if(this._iterating=!1,0<this._toRemove.length){for(var o=0;o<this._toRemove.length;o++){var s=this._timeline.indexOf(this._toRemove[o]);-1!==s&&this._timeline.splice(s,1)}this._toRemove=[]}},e.Timeline.prototype.forEach=function(t){return this._iterate(t),this},e.Timeline.prototype.forEachBefore=function(t,e){return-1!==(t=this._search(t))&&this._iterate(e,0,t),this},e.Timeline.prototype.forEachAfter=function(t,e){return t=this._search(t),this._iterate(e,t+1),this},e.Timeline.prototype.forEachFrom=function(t,e){for(var i=this._search(t);0<=i&&this._timeline[i].time>=t;)i--;return this._iterate(e,i+1),this},e.Timeline.prototype.forEachAtTime=function(e,i){var t=this._search(e);return-1!==t&&this._iterate(function(t){t.time===e&&i(t)},0,t),this},e.Timeline.prototype.dispose=function(){e.prototype.dispose.call(this),this._timeline=null,this._toRemove=null},e.Timeline}(it),S=function(u){"use strict";return u.TimelineSignal=function(){var t=this.optionsObject(arguments,["value","units"],u.Signal.defaults);this._events=new u.Timeline(10),u.Signal.apply(this,t),t.param=this._param,u.Param.call(this,t),this._initial=this._fromUnits(this._param.value)},u.extend(u.TimelineSignal,u.Param),u.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Curve:"curve",Set:"set"},Object.defineProperty(u.TimelineSignal.prototype,"value",{get:function(){var t=this.now(),t=this.getValueAtTime(t);return this._toUnits(t)},set:function(t){t=this._fromUnits(t),this._initial=t,this.cancelScheduledValues(),this._param.value=t}}),u.TimelineSignal.prototype.setValueAtTime=function(t,e){return t=this._fromUnits(t),e=this.toSeconds(e),this._events.add({type:u.TimelineSignal.Type.Set,value:t,time:e}),this._param.setValueAtTime(t,e),this},u.TimelineSignal.prototype.linearRampToValueAtTime=function(t,e){return t=this._fromUnits(t),e=this.toSeconds(e),this._events.add({type:u.TimelineSignal.Type.Linear,value:t,time:e}),this._param.linearRampToValueAtTime(t,e),this},u.TimelineSignal.prototype.exponentialRampToValueAtTime=function(t,e){e=this.toSeconds(e);var i=this._searchBefore(e);return i&&0===i.value&&this.setValueAtTime(this._minOutput,i.time),t=this._fromUnits(t),i=Math.max(t,this._minOutput),this._events.add({type:u.TimelineSignal.Type.Exponential,value:i,time:e}),t<this._minOutput?(this._param.exponentialRampToValueAtTime(this._minOutput,e-this.sampleTime),this.setValueAtTime(0,e)):this._param.exponentialRampToValueAtTime(t,e),this},u.TimelineSignal.prototype.setTargetAtTime=function(t,e,i){return t=this._fromUnits(t),t=Math.max(this._minOutput,t),i=Math.max(this._minOutput,i),e=this.toSeconds(e),this._events.add({type:u.TimelineSignal.Type.Target,value:t,time:e,constant:i}),this._param.setTargetAtTime(t,e,i),this},u.TimelineSignal.prototype.setValueCurveAtTime=function(t,e,i,n){n=this.defaultArg(n,1);for(var o=new Array(t.length),s=0;s<o.length;s++)o[s]=this._fromUnits(t[s])*n;e=this.toSeconds(e),i=this.toSeconds(i),this._events.add({type:u.TimelineSignal.Type.Curve,value:o,time:e,duration:i}),this._param.setValueAtTime(o[0],e);for(var r=1;r<o.length;r++){var a=e+r/(o.length-1)*i;this._param.linearRampToValueAtTime(o[r],a)}return this},u.TimelineSignal.prototype.cancelScheduledValues=function(t){return t=this.toSeconds(t),this._events.cancel(t),this._param.cancelScheduledValues(t),this},u.TimelineSignal.prototype.setRampPoint=function(t){t=this.toSeconds(t);var e=this._toUnits(this.getValueAtTime(t)),i=this._searchBefore(t);return i&&i.time===t?this.cancelScheduledValues(t+this.sampleTime):i&&i.type===u.TimelineSignal.Type.Curve&&i.time+i.duration>t?(this.cancelScheduledValues(t),this.linearRampToValueAtTime(e,t)):((i=this._searchAfter(t))&&(this.cancelScheduledValues(t),i.type===u.TimelineSignal.Type.Linear?this.linearRampToValueAtTime(e,t):i.type===u.TimelineSignal.Type.Exponential&&this.exponentialRampToValueAtTime(e,t)),this.setValueAtTime(e,t)),this},u.TimelineSignal.prototype.linearRampToValueBetween=function(t,e,i){return this.setRampPoint(e),this.linearRampToValueAtTime(t,i),this},u.TimelineSignal.prototype.exponentialRampToValueBetween=function(t,e,i){return this.setRampPoint(e),this.exponentialRampToValueAtTime(t,i),this},u.TimelineSignal.prototype._searchBefore=function(t){return this._events.get(t)},u.TimelineSignal.prototype._searchAfter=function(t){return this._events.getAfter(t)},u.TimelineSignal.prototype.getValueAtTime=function(t){t=this.toSeconds(t);var e,i=this._searchAfter(t),n=this._searchBefore(t);return this._initial,null===n?this._initial:n.type===u.TimelineSignal.Type.Target?(e=null===(e=this._events.getBefore(n.time))?this._initial:e.value,this._exponentialApproach(n.time,e,n.value,n.constant,t)):n.type===u.TimelineSignal.Type.Curve?this._curveInterpolate(n.time,n.value,n.duration,t):null===i?n.value:i.type===u.TimelineSignal.Type.Linear?this._linearInterpolate(n.time,n.value,i.time,i.value,t):i.type===u.TimelineSignal.Type.Exponential?this._exponentialInterpolate(n.time,n.value,i.time,i.value,t):n.value},u.TimelineSignal.prototype.connect=u.SignalBase.prototype.connect,u.TimelineSignal.prototype._exponentialApproach=function(t,e,i,n,o){return i+(e-i)*Math.exp(-(o-t)/n)},u.TimelineSignal.prototype._linearInterpolate=function(t,e,i,n,o){return e+(o-t)/(i-t)*(n-e)},u.TimelineSignal.prototype._exponentialInterpolate=function(t,e,i,n,o){return(e=Math.max(this._minOutput,e))*Math.pow(n/e,(o-t)/(i-t))},u.TimelineSignal.prototype._curveInterpolate=function(t,e,i,n){var o=e.length;if(t+i<=n)return e[o-1];if(n<=t)return e[0];var s=(n-t)/i,n=Math.floor((o-1)*s),t=Math.ceil((o-1)*s),i=e[n],e=e[t];return t===n?i:this._linearInterpolate(n,i,t,e,s*(o-1))},u.TimelineSignal.prototype.dispose=function(){u.Signal.prototype.dispose.call(this),u.Param.prototype.dispose.call(this),this._events.dispose(),this._events=null},u.TimelineSignal}(it),w=t,A=y,P=v,k=_,O=S,c.Envelope=function(t,e,i,n,o,s){this.aTime=t||.1,this.aLevel=e||1,this.dTime=i||.5,this.dLevel=n||0,this.rTime=o||0,this.rLevel=s||0,this._rampHighPercentage=.98,this._rampLowPercentage=.02,this.output=w.audiocontext.createGain(),this.control=new O,this._init(),this.control.connect(this.output),this.connection=null,this.mathOps=[this.control],this.isExponential=!1,this.sourceToClear=null,this.wasTriggered=!1,w.soundArray.push(this)},c.Envelope.prototype._init=function(){var t=w.audiocontext.currentTime;this.control.setTargetAtTime(1e-5,t,.001),this._setRampAD(this.aTime,this.dTime)},c.Envelope.prototype.set=function(t,e,i,n,o,s){this.aTime=t,this.aLevel=e,this.dTime=i||0,this.dLevel=n||0,this.rTime=o||0,this.rLevel=s||0,this._setRampAD(t,i)},c.Envelope.prototype.setADSR=function(t,e,i,n){this.aTime=t,this.dTime=e||0,this.sPercent=i||0,this.dLevel=void 0!==i?i*(this.aLevel-this.rLevel)+this.rLevel:0,this.rTime=n||0,this._setRampAD(t,e)},c.Envelope.prototype.setRange=function(t,e){this.aLevel=t||1,this.rLevel=e||0},c.Envelope.prototype._setRampAD=function(t,e){this._rampAttackTime=this.checkExpInput(t),this._rampDecayTime=this.checkExpInput(e);var i=Math.log(1/this.checkExpInput(1-this._rampHighPercentage));this._rampAttackTC=t/this.checkExpInput(i),i=Math.log(1/this._rampLowPercentage),this._rampDecayTC=e/this.checkExpInput(i)},c.Envelope.prototype.setRampPercentages=function(t,e){this._rampHighPercentage=this.checkExpInput(t),this._rampLowPercentage=this.checkExpInput(e),e=1,e=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=this._rampAttackTime/this.checkExpInput(e),e=Math.log(1/this._rampLowPercentage),this._rampDecayTC=this._rampDecayTime/this.checkExpInput(e)},c.Envelope.prototype.setInput=function(){for(var t=0;t<arguments.length;t++)this.connect(arguments[t])},c.Envelope.prototype.setExp=function(t){this.isExponential=t},c.Envelope.prototype.checkExpInput=function(t){return t<=0?1e-8:t},c.Envelope.prototype.play=function(t,e,i){e=e||0,i=i||0,t&&this.connection!==t&&this.connect(t),this.triggerAttack(t,e),this.triggerRelease(t,e+this.aTime+this.dTime+i)},c.Envelope.prototype.triggerAttack=function(t,e){e=w.audiocontext.currentTime+(e||0),this.lastAttack=e,this.wasTriggered=!0,t&&this.connection!==t&&this.connect(t),t=this.control.getValueAtTime(e),!0===this.isExponential?this.control.exponentialRampToValueAtTime(this.checkExpInput(t),e):this.control.linearRampToValueAtTime(t,e),e+=this.aTime,!0===this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.aLevel),e),t=this.checkExpInput(this.control.getValueAtTime(e)),this.control.cancelScheduledValues(e),this.control.exponentialRampToValueAtTime(t,e)):(this.control.linearRampToValueAtTime(this.aLevel,e),t=this.control.getValueAtTime(e),this.control.cancelScheduledValues(e),this.control.linearRampToValueAtTime(t,e)),e+=this.dTime,!0===this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.dLevel),e),t=this.checkExpInput(this.control.getValueAtTime(e)),this.control.cancelScheduledValues(e),this.control.exponentialRampToValueAtTime(t,e)):(this.control.linearRampToValueAtTime(this.dLevel,e),t=this.control.getValueAtTime(e),this.control.cancelScheduledValues(e),this.control.linearRampToValueAtTime(t,e))},c.Envelope.prototype.triggerRelease=function(t,e){this.wasTriggered&&(e=w.audiocontext.currentTime+(e||0),t&&this.connection!==t&&this.connect(t),t=this.control.getValueAtTime(e),!0===this.isExponential?this.control.exponentialRampToValueAtTime(this.checkExpInput(t),e):this.control.linearRampToValueAtTime(t,e),e+=this.rTime,!0===this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.rLevel),e),t=this.checkExpInput(this.control.getValueAtTime(e)),this.control.cancelScheduledValues(e),this.control.exponentialRampToValueAtTime(t,e)):(this.control.linearRampToValueAtTime(this.rLevel,e),t=this.control.getValueAtTime(e),this.control.cancelScheduledValues(e),this.control.linearRampToValueAtTime(t,e)),this.wasTriggered=!1)},c.Envelope.prototype.ramp=function(t,e,i,n){e=w.audiocontext.currentTime+(e||0),i=this.checkExpInput(i),n=void 0!==n?this.checkExpInput(n):void 0,t&&this.connection!==t&&this.connect(t),(t=this.checkExpInput(this.control.getValueAtTime(e)))<i?(this.control.setTargetAtTime(i,e,this._rampAttackTC),e+=this._rampAttackTime):i<t&&(this.control.setTargetAtTime(i,e,this._rampDecayTC),e+=this._rampDecayTime),void 0!==n&&(i<n?this.control.setTargetAtTime(n,e,this._rampAttackTC):n<i&&this.control.setTargetAtTime(n,e,this._rampDecayTC))},c.Envelope.prototype.connect=function(t){(t=(this.connection=t)instanceof c.Oscillator||t instanceof c.SoundFile||t instanceof c.AudioIn||t instanceof c.Reverb||t instanceof c.Noise||t instanceof c.Filter||t instanceof c.Delay?t.output.gain:t)instanceof AudioParam&&t.setValueAtTime(0,w.audiocontext.currentTime),t instanceof c.Signal&&t.setValue(0),this.output.connect(t)},c.Envelope.prototype.disconnect=function(){this.output&&this.output.disconnect()},c.Envelope.prototype.add=function(t){var e=new A(t),i=this.mathOps.length,t=this.output;return c.prototype._mathChain(this,e,i,t,A)},c.Envelope.prototype.mult=function(t){var e=new P(t),i=this.mathOps.length,t=this.output;return c.prototype._mathChain(this,e,i,t,P)},c.Envelope.prototype.scale=function(t,e,i,n){return e=new k(t,e,i,n),i=this.mathOps.length,n=this.output,c.prototype._mathChain(this,e,i,n,k)},c.Envelope.prototype.dispose=function(){var t=w.soundArray.indexOf(this);w.soundArray.splice(t,1),this.disconnect(),this.control&&(this.control.dispose(),this.control=null);for(var e=1;e<this.mathOps.length;e++)this.mathOps[e].dispose()},c.Env=function(t,e,i,n,o,s){console.warn("WARNING: p5.Env is now deprecated and may be removed in future versions. Please use the new p5.Envelope instead."),c.Envelope.call(this,t,e,i,n,o,s)},c.Env.prototype=Object.create(c.Envelope.prototype),F=t,c.Pulse=function(t,e){c.Oscillator.call(this,t,"sawtooth"),this.w=e||0,this.osc2=new c.SawOsc(t),this.dNode=F.audiocontext.createDelay(),this.dcOffset=vt(),this.dcGain=F.audiocontext.createGain(),this.dcOffset.connect(this.dcGain),this.dcGain.connect(this.output),this.f=t||440,t=this.w/this.oscillator.frequency.value,this.dNode.delayTime.value=t,this.dcGain.gain.value=1.7*(.5-this.w),this.osc2.disconnect(),this.osc2.panner.disconnect(),this.osc2.amp(-1),this.osc2.output.connect(this.dNode),this.dNode.connect(this.output),this.output.gain.value=1,this.output.connect(this.panner)},c.Pulse.prototype=Object.create(c.Oscillator.prototype),c.Pulse.prototype.width=function(t){var e;"number"==typeof t?(t<=1&&0<=t&&(this.w=t,e=this.w/this.oscillator.frequency.value,this.dNode.delayTime.value=e),this.dcGain.gain.value=1.7*(.5-this.w)):(t.connect(this.dNode.delayTime),(e=new c.SignalAdd(-.5)).setInput(t),(e=(e=e.mult(-1)).mult(1.7)).connect(this.dcGain.gain))},c.Pulse.prototype.start=function(t,e){var i=F.audiocontext.currentTime,n=e||0;this.started||(e=t||this.f,t=this.oscillator.type,this.oscillator=F.audiocontext.createOscillator(),this.oscillator.frequency.setValueAtTime(e,i),this.oscillator.type=t,this.oscillator.connect(this.output),this.oscillator.start(n+i),this.osc2.oscillator=F.audiocontext.createOscillator(),this.osc2.oscillator.frequency.setValueAtTime(e,n+i),this.osc2.oscillator.type=t,this.osc2.oscillator.connect(this.osc2.output),this.osc2.start(n+i),this.freqNode=[this.oscillator.frequency,this.osc2.oscillator.frequency],this.dcOffset=vt(),this.dcOffset.connect(this.dcGain),this.dcOffset.start(n+i),void 0!==this.mods&&void 0!==this.mods.frequency&&(this.mods.frequency.connect(this.freqNode[0]),this.mods.frequency.connect(this.freqNode[1])),this.started=!0,this.osc2.started=!0)},c.Pulse.prototype.stop=function(t){var e;this.started&&(e=F.audiocontext.currentTime,this.oscillator.stop((t=t||0)+e),this.osc2.oscillator&&this.osc2.oscillator.stop(t+e),this.dcOffset.stop(t+e),this.started=!1,this.osc2.started=!1)},c.Pulse.prototype.freq=function(t,e,i){var n,o;"number"==typeof t?(this.f=t,n=F.audiocontext.currentTime,e=e||0,i=i||0,o=this.oscillator.frequency.value,this.oscillator.frequency.cancelScheduledValues(n),this.oscillator.frequency.setValueAtTime(o,n+i),this.oscillator.frequency.exponentialRampToValueAtTime(t,i+e+n),this.osc2.oscillator.frequency.cancelScheduledValues(n),this.osc2.oscillator.frequency.setValueAtTime(o,n+i),this.osc2.oscillator.frequency.exponentialRampToValueAtTime(t,i+e+n),this.freqMod&&(this.freqMod.output.disconnect(),this.freqMod=null)):t.output&&(t.output.disconnect(),t.output.connect(this.oscillator.frequency),t.output.connect(this.osc2.oscillator.frequency),this.freqMod=t)},function(){var l=t;c.Noise=function(t){c.Oscillator.call(this),delete this.f,delete this.freq,delete this.oscillator,this.buffer="brown"===t?n:"pink"===t?i:e},c.Noise.prototype=Object.create(c.Oscillator.prototype);var e=function(){for(var t=2*l.audiocontext.sampleRate,e=l.audiocontext.createBuffer(1,t,l.audiocontext.sampleRate),i=e.getChannelData(0),n=0;n<t;n++)i[n]=2*Math.random()-1;return e.type="white",e}(),i=function(){for(var t,e=2*l.audiocontext.sampleRate,i=l.audiocontext.createBuffer(1,e,l.audiocontext.sampleRate),n=i.getChannelData(0),o=r=a=u=c=h=p=t=0;o<e;o++){var s=2*Math.random()-1,r=.99886*r+.0555179*s,a=.99332*a+.0750759*s,u=.969*u+.153852*s,c=.8665*c+.3104856*s,h=.55*h+.5329522*s,p=-.7616*p-.016898*s;n[o]=r+a+u+c+h+p+t+.5362*s,n[o]*=.11,t=.115926*s}return i.type="pink",i}(),n=function(){for(var t=2*l.audiocontext.sampleRate,e=l.audiocontext.createBuffer(1,t,l.audiocontext.sampleRate),i=e.getChannelData(0),n=0,o=0;o<t;o++){var s=2*Math.random()-1;i[o]=(n+.02*s)/1.02,n=i[o],i[o]*=3.5}return e.type="brown",e}();c.Noise.prototype.setType=function(t){switch(t){case"white":this.buffer=e;break;case"pink":this.buffer=i;break;case"brown":this.buffer=n;break;default:this.buffer=e}this.started&&(t=l.audiocontext.currentTime,this.stop(t),this.start(t+.01))},c.Noise.prototype.getType=function(){return this.buffer.type},c.Noise.prototype.start=function(){this.started&&this.stop(),this.noise=l.audiocontext.createBufferSource(),this.noise.buffer=this.buffer,this.noise.loop=!0,this.noise.connect(this.output);var t=l.audiocontext.currentTime;this.noise.start(t),this.started=!0},c.Noise.prototype.stop=function(){var t=l.audiocontext.currentTime;this.noise&&(this.noise.stop(t),this.started=!1)},c.Noise.prototype.dispose=function(){var t=l.audiocontext.currentTime,e=l.soundArray.indexOf(this);l.soundArray.splice(e,1),this.noise&&(this.noise.disconnect(),this.stop(t)),this.output&&this.output.disconnect(),this.panner&&this.panner.disconnect(),this.output=null,this.panner=null,this.buffer=null,this.noise=null}}(),(q=t).inputSources=[],c.AudioIn=function(t){this.input=q.audiocontext.createGain(),this.output=q.audiocontext.createGain(),this.stream=null,this.mediaStream=null,this.currentSource=null,this.enabled=!1,this.amplitude=new c.Amplitude,this.output.connect(this.amplitude.input),window.MediaStreamTrack&&window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia||(t?t():window.alert("This browser does not support MediaStreamTrack and mediaDevices")),q.soundArray.push(this)},c.AudioIn.prototype.start=function(e,i){var n=this;this.stream&&this.stop();var t=q.inputSources[n.currentSource],o={audio:{sampleRate:q.audiocontext.sampleRate,echoCancellation:!1}};q.inputSources[this.currentSource]&&(o.audio.deviceId=t.deviceId),window.navigator.mediaDevices.getUserMedia(o).then(function(t){n.stream=t,n.enabled=!0,n.mediaStream=q.audiocontext.createMediaStreamSource(t),n.mediaStream.connect(n.output),n.amplitude.setInput(n.output),e&&e()}).catch(function(t){i?i(t):console.error(t)})},c.AudioIn.prototype.stop=function(){this.stream&&(this.stream.getTracks().forEach(function(t){t.stop()}),this.mediaStream.disconnect(),delete this.mediaStream,delete this.stream)},c.AudioIn.prototype.connect=function(t){t?t.hasOwnProperty("input")?this.output.connect(t.input):t.hasOwnProperty("analyser")?this.output.connect(t.analyser):this.output.connect(t):this.output.connect(q.input)},c.AudioIn.prototype.disconnect=function(){this.output&&(this.output.disconnect(),this.output.connect(this.amplitude.input))},c.AudioIn.prototype.getLevel=function(t){return t&&(this.amplitude.smoothing=t),this.amplitude.getLevel()},c.AudioIn.prototype.amp=function(t,e){var i;e?(i=e||0,e=this.output.gain.value,this.output.gain.cancelScheduledValues(q.audiocontext.currentTime),this.output.gain.setValueAtTime(e,q.audiocontext.currentTime),this.output.gain.linearRampToValueAtTime(t,i+q.audiocontext.currentTime)):(this.output.gain.cancelScheduledValues(q.audiocontext.currentTime),this.output.gain.setValueAtTime(t,q.audiocontext.currentTime))},c.AudioIn.prototype.getSources=function(n,o){return new Promise(function(e,i){window.navigator.mediaDevices.enumerateDevices().then(function(t){q.inputSources=t.filter(function(t){return"audioinput"===t.kind}),e(q.inputSources),n&&n(q.inputSources)}).catch(function(t){i(t),o?o(t):console.error("This browser does not support MediaStreamTrack.getSources()")})})},c.AudioIn.prototype.setSource=function(t){0<q.inputSources.length&&t<q.inputSources.length?(this.currentSource=t,console.log("set source to ",q.inputSources[this.currentSource])):console.log("unable to set input source"),this.stream&&this.stream.active&&this.start()},c.AudioIn.prototype.dispose=function(){var t=q.soundArray.indexOf(this);q.soundArray.splice(t,1),this.stop(),this.output&&this.output.disconnect(),this.amplitude&&this.amplitude.disconnect(),delete this.amplitude,delete this.output},function(t){"use strict";t.Negate=function(){this._multiply=this.input=this.output=new t.Multiply(-1)},t.extend(t.Negate,t.SignalBase),t.Negate.prototype.dispose=function(){return t.prototype.dispose.call(this),this._multiply.dispose(),this._multiply=null,this},t.Negate}(it),function(e){"use strict";e.Subtract=function(t){this.createInsOuts(2,0),this._sum=this.input[0]=this.output=new e.Gain,this._neg=new e.Negate,this._param=this.input[1]=new e.Signal(t),this._param.chain(this._neg,this._sum)},e.extend(e.Subtract,e.Signal),e.Subtract.prototype.dispose=function(){return e.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this._param.dispose(),this._param=null,this},e.Subtract}(it),function(t){"use strict";t.GreaterThanZero=function(){this._thresh=this.output=new t.WaveShaper(function(t){return t<=0?0:1},127),this._scale=this.input=new t.Multiply(1e4),this._scale.connect(this._thresh)},t.extend(t.GreaterThanZero,t.SignalBase),t.GreaterThanZero.prototype.dispose=function(){return t.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},t.GreaterThanZero}(it),function(e){"use strict";e.GreaterThan=function(t){this.createInsOuts(2,0),this._param=this.input[0]=new e.Subtract(t),this.input[1]=this._param.input[1],this._gtz=this.output=new e.GreaterThanZero,this._param.connect(this._gtz)},e.extend(e.GreaterThan,e.Signal),e.GreaterThan.prototype.dispose=function(){return e.prototype.dispose.call(this),this._param.dispose(),this._param=null,this._gtz.dispose(),this._gtz=null,this},e.GreaterThan}(it),function(t){"use strict";t.Abs=function(){this._abs=this.input=this.output=new t.WaveShaper(function(t){return 0===t?0:Math.abs(t)},127)},t.extend(t.Abs,t.SignalBase),t.Abs.prototype.dispose=function(){return t.prototype.dispose.call(this),this._abs.dispose(),this._abs=null,this},t.Abs}(it),function(e){"use strict";e.Modulo=function(t){this.createInsOuts(1,0),this._shaper=new e.WaveShaper(Math.pow(2,16)),this._multiply=new e.Multiply,this._subtract=this.output=new e.Subtract,this._modSignal=new e.Signal(t),this.input.fan(this._shaper,this._subtract),this._modSignal.connect(this._multiply,0,0),this._shaper.connect(this._multiply,0,1),this._multiply.connect(this._subtract,0,1),this._setWaveShaper(t)},e.extend(e.Modulo,e.SignalBase),e.Modulo.prototype._setWaveShaper=function(e){this._shaper.setMap(function(t){return Math.floor((t+1e-4)/e)})},Object.defineProperty(e.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(t){this._modSignal.value=t,this._setWaveShaper(t)}}),e.Modulo.prototype.dispose=function(){return e.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},e.Modulo}(it),function(e){"use strict";e.Pow=function(t){this._exp=this.defaultArg(t,1),this._expScaler=this.input=this.output=new e.WaveShaper(this._expFunc(this._exp),8192)},e.extend(e.Pow,e.SignalBase),Object.defineProperty(e.Pow.prototype,"value",{get:function(){return this._exp},set:function(t){this._exp=t,this._expScaler.setMap(this._expFunc(this._exp))}}),e.Pow.prototype._expFunc=function(e){return function(t){return Math.pow(Math.abs(t),e)}},e.Pow.prototype.dispose=function(){return e.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},e.Pow}(it),function(t){"use strict";t.AudioToGain=function(){this._norm=this.input=this.output=new t.WaveShaper(function(t){return(t+1)/2})},t.extend(t.AudioToGain,t.SignalBase),t.AudioToGain.prototype.dispose=function(){return t.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},t.AudioToGain}(it),function(u){"use strict";function i(t,e,i){return t=new t,i._eval(e[0]).connect(t,0,0),i._eval(e[1]).connect(t,0,1),t}function n(t,e,i){return t=new t,i._eval(e[0]).connect(t,0,0),t}function o(t){return t?parseFloat(t):void 0}function s(t){return t&&t.args?parseFloat(t.args):void 0}u.Expr=function(){var t=this._replacements(Array.prototype.slice.call(arguments)),e=this._parseInputs(t);this._nodes=[],this.input=new Array(e);for(var i=0;i<e;i++)this.input[i]=this.context.createGain();var n,o=this._parseTree(t);try{n=this._eval(o)}catch(e){throw this._disposeNodes(),new Error("Tone.Expr: Could evaluate expression: "+t)}this.output=n},u.extend(u.Expr,u.SignalBase),u.Expr._Expressions={value:{signal:{regexp:/^\d+\.\d+|^\d+/,method:function(t){return new u.Signal(o(t))}},input:{regexp:/^\$\d/,method:function(t,e){return e.input[o(t.substr(1))]}}},glue:{"(":{regexp:/^\(/},")":{regexp:/^\)/},",":{regexp:/^,/}},func:{abs:{regexp:/^abs/,method:n.bind(this,u.Abs)},mod:{regexp:/^mod/,method:function(t,e){var i=s(t[1]),i=new u.Modulo(i);return e._eval(t[0]).connect(i),i}},pow:{regexp:/^pow/,method:function(t,e){var i=s(t[1]),i=new u.Pow(i);return e._eval(t[0]).connect(i),i}},a2g:{regexp:/^a2g/,method:function(t,e){var i=new u.AudioToGain;return e._eval(t[0]).connect(i),i}}},binary:{"+":{regexp:/^\+/,precedence:1,method:i.bind(this,u.Add)},"-":{regexp:/^\-/,precedence:1,method:function(t,e){return 1===t.length?n(u.Negate,t,e):i(u.Subtract,t,e)}},"*":{regexp:/^\*/,precedence:0,method:i.bind(this,u.Multiply)}},unary:{"-":{regexp:/^\-/,method:n.bind(this,u.Negate)},"!":{regexp:/^\!/,method:n.bind(this,u.NOT)}}},u.Expr.prototype._parseInputs=function(t){var e=t.match(/\$\d/g),i=0;if(null!==e)for(var n=0;n<e.length;n++)var o=parseInt(e[n].substr(1))+1,i=Math.max(i,o);return i},u.Expr.prototype._replacements=function(t){for(var e=t.shift(),i=0;i<t.length;i++)e=e.replace(/\%/i,t[i]);return e},u.Expr.prototype._tokenize=function(t){for(var e=-1,i=[];0<t.length;){var n=function(t){for(var e in u.Expr._Expressions){var i,n=u.Expr._Expressions[e];for(i in n){var o=n[i],s=o.regexp;if(null!==(s=t.match(s)))return{type:e,value:s[0],method:o.method}}}throw new SyntaxError("Tone.Expr: Unexpected token "+t)}(t=t.trim());i.push(n),t=t.substr(n.value.length)}return{next:function(){return i[++e]},peek:function(){return i[e+1]}}},u.Expr.prototype._parseTree=function(t){function o(t,e){return!a(t)&&"glue"===t.type&&t.value===e}function s(t,e,i){var n=u.Expr._Expressions[e];if(!a(t))for(var o in n)if((o=n[o]).regexp.test(t.value)){if(a(i))return 1;if(o.precedence===i)return 1}}var r=this._tokenize(t),a=this.isUndef.bind(this);return function n(t){for(var e=(t=a(t)?5:t)<0?function t(){var e,i;return s(r.peek(),"unary")?(i=r.next(),e=t(),{operator:i.value,method:i.method,args:[e]}):function(){var t,e=r.peek();if(a(e))throw new SyntaxError("Tone.Expr: Unexpected termination of expression");if("func"===e.type)return function(t){var e=[];if(!o(r.next(),"("))throw new SyntaxError('Tone.Expr: Expected ( in a function call "'+t.value+'"');if(o(r.peek(),")")||(e=function(){for(var t,e=[];t=n(),!a(t)&&(e.push(t),o(r.peek(),","));)r.next();return e}()),!o(r.next(),")"))throw new SyntaxError('Tone.Expr: Expected ) in a function call "'+t.value+'"');return{method:t.method,args:e,name:name}}(e=r.next());if("value"===e.type)return{method:(e=r.next()).method,args:e.value};if(o(e,"(")){if(r.next(),t=n(),!o(e=r.next(),")"))throw new SyntaxError("Expected )");return t}throw new SyntaxError("Tone.Expr: Parse error, cannot process token "+e.value)}()}():n(t-1),i=r.peek();s(i,"binary",t);)e={operator:(i=r.next()).value,method:i.method,args:[e,n(t-1)]},i=r.peek();return e}()},u.Expr.prototype._eval=function(t){if(!this.isUndef(t))return t=t.method(t.args,this),this._nodes.push(t),t},u.Expr.prototype._disposeNodes=function(){for(var t=0;t<this._nodes.length;t++){var e=this._nodes[t];this.isFunction(e.dispose)?e.dispose():this.isFunction(e.disconnect)&&e.disconnect(),this._nodes[t]=e=null}this._nodes=null},u.Expr.prototype.dispose=function(){u.prototype.dispose.call(this),this._disposeNodes()},u.Expr}(it),function(t){"use strict";t.EqualPowerGain=function(){this._eqPower=this.input=this.output=new t.WaveShaper(function(t){return Math.abs(t)<.001?0:this.equalPowerScale(t)}.bind(this),4096)},t.extend(t.EqualPowerGain,t.SignalBase),t.EqualPowerGain.prototype.dispose=function(){return t.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},t.EqualPowerGain}(it),R=function(e){"use strict";return e.CrossFade=function(t){this.createInsOuts(2,1),this.a=this.input[0]=new e.Gain,this.b=this.input[1]=new e.Gain,this.fade=new e.Signal(this.defaultArg(t,.5),e.Type.NormalRange),this._equalPowerA=new e.EqualPowerGain,this._equalPowerB=new e.EqualPowerGain,this._invert=new e.Expr("1 - $0"),this.a.connect(this.output),this.b.connect(this.output),this.fade.chain(this._equalPowerB,this.b.gain),this.fade.chain(this._invert,this._equalPowerA,this.a.gain),this._readOnly("fade")},e.extend(e.CrossFade),e.CrossFade.prototype.dispose=function(){return e.prototype.dispose.call(this),this._writable("fade"),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,this._invert.dispose(),this._invert=null,this.a.dispose(),this.a=null,this.b.dispose(),this.b=null,this},e.CrossFade}(it),E=t,V=R,c.Effect=function(){this.ac=E.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this._drywet=new V(1),this.wet=this.ac.createGain(),this.input.connect(this._drywet.a),this.wet.connect(this._drywet.b),this._drywet.connect(this.output),this.connect(),E.soundArray.push(this)},c.Effect.prototype.amp=function(t,e,i){var e=e||0,i=i||0,n=E.audiocontext.currentTime,o=this.output.gain.value;this.output.gain.cancelScheduledValues(n),this.output.gain.linearRampToValueAtTime(o,n+i+.001),this.output.gain.linearRampToValueAtTime(t,n+i+e+.001)},c.Effect.prototype.chain=function(){if(0<arguments.length){this.connect(arguments[0]);for(var t=1;t<arguments.length;t+=1)arguments[t-1].connect(arguments[t])}return this},c.Effect.prototype.drywet=function(t){return void 0!==t&&(this._drywet.fade.value=t),this._drywet.fade.value},c.Effect.prototype.connect=function(t){t=t||c.soundOut.input,this.output.connect(t.input||t)},c.Effect.prototype.disconnect=function(){this.output&&this.output.disconnect()},c.Effect.prototype.dispose=function(){var t=E.soundArray.indexOf(this);E.soundArray.splice(t,1),this.input&&(this.input.disconnect(),delete this.input),this.output&&(this.output.disconnect(),delete this.output),this._drywet&&(this._drywet.disconnect(),delete this._drywet),this.wet&&(this.wet.disconnect(),delete this.wet),this.ac=void 0},M=c.Effect,C=M,c.Filter=function(t){C.call(this),this.biquad=this.ac.createBiquadFilter(),this.input.connect(this.biquad),this.biquad.connect(this.wet),t&&this.setType(t),this._on=!0,this._untoggledType=this.biquad.type},c.Filter.prototype=Object.create(C.prototype),c.Filter.prototype.process=function(t,e,i,n){t.connect(this.input),this.set(e,i,n)},c.Filter.prototype.set=function(t,e,i){t&&this.freq(t,i),e&&this.res(e,i)},c.Filter.prototype.freq=function(t,e){return e=e||0,"number"==typeof(t=t<=0?1:t)?(this.biquad.frequency.cancelScheduledValues(this.ac.currentTime+.01+e),this.biquad.frequency.exponentialRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.biquad.frequency),this.biquad.frequency.value},c.Filter.prototype.res=function(t,e){return e=e||0,"number"==typeof t?(this.biquad.Q.value=t,this.biquad.Q.cancelScheduledValues(this.ac.currentTime+.01+e),this.biquad.Q.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.biquad.Q),this.biquad.Q.value},c.Filter.prototype.gain=function(t,e){return e=e||0,"number"==typeof t?(this.biquad.gain.value=t,this.biquad.gain.cancelScheduledValues(this.ac.currentTime+.01+e),this.biquad.gain.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.biquad.gain),this.biquad.gain.value},c.Filter.prototype.toggle=function(){return this._on=!this._on,!0===this._on?this.biquad.type=this._untoggledType:!1===this._on&&(this.biquad.type="allpass"),this._on},c.Filter.prototype.setType=function(t){this.biquad.type=t,this._untoggledType=this.biquad.type},c.Filter.prototype.dispose=function(){C.prototype.dispose.apply(this),this.biquad&&(this.biquad.disconnect(),delete this.biquad)},c.LowPass=function(){c.Filter.call(this,"lowpass")},c.LowPass.prototype=Object.create(c.Filter.prototype),c.HighPass=function(){c.Filter.call(this,"highpass")},c.HighPass.prototype=Object.create(c.Filter.prototype),c.BandPass=function(){c.Filter.call(this,"bandpass")},c.BandPass.prototype=Object.create(c.Filter.prototype),R=c.Filter,D=R,N=t,(_t.prototype=Object.create(D.prototype)).amp=function(){console.warn("`amp()` is not available for p5.EQ bands. Use `.gain()`")},_t.prototype.drywet=function(){console.warn("`drywet()` is not available for p5.EQ bands.")},_t.prototype.connect=function(t){t=t||c.soundOut.input,(this.biquad||this.output).connect(t.input||t)},_t.prototype.disconnect=function(){this.biquad&&this.biquad.disconnect()},_t.prototype.dispose=function(){var t=N.soundArray.indexOf(this);N.soundArray.splice(t,1),this.disconnect(),delete this.biquad},B=M,U=_t,c.EQ=function(t){var e;B.call(this),e=3===(t=3===t||8===t?t:3)?Math.pow(2,3):2,this.bands=[];for(var i,n,o=0;o<t;o++)n=o===t-1?(i=21e3,.01):0===o?(i=100,.1):(i=1===o?3===t?360*e:360:this.bands[o-1].freq()*e,1),this.bands[o]=this._newBand(i,n),(0<o?this.bands[o-1]:this.input).connect(this.bands[o].biquad);this.bands[t-1].connect(this.output)},c.EQ.prototype=Object.create(B.prototype),c.EQ.prototype.process=function(t){t.connect(this.input)},c.EQ.prototype.set=function(){if(arguments.length===2*this.bands.length)for(var t=0;t<arguments.length;t+=2)this.bands[t/2].freq(arguments[t]),this.bands[t/2].gain(arguments[t+1]);else console.error("Argument mismatch. .set() should be called with "+2*this.bands.length+" arguments. (one frequency and gain value pair for each band of the eq)")},c.EQ.prototype._newBand=function(t,e){return new U(t,e)},c.EQ.prototype.dispose=function(){if(B.prototype.dispose.apply(this),this.bands){for(;0<this.bands.length;)this.bands.pop().dispose();delete this.bands}},c.EQ,I=M,c.Panner3D=function(){I.call(this),this.panner=this.ac.createPanner(),this.panner.panningModel="HRTF",this.panner.distanceModel="linear",this.panner.connect(this.output),this.input.connect(this.panner)},c.Panner3D.prototype=Object.create(I.prototype),c.Panner3D.prototype.process=function(t){t.connect(this.input)},c.Panner3D.prototype.set=function(t,e,i,n){return this.positionX(t,n),this.positionY(e,n),this.positionZ(i,n),[this.panner.positionX.value,this.panner.positionY.value,this.panner.positionZ.value]},c.Panner3D.prototype.positionX=function(t,e){return e=e||0,"number"==typeof t?(this.panner.positionX.value=t,this.panner.positionX.cancelScheduledValues(this.ac.currentTime+.01+e),this.panner.positionX.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.panner.positionX),this.panner.positionX.value},c.Panner3D.prototype.positionY=function(t,e){return e=e||0,"number"==typeof t?(this.panner.positionY.value=t,this.panner.positionY.cancelScheduledValues(this.ac.currentTime+.01+e),this.panner.positionY.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.panner.positionY),this.panner.positionY.value},c.Panner3D.prototype.positionZ=function(t,e){return e=e||0,"number"==typeof t?(this.panner.positionZ.value=t,this.panner.positionZ.cancelScheduledValues(this.ac.currentTime+.01+e),this.panner.positionZ.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.panner.positionZ),this.panner.positionZ.value},c.Panner3D.prototype.orient=function(t,e,i,n){return this.orientX(t,n),this.orientY(e,n),this.orientZ(i,n),[this.panner.orientationX.value,this.panner.orientationY.value,this.panner.orientationZ.value]},c.Panner3D.prototype.orientX=function(t,e){return e=e||0,"number"==typeof t?(this.panner.orientationX.value=t,this.panner.orientationX.cancelScheduledValues(this.ac.currentTime+.01+e),this.panner.orientationX.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.panner.orientationX),this.panner.orientationX.value},c.Panner3D.prototype.orientY=function(t,e){return e=e||0,"number"==typeof t?(this.panner.orientationY.value=t,this.panner.orientationY.cancelScheduledValues(this.ac.currentTime+.01+e),this.panner.orientationY.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.panner.orientationY),this.panner.orientationY.value},c.Panner3D.prototype.orientZ=function(t,e){return e=e||0,"number"==typeof t?(this.panner.orientationZ.value=t,this.panner.orientationZ.cancelScheduledValues(this.ac.currentTime+.01+e),this.panner.orientationZ.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.panner.orientationZ),this.panner.orientationZ.value},c.Panner3D.prototype.setFalloff=function(t,e){this.maxDist(t),this.rolloff(e)},c.Panner3D.prototype.maxDist=function(t){return"number"==typeof t&&(this.panner.maxDistance=t),this.panner.maxDistance},c.Panner3D.prototype.rolloff=function(t){return"number"==typeof t&&(this.panner.rolloffFactor=t),this.panner.rolloffFactor},c.Panner3D.dispose=function(){I.prototype.dispose.apply(this),this.panner&&(this.panner.disconnect(),delete this.panner)},c.Panner3D,G=t,c.Listener3D=function(t){this.ac=G.audiocontext,this.listener=this.ac.listener},c.Listener3D.prototype.process=function(t){t.connect(this.input)},c.Listener3D.prototype.position=function(t,e,i,n){return this.positionX(t,n),this.positionY(e,n),this.positionZ(i,n),[this.listener.positionX.value,this.listener.positionY.value,this.listener.positionZ.value]},c.Listener3D.prototype.positionX=function(t,e){return e=e||0,"number"==typeof t?(this.listener.positionX.value=t,this.listener.positionX.cancelScheduledValues(this.ac.currentTime+.01+e),this.listener.positionX.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.listener.positionX),this.listener.positionX.value},c.Listener3D.prototype.positionY=function(t,e){return e=e||0,"number"==typeof t?(this.listener.positionY.value=t,this.listener.positionY.cancelScheduledValues(this.ac.currentTime+.01+e),this.listener.positionY.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.listener.positionY),this.listener.positionY.value},c.Listener3D.prototype.positionZ=function(t,e){return e=e||0,"number"==typeof t?(this.listener.positionZ.value=t,this.listener.positionZ.cancelScheduledValues(this.ac.currentTime+.01+e),this.listener.positionZ.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.listener.positionZ),this.listener.positionZ.value},c.Listener3D.prototype.orient=function(t,e,i,n,o,s,r){return 3===arguments.length||4===arguments.length?this.orientForward(t,e,i,r=n):6!==arguments.length&&7!==arguments||(this.orientForward(t,e,i),this.orientUp(n,o,s,r)),[this.listener.forwardX.value,this.listener.forwardY.value,this.listener.forwardZ.value,this.listener.upX.value,this.listener.upY.value,this.listener.upZ.value]},c.Listener3D.prototype.orientForward=function(t,e,i,n){return this.forwardX(t,n),this.forwardY(e,n),this.forwardZ(i,n),[this.listener.forwardX,this.listener.forwardY,this.listener.forwardZ]},c.Listener3D.prototype.orientUp=function(t,e,i,n){return this.upX(t,n),this.upY(e,n),this.upZ(i,n),[this.listener.upX,this.listener.upY,this.listener.upZ]},c.Listener3D.prototype.forwardX=function(t,e){return e=e||0,"number"==typeof t?(this.listener.forwardX.value=t,this.listener.forwardX.cancelScheduledValues(this.ac.currentTime+.01+e),this.listener.forwardX.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.listener.forwardX),this.listener.forwardX.value},c.Listener3D.prototype.forwardY=function(t,e){return e=e||0,"number"==typeof t?(this.listener.forwardY.value=t,this.listener.forwardY.cancelScheduledValues(this.ac.currentTime+.01+e),this.listener.forwardY.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.listener.forwardY),this.listener.forwardY.value},c.Listener3D.prototype.forwardZ=function(t,e){return e=e||0,"number"==typeof t?(this.listener.forwardZ.value=t,this.listener.forwardZ.cancelScheduledValues(this.ac.currentTime+.01+e),this.listener.forwardZ.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.listener.forwardZ),this.listener.forwardZ.value},c.Listener3D.prototype.upX=function(t,e){return e=e||0,"number"==typeof t?(this.listener.upX.value=t,this.listener.upX.cancelScheduledValues(this.ac.currentTime+.01+e),this.listener.upX.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.listener.upX),this.listener.upX.value},c.Listener3D.prototype.upY=function(t,e){return e=e||0,"number"==typeof t?(this.listener.upY.value=t,this.listener.upY.cancelScheduledValues(this.ac.currentTime+.01+e),this.listener.upY.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.listener.upY),this.listener.upY.value},c.Listener3D.prototype.upZ=function(t,e){return e=e||0,"number"==typeof t?(this.listener.upZ.value=t,this.listener.upZ.cancelScheduledValues(this.ac.currentTime+.01+e),this.listener.upZ.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):t&&t.connect(this.listener.upZ),this.listener.upZ.value},c.Listener3D,L=R,j=M,c.Delay=function(){j.call(this),this._split=this.ac.createChannelSplitter(2),this._merge=this.ac.createChannelMerger(2),this._leftGain=this.ac.createGain(),this._rightGain=this.ac.createGain(),this.leftDelay=this.ac.createDelay(),this.rightDelay=this.ac.createDelay(),this._leftFilter=new L,this._rightFilter=new L,this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._leftFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._rightFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._leftFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime),this._rightFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime),this.input.connect(this._split),this.leftDelay.connect(this._leftGain),this.rightDelay.connect(this._rightGain),this._leftGain.connect(this._leftFilter.input),this._rightGain.connect(this._rightFilter.input),this._merge.connect(this.wet),this._leftFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this._rightFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this.setType(0),this._maxDelay=this.leftDelay.delayTime.maxValue,this.feedback(.5)},c.Delay.prototype=Object.create(j.prototype),c.Delay.prototype.process=function(t,e,i,n){if(e=e||0,1<=(i=i||0))throw new Error("Feedback value will force a positive feedback loop.");if(e>=this._maxDelay)throw new Error("Delay Time exceeds maximum delay time of "+this._maxDelay+" second.");t.connect(this.input),this.leftDelay.delayTime.setValueAtTime(e,this.ac.currentTime),this.rightDelay.delayTime.setValueAtTime(e,this.ac.currentTime),this._leftGain.gain.value=i,this._rightGain.gain.value=i,n&&(this._leftFilter.freq(n),this._rightFilter.freq(n))},c.Delay.prototype.delayTime=function(t){"number"!=typeof t?(t.connect(this.leftDelay.delayTime),t.connect(this.rightDelay.delayTime)):(this.leftDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.rightDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.leftDelay.delayTime.linearRampToValueAtTime(t,this.ac.currentTime),this.rightDelay.delayTime.linearRampToValueAtTime(t,this.ac.currentTime))},c.Delay.prototype.feedback=function(t){if(t&&"number"!=typeof t)t.connect(this._leftGain.gain),t.connect(this._rightGain.gain);else{if(1<=t)throw new Error("Feedback value will force a positive feedback loop.");"number"==typeof t&&(this._leftGain.gain.value=t,this._rightGain.gain.value=t)}return this._leftGain.gain.value},c.Delay.prototype.filter=function(t,e){this._leftFilter.set(t,e),this._rightFilter.set(t,e)},c.Delay.prototype.setType=function(t){"pingPong"===(1===t&&(t="pingPong"),this._split.disconnect(),this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._split.connect(this.leftDelay,0),this._split.connect(this.rightDelay,1),t)?(this._rightFilter.setType(this._leftFilter.biquad.type),this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.rightDelay),this._rightFilter.output.connect(this.leftDelay)):(this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.leftDelay),this._rightFilter.output.connect(this.rightDelay))},c.Delay.prototype.dispose=function(){j.prototype.dispose.apply(this),this._split.disconnect(),this._leftFilter.dispose(),this._rightFilter.dispose(),this._merge.disconnect(),this._leftGain.disconnect(),this._rightGain.disconnect(),this.leftDelay.disconnect(),this.rightDelay.disconnect(),this._split=void 0,this._leftFilter=void 0,this._rightFilter=void 0,this._merge=void 0,this._leftGain=void 0,this._rightGain=void 0,this.leftDelay=void 0,this.rightDelay=void 0},Z=d,X=M,c.Reverb=function(){X.call(this),this._initConvolverNode(),this.input.gain.value=.5,this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse()},c.Reverb.prototype=Object.create(X.prototype),c.Reverb.prototype._initConvolverNode=function(){this.convolverNode=this.ac.createConvolver(),this.input.connect(this.convolverNode),this.convolverNode.connect(this.wet)},c.Reverb.prototype._teardownConvolverNode=function(){this.convolverNode&&(this.convolverNode.disconnect(),delete this.convolverNode)},c.Reverb.prototype._setBuffer=function(t){this._teardownConvolverNode(),this._initConvolverNode(),this.convolverNode.buffer=t},c.Reverb.prototype.process=function(t,e,i,n){t.connect(this.input),t=!1,e&&(this._seconds=e,t=!0),i&&(this._decay=i),n&&(this._reverse=n),t&&this._buildImpulse()},c.Reverb.prototype.set=function(t,e,i){var n=!1;t&&(this._seconds=t,n=!0),e&&(this._decay=e),i&&(this._reverse=i),n&&this._buildImpulse()},c.Reverb.prototype._buildImpulse=function(){for(var t,e=this.ac.sampleRate,i=e*this._seconds,n=this._decay,o=(e=this.ac.createBuffer(2,i,e)).getChannelData(0),s=e.getChannelData(1),r=0;r<i;r++)t=this._reverse?i-r:r,o[r]=(2*Math.random()-1)*Math.pow(1-t/i,n),s[r]=(2*Math.random()-1)*Math.pow(1-t/i,n);this._setBuffer(e)},c.Reverb.prototype.dispose=function(){X.prototype.dispose.apply(this),this._teardownConvolverNode()},c.Convolver=function(t,e,i){c.Reverb.call(this),this._initConvolverNode(),this.input.gain.value=.5,t?(this.impulses=[],this._loadBuffer(t,e,i)):(this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse())},c.Convolver.prototype=Object.create(c.Reverb.prototype),c.prototype.registerPreloadMethod("createConvolver",c.prototype),c.prototype.createConvolver=function(t,e,i){-1<window.location.origin.indexOf("file://")&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var n=this;return(i=new c.Convolver(t,function(t){"function"==typeof e&&e(t),"function"==typeof n._decrementPreload&&n._decrementPreload()},i)).impulses=[],i},c.Convolver.prototype._loadBuffer=function(n,o,i){var n=c.prototype._checkFileFormats(n),s=this,r=(new Error).stack,a=c.prototype.getAudioContext(),u=new XMLHttpRequest;u.open("GET",n,!0),u.responseType="arraybuffer",u.onload=function(){var t,e;200===u.status?a.decodeAudioData(u.response,function(t){var e={},i=n.split("/");e.name=i[i.length-1],e.audioBuffer=t,s.impulses.push(e),s._setBuffer(e.audioBuffer),o&&o(e)},function(){var t=new Z("decodeAudioData",r,s.url),e="AudioContext error at decodeAudioData for "+s.url;i?(t.msg=e,i(t)):console.error(e+"\n The error stack trace includes: \n"+t.stack)}):(t=new Z("loadConvolver",r,s.url),e="Unable to load "+s.url+". The request status was: "+u.status+" ("+u.statusText+")",i?(t.message=e,i(t)):console.error(e+"\n The error stack trace includes: \n"+t.stack))},u.onerror=function(){var t=new Z("loadConvolver",r,s.url),e="There was no response from the server at "+s.url+". Check the url and internet connectivity.";i?(t.message=e,i(t)):console.error(e+"\n The error stack trace includes: \n"+t.stack)},u.send()},c.Convolver.prototype.set=null,c.Convolver.prototype.process=function(t){t.connect(this.input)},c.Convolver.prototype.impulses=[],c.Convolver.prototype.addImpulse=function(t,e,i){-1<window.location.origin.indexOf("file://")&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this._loadBuffer(t,e,i)},c.Convolver.prototype.resetImpulse=function(t,e,i){-1<window.location.origin.indexOf("file://")&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this.impulses=[],this._loadBuffer(t,e,i)},c.Convolver.prototype.toggleImpulse=function(t){if("number"==typeof t&&t<this.impulses.length&&this._setBuffer(this.impulses[t].audioBuffer),"string"==typeof t)for(var e=0;e<this.impulses.length;e++)if(this.impulses[e].name===t){this._setBuffer(this.impulses[e].audioBuffer);break}},c.Convolver.prototype.dispose=function(){for(var t in c.Reverb.prototype.dispose.apply(this),this.impulses)this.impulses[t]&&(this.impulses[t]=null)},function(e){"use strict";e.TimelineState=function(t){e.Timeline.call(this),this._initial=t},e.extend(e.TimelineState,e.Timeline),e.TimelineState.prototype.getValueAtTime=function(t){return null!==(t=this.get(t))?t.state:this._initial},e.TimelineState.prototype.setStateAtTime=function(t,e){this.add({state:t,time:e})},e.TimelineState}(it),it=function(n){"use strict";return n.Clock=function(){n.Emitter.call(this);var t=this.optionsObject(arguments,["callback","frequency"],n.Clock.defaults);this.callback=t.callback,this._nextTick=0,this._lastState=n.State.Stopped,this.frequency=new n.TimelineSignal(t.frequency,n.Type.Frequency),this._readOnly("frequency"),this.ticks=0,this._state=new n.TimelineState(n.State.Stopped),this._boundLoop=this._loop.bind(this),this.context.on("tick",this._boundLoop)},n.extend(n.Clock,n.Emitter),n.Clock.defaults={callback:n.noOp,frequency:1,lookAhead:"auto"},Object.defineProperty(n.Clock.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),n.Clock.prototype.start=function(t,e){return t=this.toSeconds(t),this._state.getValueAtTime(t)!==n.State.Started&&this._state.add({state:n.State.Started,time:t,offset:e}),this},n.Clock.prototype.stop=function(t){return t=this.toSeconds(t),this._state.cancel(t),this._state.setStateAtTime(n.State.Stopped,t),this},n.Clock.prototype.pause=function(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)===n.State.Started&&this._state.setStateAtTime(n.State.Paused,t),this},n.Clock.prototype._loop=function(){for(var t=this.now()+this.context.lookAhead+this.context.updateInterval+2*this.context.lag;t>this._nextTick&&this._state;){var e=this._state.getValueAtTime(this._nextTick);e!==this._lastState&&(this._lastState=e,i=this._state.get(this._nextTick),e===n.State.Started?(this._nextTick=i.time,this.isUndef(i.offset)||(this.ticks=i.offset),this.emit("start",i.time,this.ticks)):e===n.State.Stopped?(this.ticks=0,this.emit("stop",i.time)):e===n.State.Paused&&this.emit("pause",i.time));var i=this._nextTick;this.frequency&&(this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick),e===n.State.Started&&(this.callback(i),this.ticks++))}},n.Clock.prototype.getStateAtTime=function(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)},n.Clock.prototype.dispose=function(){n.Emitter.prototype.dispose.call(this),this.context.off("tick",this._boundLoop),this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this._boundLoop=null,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},n.Clock}(it),Y=t,z=it,c.Metro=function(){this.clock=new z({callback:this.ontick.bind(this)}),this.syncedParts=[],this.bpm=120,this._init(),this.prevTick=0,this.tatumTime=0,this.tickCallback=function(){}},c.Metro.prototype.ontick=function(t){var n,e=t-this.prevTick,o=t-Y.audiocontext.currentTime;e-this.tatumTime<=-.02||(this.prevTick=t,(n=this).syncedParts.forEach(function(t){t.isPlaying&&(t.incrementStep(o),t.phrases.forEach(function(t){var e=t.sequence,i=n.metroTicks%e.length;0!==e[i]&&(n.metroTicks<e.length||!t.looping)&&t.callback(o,e[i])}))}),this.metroTicks+=1,this.tickCallback(o))},c.Metro.prototype.setBPM=function(t,e){var i=60/(t*this.tatums),n=Y.audiocontext.currentTime;this.tatumTime=i,e=e||0,this.clock.frequency.setValueAtTime(this.clock.frequency.value,n),this.clock.frequency.linearRampToValueAtTime(t,n+e),this.bpm=t},c.Metro.prototype.getBPM=function(){return this.clock.getRate()/this.tatums*60},c.Metro.prototype._init=function(){this.metroTicks=0},c.Metro.prototype.resetSync=function(t){this.syncedParts=[t]},c.Metro.prototype.pushSync=function(t){this.syncedParts.push(t)},c.Metro.prototype.start=function(t){var e=Y.audiocontext.currentTime;this.clock.start(e+(t||0)),this.setBPM(this.bpm)},c.Metro.prototype.stop=function(t){var e=Y.audiocontext.currentTime;this.clock.stop(e+(t||0))},c.Metro.prototype.beatLength=function(t){this.tatums=1/t/4},W=t,Q=120,c.prototype.setBPM=function(t,e){for(var i in Q=t,W.parts)W.parts[i]&&W.parts[i].setBPM(t,e)},c.Phrase=function(t,e,i){this.phraseStep=0,this.name=t,this.callback=e,this.sequence=i},c.Part=function(t,e){this.length=t||0,this.partStep=0,this.phrases=[],this.isPlaying=!1,this.noLoop(),this.tatums=e||.0625,this.metro=new c.Metro,this.metro._init(),this.metro.beatLength(this.tatums),this.metro.setBPM(Q),W.parts.push(this),this.callback=function(){}},c.Part.prototype.setBPM=function(t,e){this.metro.setBPM(t,e)},c.Part.prototype.getBPM=function(){return this.metro.getBPM()},c.Part.prototype.start=function(t){this.isPlaying||(this.isPlaying=!0,this.metro.resetSync(this),this.metro.start(t||0))},c.Part.prototype.loop=function(t){this.looping=!0,this.onended=function(){this.partStep=0},this.start(t||0)},c.Part.prototype.noLoop=function(){this.looping=!1,this.onended=function(){this.stop()}},c.Part.prototype.stop=function(t){this.partStep=0,this.pause(t)},c.Part.prototype.pause=function(t){this.isPlaying=!1,this.metro.stop(t||0)},c.Part.prototype.addPhrase=function(t,e,i){var n;if(3===arguments.length)n=new c.Phrase(t,e,i);else{if(!(t instanceof c.Phrase))throw"invalid input. addPhrase accepts name, callback, array or a p5.Phrase";n=t}this.phrases.push(n),n.sequence.length>this.length&&(this.length=n.sequence.length)},c.Part.prototype.removePhrase=function(t){for(var e in this.phrases)this.phrases[e].name===t&&this.phrases.splice(e,1)},c.Part.prototype.getPhrase=function(t){for(var e in this.phrases)if(this.phrases[e].name===t)return this.phrases[e]},c.Part.prototype.replaceSequence=function(t,e){for(var i in this.phrases)this.phrases[i].name===t&&(this.phrases[i].sequence=e)},c.Part.prototype.incrementStep=function(t){this.partStep<this.length-1?(this.callback(t),this.partStep+=1):this.looping||this.partStep!==this.length-1||(console.log("done"),this.onended())},c.Part.prototype.onStep=function(t){this.callback=t},c.Score=function(){this.parts=[],this.currentPart=0;var e,i=this;for(e in arguments)arguments[e]&&this.parts[e]&&(this.parts[e]=arguments[e],this.parts[e].nextPart=this.parts[e+1],this.parts[e].onended=function(){var t;i.resetPart(e),(t=i).currentPart++,t.currentPart>=t.parts.length?(t.scoreStep=0,t.onended()):(t.scoreStep=0,t.parts[t.currentPart-1].stop(),t.parts[t.currentPart].start())});this.looping=!1},c.Score.prototype.onended=function(){this.looping?this.parts[0].start():this.parts[this.parts.length-1].onended=function(){this.stop(),this.resetParts()},this.currentPart=0},c.Score.prototype.start=function(){this.parts[this.currentPart].start(),this.scoreStep=0},c.Score.prototype.stop=function(){this.parts[this.currentPart].stop(),this.currentPart=0,this.scoreStep=0},c.Score.prototype.pause=function(){this.parts[this.currentPart].stop()},c.Score.prototype.loop=function(){this.looping=!0,this.start()},c.Score.prototype.noLoop=function(){this.looping=!1},c.Score.prototype.resetParts=function(){var e=this;this.parts.forEach(function(t){e.resetParts[t]})},c.Score.prototype.resetPart=function(t){for(var e in this.parts[t].stop(),this.parts[t].partStep=0,this.parts[t].phrases)this.parts[t]&&(this.parts[t].phrases[e].phraseStep=0)},c.Score.prototype.setBPM=function(t,e){for(var i in this.parts)this.parts[i]&&this.parts[i].setBPM(t,e)},H=t,$=it,c.SoundLoop=function(t,e){this.callback=t,this.musicalTimeMode="number"!=typeof this._interval,this._interval=e||1,this._timeSignature=4,this._bpm=60,this.isPlaying=!1,this.maxIterations=1/0;var i=this;this.clock=new $({callback:function(t){0<(t-=H.audiocontext.currentTime)&&i.iterations<=i.maxIterations&&i.callback(t)},frequency:this._calcFreq()})},c.SoundLoop.prototype.start=function(t){var e=H.audiocontext.currentTime;this.isPlaying||(this.clock.start(e+(t||0)),this.isPlaying=!0)},c.SoundLoop.prototype.stop=function(t){var e=H.audiocontext.currentTime;this.isPlaying&&(this.clock.stop(e+(t||0)),this.isPlaying=!1)},c.SoundLoop.prototype.pause=function(t){var e=H.audiocontext.currentTime;this.isPlaying&&(this.clock.pause(e+(t||0)),this.isPlaying=!1)},c.SoundLoop.prototype.syncedStart=function(t,e){var i=e||0,n=H.audiocontext.currentTime;t.isPlaying?t.isPlaying&&(e=t.clock._nextTick-H.audiocontext.currentTime,this.clock.start(n+e),this.isPlaying=!0):(t.clock.start(n+i),t.isPlaying=!0,this.clock.start(n+i),this.isPlaying=!0)},c.SoundLoop.prototype._update=function(){this.clock.frequency.value=this._calcFreq()},c.SoundLoop.prototype._calcFreq=function(){return"number"==typeof this._interval?(this.musicalTimeMode=!1,1/this._interval):"string"==typeof this._interval?(this.musicalTimeMode=!0,this._bpm/60/this._convertNotation(this._interval)*(this._timeSignature/4)):void 0},c.SoundLoop.prototype._convertNotation=function(t){var e=t.slice(-1);switch(t=Number(t.slice(0,-1)),e){case"m":return this._measure(t);case"n":return this._note(t);default:console.warn("Specified interval is not formatted correctly. See Tone.js timing reference for more info: https://github.com/Tonejs/Tone.js/wiki/Time")}},c.SoundLoop.prototype._measure=function(t){return t*this._timeSignature},c.SoundLoop.prototype._note=function(t){return this._timeSignature/t},Object.defineProperty(c.SoundLoop.prototype,"bpm",{get:function(){return this._bpm},set:function(t){this.musicalTimeMode||console.warn('Changing the BPM in "seconds" mode has no effect. BPM is only relevant in musicalTimeMode when the interval is specified as a string ("2n", "4n", "1m"...etc)'),this._bpm=t,this._update()}}),Object.defineProperty(c.SoundLoop.prototype,"timeSignature",{get:function(){return this._timeSignature},set:function(t){this.musicalTimeMode||console.warn('Changing the timeSignature in "seconds" mode has no effect. BPM is only relevant in musicalTimeMode when the interval is specified as a string ("2n", "4n", "1m"...etc)'),this._timeSignature=t,this._update()}}),Object.defineProperty(c.SoundLoop.prototype,"interval",{get:function(){return this._interval},set:function(t){this.musicalTimeMode="Number"!=typeof t,this._interval=t,this._update()}}),Object.defineProperty(c.SoundLoop.prototype,"iterations",{get:function(){return this.clock.ticks}}),c.SoundLoop,function(){"use strict";var t=M;c.Compressor=function(){t.call(this),this.compressor=this.ac.createDynamicsCompressor(),this.input.connect(this.compressor),this.compressor.connect(this.wet)},c.Compressor.prototype=Object.create(t.prototype),c.Compressor.prototype.process=function(t,e,i,n,o,s){t.connect(this.input),this.set(e,i,n,o,s)},c.Compressor.prototype.set=function(t,e,i,n,o){void 0!==t&&this.attack(t),void 0!==e&&this.knee(e),void 0!==i&&this.ratio(i),void 0!==n&&this.threshold(n),void 0!==o&&this.release(o)},c.Compressor.prototype.attack=function(t,e){return e=e||0,"number"==typeof t?(this.compressor.attack.value=t,this.compressor.attack.cancelScheduledValues(this.ac.currentTime+.01+e),this.compressor.attack.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):void 0!==t&&t.connect(this.compressor.attack),this.compressor.attack.value},c.Compressor.prototype.knee=function(t,e){return e=e||0,"number"==typeof t?(this.compressor.knee.value=t,this.compressor.knee.cancelScheduledValues(this.ac.currentTime+.01+e),this.compressor.knee.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):void 0!==t&&t.connect(this.compressor.knee),this.compressor.knee.value},c.Compressor.prototype.ratio=function(t,e){return e=e||0,"number"==typeof t?(this.compressor.ratio.value=t,this.compressor.ratio.cancelScheduledValues(this.ac.currentTime+.01+e),this.compressor.ratio.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):void 0!==t&&t.connect(this.compressor.ratio),this.compressor.ratio.value},c.Compressor.prototype.threshold=function(t,e){return e=e||0,"number"==typeof t?(this.compressor.threshold.value=t,this.compressor.threshold.cancelScheduledValues(this.ac.currentTime+.01+e),this.compressor.threshold.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):void 0!==t&&t.connect(this.compressor.threshold),this.compressor.threshold.value},c.Compressor.prototype.release=function(t,e){return e=e||0,"number"==typeof t?(this.compressor.release.value=t,this.compressor.release.cancelScheduledValues(this.ac.currentTime+.01+e),this.compressor.release.linearRampToValueAtTime(t,this.ac.currentTime+.02+e)):"undefined"!=typeof number&&t.connect(this.compressor.release),this.compressor.release.value},c.Compressor.prototype.reduction=function(){return this.compressor.reduction.value},c.Compressor.prototype.dispose=function(){t.prototype.dispose.apply(this),this.compressor&&(this.compressor.disconnect(),delete this.compressor)},c.Compressor}(),J=t,K=h.convertToWav,tt=J.audiocontext,c.SoundRecorder=function(){this.input=tt.createGain(),this.output=tt.createGain(),this.recording=!1,this.bufferSize=1024,this._channels=2,this._clear(),this._jsNode=tt.createScriptProcessor(this.bufferSize,this._channels,2),this._jsNode.onaudioprocess=this._audioprocess.bind(this),this._callback=function(){},this._jsNode.connect(c.soundOut._silentNode),this.setInput(),J.soundArray.push(this)},c.SoundRecorder.prototype.setInput=function(t){this.input.disconnect(),this.input=null,this.input=tt.createGain(),this.input.connect(this._jsNode),this.input.connect(this.output),(t||c.soundOut.output).connect(this.input)},c.SoundRecorder.prototype.record=function(t,e,i){this.recording=!0,e&&(this.sampleLimit=Math.round(e*tt.sampleRate)),t&&i?this._callback=function(){this.buffer=this._getBuffer(),t.setBuffer(this.buffer),i()}:t&&(this._callback=function(){this.buffer=this._getBuffer(),t.setBuffer(this.buffer)})},c.SoundRecorder.prototype.stop=function(){this.recording=!1,this._callback(),this._clear()},c.SoundRecorder.prototype._clear=function(){this._leftBuffers=[],this._rightBuffers=[],this.recordedSamples=0,this.sampleLimit=null},c.SoundRecorder.prototype._audioprocess=function(t){var e;!1!==this.recording&&!0===this.recording&&(this.sampleLimit&&this.recordedSamples>=this.sampleLimit?this.stop():(e=t.inputBuffer.getChannelData(0),t=t.inputBuffer.getChannelData(1),this._leftBuffers.push(new Float32Array(e)),this._rightBuffers.push(new Float32Array(t)),this.recordedSamples+=this.bufferSize))},c.SoundRecorder.prototype._getBuffer=function(){var t=[];return t.push(this._mergeBuffers(this._leftBuffers)),t.push(this._mergeBuffers(this._rightBuffers)),t},c.SoundRecorder.prototype._mergeBuffers=function(t){for(var e=new Float32Array(this.recordedSamples),i=0,n=t.length,o=0;o<n;o++){var s=t[o];e.set(s,i),i+=s.length}return e},c.SoundRecorder.prototype.dispose=function(){this._clear();var t=J.soundArray.indexOf(this);J.soundArray.splice(t,1),this._callback=function(){},this.input&&this.input.disconnect(),this.input=null,this._jsNode=null},c.prototype.saveSound=function(t,e){t=K(t.buffer),c.prototype.writeFile([t],e,"wav")},c.PeakDetect=function(t,e,i,n){this.framesPerPeak=n||20,this.framesSinceLastPeak=0,this.decayRate=.95,this.threshold=i||.35,this.cutoff=0,this.cutoffMult=1.5,this.energy=0,this.penergy=0,this.currentValue=0,this.isDetected=!1,this.f1=t||40,this.f2=e||2e4,this._onPeak=function(){}},c.PeakDetect.prototype.update=function(t){(t=this.energy=t.getEnergy(this.f1,this.f2)/255)>this.cutoff&&t>this.threshold&&0<t-this.penergy?(this._onPeak(),this.isDetected=!0,this.cutoff=t*this.cutoffMult,this.framesSinceLastPeak=0):(this.isDetected=!1,this.framesSinceLastPeak<=this.framesPerPeak?this.framesSinceLastPeak++:(this.cutoff*=this.decayRate,this.cutoff=Math.max(this.cutoff,this.threshold))),this.currentValue=t,this.penergy=t},c.PeakDetect.prototype.onPeak=function(t,e){var i=this;i._onPeak=function(){t(i.energy,e)}},et=t,c.Gain=function(){this.ac=et.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.output),et.soundArray.push(this)},c.Gain.prototype.setInput=function(t){t.connect(this.input)},c.Gain.prototype.connect=function(t){t=t||c.soundOut.input,this.output.connect(t.input||t)},c.Gain.prototype.disconnect=function(){this.output&&this.output.disconnect()},c.Gain.prototype.amp=function(t,e,i){var e=e||0,i=i||0,n=et.audiocontext.currentTime,o=this.output.gain.value;this.output.gain.cancelScheduledValues(n),this.output.gain.linearRampToValueAtTime(o,n+i),this.output.gain.linearRampToValueAtTime(t,n+i+e)},c.Gain.prototype.dispose=function(){var t=et.soundArray.indexOf(this);et.soundArray.splice(t,1),this.output&&(this.output.disconnect(),delete this.output),this.input&&(this.input.disconnect(),delete this.input)},nt=t,c.AudioVoice=function(){this.ac=nt.audiocontext,this.output=this.ac.createGain(),this.connect(),nt.soundArray.push(this)},c.AudioVoice.prototype.play=function(t,e,i,n){},c.AudioVoice.prototype.triggerAttack=function(t,e,i){},c.AudioVoice.prototype.triggerRelease=function(t){},c.AudioVoice.prototype.amp=function(t,e){},c.AudioVoice.prototype.connect=function(t){t=t||nt.input,this.output.connect(t.input||t)},c.AudioVoice.prototype.disconnect=function(){this.output.disconnect()},c.AudioVoice.prototype.dispose=function(){this.output&&(this.output.disconnect(),delete this.output)},it=c.AudioVoice,ot=t,st=it,rt=h.noteToFreq,c.MonoSynth=function(){st.call(this),this.oscillator=new c.Oscillator,this.env=new c.Envelope,this.env.setRange(1,0),this.env.setExp(!0),this.setADSR(.02,.25,.05,.35),this.oscillator.disconnect(),this.oscillator.connect(this.output),this.env.disconnect(),this.env.setInput(this.output.gain),this.oscillator.output.gain.value=1,this.oscillator.start(),this.connect(),ot.soundArray.push(this)},c.MonoSynth.prototype=Object.create(c.AudioVoice.prototype),c.MonoSynth.prototype.play=function(t,e,i,n){this.triggerAttack(t,e,~~i),this.triggerRelease(~~i+(n||.15))},c.MonoSynth.prototype.triggerAttack=function(t,e,i){i=~~i,t=rt(t),e=e||.1,this.oscillator.freq(t,0,i),this.env.ramp(this.output.gain,i,e)},c.MonoSynth.prototype.triggerRelease=function(t){this.env.ramp(this.output.gain,t=t||0,0)},c.MonoSynth.prototype.setADSR=function(t,e,i,n){this.env.setADSR(t,e,i,n)},Object.defineProperties(c.MonoSynth.prototype,{attack:{get:function(){return this.env.aTime},set:function(t){this.env.setADSR(t,this.env.dTime,this.env.sPercent,this.env.rTime)}},decay:{get:function(){return this.env.dTime},set:function(t){this.env.setADSR(this.env.aTime,t,this.env.sPercent,this.env.rTime)}},sustain:{get:function(){return this.env.sPercent},set:function(t){this.env.setADSR(this.env.aTime,this.env.dTime,t,this.env.rTime)}},release:{get:function(){return this.env.rTime},set:function(t){this.env.setADSR(this.env.aTime,this.env.dTime,this.env.sPercent,t)}}}),c.MonoSynth.prototype.amp=function(t,e){return void 0!==t&&this.oscillator.amp(t,e||0),this.oscillator.amp().value},c.MonoSynth.prototype.connect=function(t){t=t||ot.input,this.output.connect(t.input||t)},c.MonoSynth.prototype.disconnect=function(){this.output&&this.output.disconnect()},c.MonoSynth.prototype.dispose=function(){st.prototype.dispose.apply(this),this.env&&this.env.dispose(),this.oscillator&&this.oscillator.dispose()},at=t,ut=S,ct=h.noteToFreq,c.PolySynth=function(t,e){this.audiovoices=[],this.notes={},this._newest=0,this._oldest=0,this.maxVoices=e||8,this.AudioVoice=void 0===t?c.MonoSynth:t,this._voicesInUse=new ut(0),this.output=at.audiocontext.createGain(),this.connect(),this._allocateVoices(),at.soundArray.push(this)},c.PolySynth.prototype._allocateVoices=function(){for(var t=0;t<this.maxVoices;t++)this.audiovoices.push(new this.AudioVoice),this.audiovoices[t].disconnect(),this.audiovoices[t].connect(this.output)},c.PolySynth.prototype.play=function(t,e,i,n){n=n||1,this.noteAttack(t,e,i),this.noteRelease(t,i+n)},c.PolySynth.prototype.noteADSR=function(t,e,i,n,o,s){var r=at.audiocontext.currentTime,s=s||0;this.audiovoices[this.notes[t].getValueAtTime(r+s)].setADSR(e,i,n,o)},c.PolySynth.prototype.setADSR=function(e,i,n,o){this.audiovoices.forEach(function(t){t.setADSR(e,i,n,o)})},c.PolySynth.prototype.noteAttack=function(t,e,i){var n,i=~~i,o=at.audiocontext.currentTime+i,t=ct(t),e=e||.1;this.notes[t]&&null!==this.notes[t].getValueAtTime(o)&&this.noteRelease(t,0),this._voicesInUse.getValueAtTime(o)<this.maxVoices?n=Math.max(~~this._voicesInUse.getValueAtTime(o),0):(n=this._oldest,s=c.prototype.freqToMidi(this.audiovoices[this._oldest].oscillator.freq().value),this.noteRelease(s),this._oldest=(this._oldest+1)%(this.maxVoices-1)),this.notes[t]=new ut,this.notes[t].setValueAtTime(n,o);var s=null===this._voicesInUse._searchBefore(o)?0:this._voicesInUse._searchBefore(o).value;this._voicesInUse.setValueAtTime(s+1,o),this._updateAfter(o,1),this._newest=n,"number"==typeof e&&(e=(o=1/this._voicesInUse.getValueAtTime(o)*2)<e?o:e),this.audiovoices[n].triggerAttack(t,e,i)},c.PolySynth.prototype._updateAfter=function(t,e){null!==this._voicesInUse._searchAfter(t)&&(this._voicesInUse._searchAfter(t).value+=e,t=this._voicesInUse._searchAfter(t).time,this._updateAfter(t,e))},c.PolySynth.prototype.noteRelease=function(t,e){var i=at.audiocontext.currentTime,n=e||0,e=i+n;if(t)i=ct(t),this.notes[i]&&null!==this.notes[i].getValueAtTime(e)?(t=Math.max(~~this._voicesInUse.getValueAtTime(e).value,1),this._voicesInUse.setValueAtTime(t-1,e),0<t&&this._updateAfter(e,-1),this.audiovoices[this.notes[i].getValueAtTime(e)].triggerRelease(n),this.notes[i].dispose(),delete this.notes[i],this._newest=0===this._newest?0:(this._newest-1)%(this.maxVoices-1)):console.warn("Cannot release a note that is not already playing");else for(var o in this.audiovoices.forEach(function(t){t.triggerRelease(n)}),this._voicesInUse.setValueAtTime(0,e),this.notes)this.notes[o].dispose(),delete this.notes[o]},c.PolySynth.prototype.connect=function(t){t=t||at.input,this.output.connect(t.input||t)},c.PolySynth.prototype.disconnect=function(){this.output&&this.output.disconnect()},c.PolySynth.prototype.dispose=function(){this.audiovoices.forEach(function(t){t.dispose()}),this.output&&(this.output.disconnect(),delete this.output)},ht=M,c.Distortion=function(t,e){if(ht.call(this),"number"!=typeof(t=void 0===t?.25:t))throw new Error("amount must be a number");if("string"!=typeof(e=void 0===e?"2x":e))throw new Error("oversample must be a String");t=c.prototype.map(t,0,1,0,2e3),this.waveShaperNode=this.ac.createWaveShaper(),this.amount=t,this.waveShaperNode.curve=gt(t),this.waveShaperNode.oversample=e,this.input.connect(this.waveShaperNode),this.waveShaperNode.connect(this.wet)},c.Distortion.prototype=Object.create(ht.prototype),c.Distortion.prototype.process=function(t,e,i){t.connect(this.input),this.set(e,i)},c.Distortion.prototype.set=function(t,e){t&&(t=c.prototype.map(t,0,1,0,2e3),this.amount=t,this.waveShaperNode.curve=gt(t)),e&&(this.waveShaperNode.oversample=e)},c.Distortion.prototype.getAmount=function(){return this.amount},c.Distortion.prototype.getOversample=function(){return this.waveShaperNode.oversample},c.Distortion.prototype.dispose=function(){ht.prototype.dispose.apply(this),this.waveShaperNode&&(this.waveShaperNode.disconnect(),this.waveShaperNode=null)}});