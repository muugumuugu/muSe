function metaballmetaShader(t){var e=`
    precision highp float;
    varying vec2 vTexCoord;
    const float WIDTH=${t.windowWidth}.;
    const float HEIGHT=${t.windowHeight}.;
    uniform vec3 metaballarray[64];
    void main() {
      float x=vTexCoord.x*WIDTH;
      float y=HEIGHT-vTexCoord.y*HEIGHT;
      float r=0.;
      for (int i=0;i<64;i++) {
        vec3 b=metaballarray[i];
        r+=b.z*b.z/((b.x-x)*(b.x-x)+(b.y-y)*(b.y-y));
      }
      //r=pow(r,3./4.);
      float g=(r-.5)*2.;
      float b=(r-5./6.)*6.;
      gl_FragColor = vec4(r,g,b,1.);
    }
  `;return new p5.Shader(t._renderer,`
    precision highp float;
    attribute vec3 aPosition;
    attribute vec2 aTexCoord;
    varying vec2 vTexCoord;
    void main() {
      vTexCoord = aTexCoord;
      vec4 positionVec4=vec4(aPosition,1.);
      positionVec4.xy=positionVec4.xy*2.-1.;
      gl_Position = positionVec4;
    }
  `,e)}p5Viz.barGraph=function(e){e.mountaineering=!1,e.softspikyT=!1,e.spoolingKeratin=!1,e.vinylMode=!1,e.colorMode(e.HSB,360,100,100,100),e.rectMode(e.CORNER),e.clear();var i=e.fft.analyze();e.stroke(0),e.strokeWeight(1);for(let t=0;t<.6*i.length;t+=7)1==e.rainbow?e.fill(360*t/(.6*i.length),100,100,20):e.fill(0,0,100*t/(.6*i.length),40),e.rect(t*e.width/(.6*i.length),e.height,3.5*e.width/(.6*i.length),-i[t]*e.height*.8/255)},p5Viz.blobbyboxesVars=function(t){t.blobang=0},p5Viz.blobbyboxes=function(i){i.mountaineering=!1,i.spoolingKeratin=!1,i.softspikyT=!1,i.vinylMode=!1,i.noStroke(),i.clear(),i.colorMode(i.HSB,6,100,100,100),i.fft.analyze(),i.peakD.update(i.fft),i.blobang-=.4*Math.sin(i.peakD.penergy*Math.PI/2);var r=.4*i.width/18,o=i.height/10;for(let e=-9;e<9;e++)for(let t=-9;t<9;t++){var a=o*Math.cos(.55*Math.sqrt(e*e+t*t)+i.blobang),s=e*r-r/2,n=e*r+r/2,h=t*r-r/2,l=t*r+r/2,c=i.width/2,p=i.height/2,d=s-h+c,u=.5*(s+h)+p,g=s-l+c,f=.5*(s+l)+p,s=n-l+c,l=.5*(n+l)+p,c=n-h+c,p=.5*(n+h)+p;i.fill(2),i.quad(g,f-a,s,l-a,s,40+l,g,40+f),i.fill(4),i.quad(s,l-a,c,p-a,c,40+p,s,40+l),i.rainbow?i.fill(3*(a+o)/o,100,100,80):i.fill(16+2*a/o),i.quad(d,u-a,g,f-a,s,l-a,c,p-a)}},p5Viz.bouncyVars=function(t){for(t.bps=[],t.yvs=[],t.yys=[],t.bouncySize=Math.min(t.width,t.height)/8,i=0;i<8;i++)for(j=0;j<8;j++)t.bps.push(t.createVector(i*t.bouncySize-4*t.bouncySize,j*t.bouncySize-4*t.bouncySize)),t.yys.push(2*-t.bouncySize),t.yvs.push(.5)},p5Viz.bouncy=function(t){t.mountaineering=!1,t.spoolingKeratin=!1,t.softspikyT=!1,t.vinylMode=!1,t.colorMode(t.HSB,360,100,100,100);var e=t.fft.analyze();for(t.clear(),t.noStroke(),t.translate(t.width/2,t.height/1.5),i=0;i<8;i++)for(j=0;j<8;j++){var r=8*i+j,o=t.bps[r],a=o.x-o.y,s=(o.x+o.y)/2;t.fill(0,0,100-100*Math.abs(a)/t.width,50+50*s/t.height),t.rainbow&&t.fill(5*(8*i+j),100,100,50+50*s/t.height),t.circle(a,s+t.yys[r]-t.bouncySize/2,t.bouncySize);o=Math.max(t.bouncySize/4,t.bouncySize+t.yys[r]/2);t.fill(5*(8*i+j),50),t.rainbow&&t.fill(5*(8*i+j),100,80,30),t.ellipse(a,s,o,o/2),25<e[640*r/64]&&(t.yvs[r]+=.8,t.yys[r]+=t.yvs[r],0<t.yys[r]&&(t.yys[r]=0,t.yvs[r]*=-1),3==Math.ceil(10*Math.abs(t.yvs[r]))&&(t.yvs[r]=.5,t.yys[r]=2*-t.bouncySize))}},p5Viz.brushVars=function(t){t.paintdots=[]},p5Viz.brush=function(i){i.mountaineering=!1,i.spoolingKeratin=!1,i.softspikyT=!1,i.vinylMode=!1,i.clear(),i.colorMode(i.HSB,360,255,255,255),i.scale(8,4),i.strokeWeight(.5),i.paintdots.push(i.fft.analyze());let r=[];for(let e=0;e<i.paintdots.length;e++){for(let t=0;t<600;t+=5){i.rainbow?i.stroke(360*t/600,255,255):i.stroke(360*t/600);var o=5+.25*i.height*Math.log(1+i.paintdots[e][t])/Math.log(256);i.point(e,o),e==i.paintdots.length-1&&r.push(o)}i.paintdots.length>i.width/8&&(i.paintdots=[])}i.strokeWeight(.25);for(let t=0;t<120;t+=2)i.rainbow?i.stroke(360*t/120,255,255):i.stroke(360*t/120),i.line(i.width/8,0,i.paintdots.length,r[t])},p5Viz.carpetVars=function(t){t.carpetWind=0},p5Viz.carpet=function(i){i.mountaineering=!1,i.spoolingKeratin=!1,i.softspikyT=!1,i.vinylMode=!1,i.noStroke(),i.colorMode(i.HSB,100),i.clear(),i.noStroke(),i.fft.analyze(),i.peakD.update(i.fft),spec=i.map(Math.log(1e3+i.fft.getCentroid())/Math.log(2),10,14,.8,9),i.carpetWind+=spec,i.translate(i.width/2,i.height/3);var r=.7*Math.min(i.width,i.height);for(let e=0;e<r;e+=15)for(let t=0;t<r;t+=15){var o=i.noise(e/300,(i.carpetWind+t)/300,i.frameCount/100)*(.8+Math.log(i.peakD.penergy+1)/Math.log(1.5))*300,a=.894*(e-t),s=-o-.447*(e+t),n=Math.max(.4,8-(t+e)/r*.67),h=20*n;i.rainbow?i.fill(Math.abs(o/2.5),100,h):i.fill(Math.abs(o/2.5),h),i.ellipse(a,s+.7*i.height,n,n)}},p5Viz.clothdotspectrumVars=function(i){i.clothBound=.5*Math.min(i.windowWidth,i.windowHeight),i.clothdots=[];for(let e=0;e<=i.clothBound;e+=10)for(let t=0;t<=i.clothBound;t+=10){var r=i.sq(e-i.clothBound/2)+i.sq(t-i.clothBound/2),r=new i.clothdot(.5*r/i.sq(i.clothBound/2),e,0,t);i.clothdots.push(r)}i.clothspec=[]},p5Viz.isoX=function(t,e,i,r){return(t-i)*Math.cos(.46365)+r.width/2},p5Viz.isoY=function(t,e,i,r){return 0-(e+(t+i)*Math.sin(.46365))+r.height/2},p5Viz.clothdot=class{constructor(t,e,i,r){this.po={x:e,y:i,z:r},this.id=t}draw(t,e){var i=.99+(1-this.id)/1e3;let r=81*Math.log(1+e.clothspec[e.floor(625*this.id)])/Math.log(16);var o=e.noise((this.po.x+t)/300,this.po.z/300,this.po.y/250);r<51&&(r=51);var a=r*o;a*=i;var s=p5Viz.isoX(this.po.x,this.po.y+a,this.po.z,e),t=p5Viz.isoY(this.po.x,this.po.y+a,this.po.z,e),o=Math.max(2,9-(this.po.z+this.po.x)/100);1==e.rainbow?(e.stroke(e.map(a,1,81*i,600,360)%360,100,e.map(a,0,162,70,100)),e.fill(e.map(a,1,81*i,600,360)%360,100,e.map(a,0,162,70,100))):(e.stroke(e.map(a,1,81*i,0,200),e.map(a,0,162,70,100)),e.fill(e.map(a,1,81*i,0,200),e.map(a,0,162,70,100))),e.ellipse(s,t+.45*e.height,o,o)}},p5Viz.clothdotspectrum=function(i){i.mountaineering=!1,i.spoolingKeratin=!1,i.softspikyT=!1,i.vinylMode=!1,i.mountaineering=!1,i.softspikyT=!1,i.colorMode(i.HSB,360,100,100,100),i.clothspec=i.fft.analyze(),i.clear();for(let e=0;e<i.clothdots.length;e++){let t=i.clothdots[e];t.draw(4*i.frameCount-4,i)}},p5Viz.cloudynightVars=function(e){e.clouds=50,e.cloudyMoonRotAng=0,e.cloudyMoonsEdge=e.dividemoonedge(500),e.cloudyMoonSpools=e.cloudyMoonSpoolIt(1e3,500),e.starsincloudysky=[];for(let t=0;t<800;t++)e.starsincloudysky.push(new p5Viz.Star4cloudy(e))},p5Viz.dividemoonedge=function(e){let i=[];for(let t=0;t<e;t++){var r=2*t*Math.PI/e,o=Math.cos(r),r=Math.sin(r);i.push([o,r])}return i},p5Viz.cloudyMoonSpoolIt=function(t,e){let r=[];for(i=0;i<t;i++)i1=Math.floor(Math.random()*e),i2=Math.floor(Math.random()*e),r.push([i1,i2]);return r},p5Viz.drawClouds=function(i){for(let e=0;e<i.clouds;e++)for(let t=0;t<i.clouds;t++)xx=e*i.width/i.clouds-i.width/2+.5*i.width/i.clouds,yy=t*i.height/i.clouds-i.height/2+.5*i.height/i.clouds,1==i.rainbow?i.fill(i.frameCount%360,100*i.noise(e/10,t/10,i.frameCount/10),80,10):i.fill(540*i.noise(e/10,t/10,i.frameCount/10)%360,10),i.rect(xx,yy,2*i.width/i.clouds,2*i.height/i.clouds)},p5Viz.Star4cloudy=function(t){this.x=2*Math.random()*t.width-t.width,this.y=2*Math.random()*t.height-t.height,this.z=Math.random()*t.width,this.update=function(t,e){this.z=this.z-e,this.z<1&&(this.z=t.width,this.x=2*Math.random()*t.width-t.width,this.y=2*Math.random()*t.height-t.height)},this.show=function(t){var e=this.x/this.z*t.width,i=this.y/this.z*t.height,r=7-7*this.z/t.width;1==t.rainbow?t.fill(t.frameCount%360,100,100,20):t.fill(360,20),t.ellipse(e,i,3*r,3*r),1==t.rainbow?t.fill(t.frameCount%360,100,100,50):t.fill(360,50),t.ellipse(e,i,2*r,2*r),1==t.rainbow?t.fill(t.frameCount%360,100,100,100):t.fill(360,100),t.rect(e,i,r,r)}},p5Viz.cloudynight=function(e){e.mountaineering=!1,e.spoolingKeratin=!1,e.softspikyT=!1,e.vinylMode=!1,e.clear(),e.fft.analyze(),e.rectMode(e.CENTER),e.noStroke(),e.translate(e.width/2,e.height/2),e.fill(0,0,0,10),e.rect(0,0,e.width,e.height),e.colorMode(e.HSB,360,100,100,255),p5Viz.drawClouds(e),e.peakD.update(e.fft);var t=Math.log(1+e.peakD.penergy),i=100+t*t*t*8e3;for(let t=0;t<e.starsincloudysky.length;t++)e.starsincloudysky[t].update(e,i),e.starsincloudysky[t].show(e);e.colorMode(e.RGB,255,255,255,255);t=e.constrain((1e3+e.fft.getCentroid())/9e3,.3,1);e.cloudyMoonRotAng+=t*t,r=Math.min(e.width,e.height)/7,e.translate(0,r/2),e.rotate(45*e.cloudyMoonRotAng),e.strokeWeight(.5),e.stroke(150,80),e.noFill();for(let t=0;t<1e3;t++){var o=e.cloudyMoonsEdge[e.cloudyMoonSpools[t][0]],a=e.cloudyMoonsEdge[e.cloudyMoonSpools[t][1]];e.line(r*o[0],r*o[1],r*a[0],r*a[1])}},p5Viz.constellationsVars=function(e){e.constelStarsNum=216,e.constellStarSpeed=1.5,e.constellStarPositions=[],e.constellStarVels=[],e.boundingBoxOffset=.125*e.min(e.windowWidth,e.windowHeight);for(let t=0;t<e.constelStarsNum;t++)e.constellStarPositions.push(e.createVector(Math.random()*(e.width+2*e.boundingBoxOffset)-e.boundingBoxOffset,Math.random()*(e.height+2*e.boundingBoxOffset)-e.boundingBoxOffset)),e.constellStarVels.push(p5.Vector.random2D().mult(e.constellStarSpeed))},p5Viz.meshsphere=function(t,e,r,o,a){for(i=0;i<.5*r;i++)h=2*i,rr=r*Math.cos(Math.asin(h/r)),a.ellipse(t,e-h,2*rr*1.3,2*rr),a.ellipse(t,e+h,2*rr*1.3,2*rr),i%2==1&&o&&(a.ellipse(t-h,e,.9*rr*2,2*rr*1.3),a.ellipse(t+h,e,.9*rr*2,2*rr*1.3))},p5Viz.constellations=function(i){i.mountaineering=!1,i.spoolingKeratin=!1,i.softspikyT=!1,i.vinylMode=!1,i.ctx.save(),i.ctx.shadowBlur=10,i.ctx.shadowColor="white",i.clear(),i.colorMode(i.HSB,255,100,100,255),i.noFill(),i.fft.analyze();var r=i.map(i.fft.getCentroid(),800,8e3,0,.25*Math.min(i.width,i.height)),o=8+i.amp.getLevel()*(-8+i.constelStarsNum);1==i.rainbow?i.stroke(i.frameCount%256,100,100):i.stroke(255);var t=i.noise(i.frameCount/1e3)*i.width,e=i.noise(12323+i.frameCount/1e3)*i.height;i.peakD.update(i.fft),i.strokeWeight(.5),i.meshsphere(t,e,8+64*i.peakD.penergy,!1,i);for(let e=0;e<o;e++){-5<=i.constellStarPositions[e].x&&i.constellStarPositions[e].x<=i.width+5&&-5<=i.constellStarPositions[e].y&&i.constellStarPositions[e].y<=i.height+5&&(1==i.rainbow?i.stroke(255*e/o,100,100):i.stroke(0),i.strokeWeight(10),i.point(i.constellStarPositions[e].x,i.constellStarPositions[e].y));for(let t=e+1;t<o;t++){var a=p5.Vector.dist(i.constellStarPositions[e],i.constellStarPositions[t]);a<=r&&(1==i.rainbow?i.stroke(255*t/(o-e),100,100,i.map(a,0,r,255,0)):i.stroke(255,i.map(a,0,r,255,0)),i.strokeWeight(3),i.line(i.constellStarPositions[e].x,i.constellStarPositions[e].y,i.constellStarPositions[t].x,i.constellStarPositions[t].y))}i.constellStarPositions[e].add(i.constellStarVels[e]),i.constellStarPositions[e].x<0-i.boundingBoxOffset&&(i.constellStarPositions[e].x=i.width+i.boundingBoxOffset),i.constellStarPositions[e].x>i.width+i.boundingBoxOffset&&(i.constellStarPositions[e].x=0-i.boundingBoxOffset),i.constellStarPositions[e].y<0-i.boundingBoxOffset&&(i.constellStarPositions[e].y=i.height+i.boundingBoxOffset),i.constellStarPositions[e].y>i.height+i.boundingBoxOffset&&(i.constellStarPositions[e].y=0-i.boundingBoxOffset)}i.ctx.restore()},p5Viz.coronaball=function(t){t.mountaineering=!1,t.spoolingKeratin=!1,t.softspikyT=!1,t.vinylMode=!1,t.clear(),t.gph.colorMode(t.HSB,360,255,255,255),t.gph.angleMode(t.DEGREES),t.gph.clear(),t.gph.push(),t.gph.rotateZ(t.frameCount),t.gph.rotateX(t.frameCount/3),t.gph.rotateY(t.frameCount/5);var e=Math.min(t.gph.width,t.gph.height)/4,r=4*e/30,o=e/2,a=t.fft.analyze();for(i=0,t.gph.noStroke(),t.gph.fill(t.frameCount%360,255,100,100),t.gph.sphere(e/2),long=-180;long<180;long+=30)for(lat=0;lat<360;lat+=30)i++,x=0,y=0,z=e,t.gph.push(),t.gph.rotateX(lat),t.gph.rotateY(long),t.gph.noStroke(),t.gph.fill(t.frameCount%360,255,255,100),t.gph.translate(x,y,z),h=Math.random()*o/10+2*o*a[Math.floor(t.map(i,0,145,0,512))]/255,t.gph.box(r,r,h),t.gph.pop();t.gph.angleMode(t.RADIANS),t.gph.pop(),imW=Math.min(t.width,t.height),t.imageMode(t.CENTER),t.image(t.gph,t.width/2,t.height/2,imW,imW),t.imageMode(t.CORNER)},p5Viz.customViz=function(t,e){return!1},p5Viz.customVars=function(t){return!1},p5Viz.customVars=function(t){},p5Viz.customViz=function(t,e){e},p5Viz.inkdanceVars=function(t){t.inkwid=.64*t.min(t.windowWidth,t.windowHeight)},p5Viz.dancingink=function(t){t.mountaineering=!1,t.spoolingKeratin=!1,t.softspikyT=!1,t.vinylMode=!1,t.colorMode(t.RGB,255,255,255,100),t.noStroke();var e=t.fft.analyze(),r=e.length,o=t.width/2,a=t.round(.01*t.inkwid);t.clear(),t.beginShape();var s=.195*t.height;for(i=0;i<r;i++){var n=t.width*i/r,h=t.map(e[i],0,255,t.height,s),l=255-h/(.805*t.height)*255,c=h/(.83*t.height)*255,p=255*Math.random();t.rainbow?t.fill(l,c,p,100):t.fill((l+c+p)/3,100);p=h%a+Math.random()*t.inkwid*.037;i<.5*r?(t.ellipse(o+n/2,h,p,p),t.ellipse(o-n/2,h,p,p)):(t.ellipse(.5*o+n/2,h,p,p),t.ellipse(1.5*o-n/2,h,p,p)),t.endShape()}},p5Viz.elasticircleVars=function(t){t.elastiR=.0712*t.min(t.windowWidth,t.windowHeight)},p5Viz.logMap=function(t,e,i,r,o){return r=Math.log(r),o=Math.log(o),Math.exp(r+(t-e)/(i-e)*(o-r))},p5Viz.drawelastipoly=function(e,i,r,o){o.beginShape();for(let t=0;t<100;t++){var a=o.map(o.fft.analyze()[4*t],0,255,0,6.4*o.elastiR);o.curveVertex(o.cos(360*t/100)*(o.elastiR+o.logMap(a,o.width,0,e,45)+r),o.sin(360*t/100)*(o.elastiR+o.logMap(a,o.height,0,i,45)+r))}o.endShape(o.CLOSE)},p5Viz.elasticircle=function(e){e.mountaineering=!1,e.spoolingKeratin=!1,e.softspikyT=!1,e.vinylMode=!1,e.clear(),e.colorMode(e.HSB,512,100,100,100),e.strokeWeight(4),e.noFill(),e.translate(e.width/2,e.height/2+.12*e.height),e.rotate(e.frameCount);var i,r=e.map(e.sq(e.amp.getLevel()),0,1,-5,5);for(let t=0;t<8;t++)1==e.rainbow?e.stroke(e.map(t+e.frameCount%8,0,16,0,512),100,100,12.5*(t+1)):(i=e.map(t+e.frameCount%8,0,16,0,768)%512,e.stroke(2*Math.abs(256-i),12.5*(t+1))),p5Viz.drawelastipoly((8+t+1)*e.elastiR,(16-t+1)*e.elastiR,r,e)},p5Viz.emoji=function(t){t.mountaineering=!1,t.spoolingKeratin=!1,t.softspikyT=!1,t.vinylMode=!1,t.clear(),t.colorMode(t.RGB,255,255,255,255),t.translate(t.width/2,t.height/2),t.scale(10*Math.min(t.width,t.height)/600),t.noStroke(),loud=5*t.amp.getLevel(),t.fill(255,218,0),t.ellipse(0,0,40),t.fill(0,0,0),t.arc(0,10,10+5*loud,1+10*loud,0,180),loud<2.5?(t.fill(255,255,255),t.ellipse(10,0,15,15-loud),t.ellipse(-10,0,15,15-loud),t.fill(0,0,0),t.ellipse(10,0,5+2*loud),t.ellipse(-10,0,5+2*loud)):(t.arc(10,0,10,5,0,180),t.arc(-10,0,10,5,0,180)),2.5<loud&&(t.fill(255,78,83),t.arc(0,10,10,5+10*loud,0,180))},p5Viz.envelopeVars=function(t){t.envelopewaveHeight=t.height/3,t.envelopehalfHeight=t.height/2,t.enveloperandDelay=t.width/10,t.envelopdrawIndex=0,t.envelopstartTime=0,t.envelopsoundWave=[]},p5Viz.init=function(t){t.clear();t.envelopefreq1=2*t.envelopeSpec[0]*Math.PI/1e4,t.envelopefreq2=2*t.envelopeSpec[1]*Math.PI/1e4,t.enveloperingRatio=.5*Math.random()+.25,t.modXTime=(.5*Math.random()+.5)**3*3,t.createWaveEnvelope(t)},p5Viz.createWaveEnvelope=function(e){e.envelopsoundWave=[];for(let t=0;t<5e4;t++){var i=Math.sin(t*e.envelopefreq1),r=Math.sin(t*e.envelopefreq2),o=t/1e4,a=o*e.modXTime,a=a/Math.pow(a,a),a=e.lerp(i,i*r,e.enveloperingRatio*a),o=o/Math.pow(o,o);e.envelopsoundWave.push(a*o)}},p5Viz.refreshwaveEnvelope=function(t){t.envelopeSpec=t.fft.analyze().sort(function(t,e){return e-t}),Date.now()-t.envelopstartTime<2500||(t.init(t),t.envelopstartTime=Date.now(),t.envelopdrawIndex=0)},p5Viz.envelope=function(t){t.mountaineering=!1,t.spoolingKeratin=!1,t.softspikyT=!1,t.vinylMode=!1,t.refreshwaveEnvelope(t),t.colorMode(t.HSB,255,255,255,255),t.rainbow?t.fill(t.frameCount%256,255,255,100):t.fill(255,150),t.noStroke(),t.rectMode(t.CORNER);for(var e=Math.min(5e4,t.envelopdrawIndex+1e3);t.envelopdrawIndex<e;t.envelopdrawIndex++){var i=t.envelopdrawIndex/5e4*t.width+Math.pow(Math.random(),7)*t.enveloperandDelay;t.rect(i,t.envelopehalfHeight-t.envelopsoundWave[t.envelopdrawIndex]*t.envelopewaveHeight,1,1)}49999<=t.envelopdrawIndex&&(t.envelopdrawIndex=0)},p5Viz.fibbonociVars=function(t){t.PHI=(Math.sqrt(5)+1)/2},p5Viz.fibbonoci=function(e){e.mountaineering=!1,e.spoolingKeratin=!1,e.softspikyT=!1,e.vinylMode=!1,e.colorMode(e.HSB,360,100,100,100),e.clear(),e.noStroke();e.fft.analyze();var i=Math.sin(.05*Math.PI+.45*Math.PI*e.fft.getCentroid()/8e3),r=.8*Math.min(e.width,e.height)*(1-i/3),o=e.sq((Math.max(Math.min(1-r/e.height,.9),.1)-.1)/.8*Math.sqrt(r));let a=0;e.translate(e.width/2,e.height/2),e.rotate(e.frameCount/3);for(let t=o;t<r;t++){var s=Math.sqrt(t/r*e.sq(Math.min(e.width,e.height)/2)),n=Math.cos(a)*s,h=Math.sin(a)*s,s=150*Math.pow((r-t)/e.sq(r),.33)*i;e.rainbow?e.fill(360*i,100,100,10+50*i):e.fill(0,0,100*i,10+50*i),e.ellipse(n,h,s,s),a+=2*Math.PI*e.PHI,a%=2*Math.PI}for(let t=0;t<360;t+=1){var l=t*Math.cos(t),c=t*Math.sin(t);e.rainbow?e.fill(360-360*i,100,100,10+50*i):e.fill(0,0,100-100*i,10+50*i),e.ellipse(i*l*.85,i*c*.85,i*t/15,i*t/15)}},p5Viz.fiberlines=function(o){o.mountaineering=!1,o.spoolingKeratin=!1,o.softspikyT=!1,o.vinylMode=!1,o.clear(),o.colorMode(o.HSB,600,100,100,255);var a=o.height/10+1,s=o.width/10+1;spectrum=o.fft.analyze();for(let r=0;r<a;r++){o.beginShape(),o.stroke(2*Math.abs(300-o.frameCount/100%600),100),o.noFill(),o.strokeWeight(2);for(let i=0;i<s;i++){var n=Math.floor(o.map(r*s+i,0,a*s,0,600));o.rainbow&&o.stroke((n+o.frameCount)%600,100,100,100);let t=100*Math.sin(o.map(spectrum[(n+o.frameCount)%600],0,255,Math.PI/4,Math.PI/1.2));0==o.amp.getLevel()&&(t/=2);let e=t*o.map(o.noise(.1*r,.15*i,.02*o.frameCount),0,1,-1,1);0<e&&(e=0),o.vertex(10*i,e+10*r+10)}o.endShape()}},p5Viz.hillcityVars=function(e){e.hilllayers=[];for(let t=0;t<8;t++){var i=.25*e.height*(1+3*t/7),r=360-360*t/7,o=.5+24.5*t/7;e.hilllayers.push(new p5Viz.Landscape(i,r,o,e))}for(let t=0;t<500;t++)for(let t=0;t<e.hilllayers.length;t++){var a=.5+9.5*t/e.hilllayers.length;e.hilllayers[t].update(a,e)}e.snow=[];for(let t=0;t<100;t++)e.snow.push([Math.random()*e.width,Math.random()*e.height]);e.buildingHeights=[]},p5Viz.snowit=function(e){e.stroke(0,0,100,255),e.strokeWeight(4),e.translate(0,0);for(let t=0;t<100;t++)e.snow[t][0]+=10*e.cos(t),e.snow[t][0]%=e.width,e.snow[t][1]+=e.frameCount/100,e.snow[t][1]%=e.height,e.point(e.snow[t][0],e.snow[t][1]);e.noStroke()},p5Viz.Horizon=class{constructor(t,e){this.offsety=e,this.storedoffset=e,this.foffsety=e,this.x=t,this.y=e+50*Math.random()-25}update(t,e,i,r){this.offsety=this.storedoffset+t,this.foffsety=this.foffsety+.01*(this.offsety-this.foffsety),this.x=this.x-e,this.x<=0&&(this.x=r.width,this.y=this.foffsety+2*Math.random()*i-i)}},p5Viz.Landscape=class{constructor(e,t,i,r){this.res=i,this.shade=t,this.timer=0,this.horizons=[];for(let t=0;t<1e3;t++){var o=r.width*t/1e3;this.horizons.push(new p5Viz.Horizon(o,e))}}update(e,i){this.timer=this.timer-3,this.timer<0&&(this.yy=200*Math.random()-100,this.timer=Math.floor(200*Math.random()));for(let t=0;t<this.horizons.length;t++)this.horizons[t].update(this.yy,e,this.res,i)}display(e){e.push(),e.scale(1.5,1),e.translate(-e.width/this.horizons.length*2,0),e.noStroke(),1==e.rainbow?e.fill(this.shade,50,100,30):e.fill(this.shade,30),e.beginShape();for(let t=0;t<this.horizons.length;t++){var i=this.horizons[t];e.vertex(i.x,i.y),i.x>e.width*(1-1/this.horizons.length)&&(e.vertex(e.width,2*e.height),e.vertex(0,2*e.height))}e.endShape(e.CLOSE),e.pop()}},p5Viz.drawHills=function(e){for(let t=0;t<e.hilllayers.length;t++){var i=e.map(t,0,e.hilllayers.length,.5,10);e.hilllayers[t].update(i,e),0!=t&&e.hilllayers[t].display(e)}e.strokeWeight(5)},p5Viz.drawBuilding=function(t,e,i,r){p5Viz.building(i,t,r.height-e,r.width/50,50+e,3,r)},p5Viz.building=function(t,e,i,r,o,a,s){1==s.rainbow?s.fill(s.map(t,0,s.buildingHeights.length,0,360),100,100,100):s.fill(s.map(2*Math.abs(180-t),0,s.buildingHeights.length,0,96)%64,100),s.rect(e,i,r,o),s.randomSeed(a);s.fill(255);for(var n=3.75;n<r-5;n+=5)for(var h=3.75;h<o-5;h+=5)s.random(1)<.3?s.fill(0,0,100,10):s.fill(0,0,100,100),s.rect(e+n,i+h,3.75,3.75)},p5Viz.drawCity=function(t){t.noFill(),t.strokeWeight(1),t.fft.analyze();var e=t.fft.getEnergy(t.fft.getCentroid())/255;t.buildingHeights.unshift(e),30<t.buildingHeights.length&&t.buildingHeights.pop();for(var i=0;i<t.buildingHeights.length;i+=1){var r=i*(t.width/30)+t.frameCount;r%=t.width,p5Viz.drawBuilding(r,t.buildingHeights[i]*t.height/2,i,t)}},p5Viz.hillcity=function(t){t.mountaineering=!1,t.spoolingKeratin=!1,t.softspikyT=!1,t.vinylMode=!1,t.rectMode(t.CORNER),t.colorMode(t.HSB,360,100,100,100),t.clear(),t.translate(-t.width/2,-t.height/3),p5Viz.drawHills(t),t.translate(t.width/2,t.height/3),p5Viz.drawCity(t),p5Viz.snowit(t)},p5Viz.keratinVars=function(t){t.spoolingKeratin=!1},p5Viz.keratin=function(e){e.mountaineering=!1,e.softspikyT=!1,e.vinylMode=!1,e.strokeWeight(1),0==e.spoolingKeratin&&(e.spoolingKeratin=!0,e.clear()),e.colorMode(e.HSB,255,255,255,255),e.fft.analyze();var t=e.width*e.height*e.fft.linAverages(4)[0]/100;e.noStroke(),e.fill(0,10),e.rect(0,0,e.width,e.height),e.rainbow?e.stroke(e.frameCount%255,255,255,40):e.stroke(255,40),e.noFill();let i=Math.floor(t/e.height),r=t%e.height;e.beginShape();for(let t=0;t<1600;t++)i+=10*e.noise(.02*i,.02*r,.02*t)-5,r+=10*e.noise(.02*i,.02*r,.01*e.frameCount)-5,e.vertex(i,r);e.endShape()},p5Viz.leafequilizerVars=function(t){t.leafequiR=.25*Math.min(t.height,t.width)},p5Viz.leafequi=function(e){e.mountaineering=!1,e.softspikyT=!1,e.vinylMode=!1,e.spoolingKeratin=!1,e.ctx.save(),e.ctx.shadowBlur=10,e.ctx.shadowColor="black",e.colorMode(e.HSB,360,100,100,100),e.clear(),e.rectMode(e.CORNER),e.noStroke();var i=e.fft.analyze(),r=180/(7*i.length/8),o=8*r*e.TWO_PI*e.leafequiR/360;e.translate(e.width/2,e.height/2+.12*e.height),e.fill(0,0,100,100),e.ellipse(0,0,2*e.leafequiR,2*e.leafequiR),e.push(),e.rotate(e.frameCount),e.strokeWeight(8),e.stroke(0,0,0,100),e.rect(-e.leafequiR/2,-e.leafequiR/2,e.leafequiR,e.leafequiR),e.pop();for(let t=0;t<7*i.length/8;t+=4){var a=e.map(i[t],0,256,0,1.5*e.leafequiR);1==e.rainbow?e.fill(e.map(r*t%180,0,180,0,360),100,100,80):e.fill(e.map(r*t%180,0,180,0,360),75);var s=e.sin(r*t+180)*(e.leafequiR+a),n=-e.cos(r*t+180)*(e.leafequiR+a);e.push(),e.rotate(180),e.translate(s,n),e.rotate(r*t),e.rect(-o/2,0,o/2,-e.leafequiR/8-a),e.pop(),e.push(),e.rotate(180),e.translate(-s,n),e.rotate(-r*t),e.rect(-o/2,0,o/2,-e.leafequiR/8-a),e.pop()}e.ctx.restore()},p5Viz.metaballSetup=function(e){e.metaballarray=[];for(let t=0;t<64;t++){var i=2*Math.random()*Math.PI,i={x:Math.random()*e.gph.width,y:Math.random()*e.gph.height,vx:Math.cos(i),vy:Math.sin(i),rad:20};e.metaballarray.push(i)}},p5Viz.metaballs=function(e){e.mountaineering=!1,e.spoolingKeratin=!1,e.softspikyT=!1,e.vinylMode=!1;var i;let r=[];for(i of e.metaballarray)for(var o of e.metaballarray)if(i!=o){let t=(i.x-o.x)**2+(i.y-o.y)**2;t<((i.rad+o.rad)/2)**2&&(t=((i.rad+o.rad)/2)**2);var a=6.25*i.rad*o.rad/t,o=Math.atan2(o.y-i.y,o.x-i.x);i.vx=e.constrain(i.vx+Math.cos(o)*a/i.rad,-15,15),i.vy=e.constrain(i.vy+Math.sin(o)*a/i.rad,-15,15)}var s=e.fft.analyze();for(let t=0;t<64;t++)b=e.metaballarray[t],b.x+=b.vx,b.y+=b.vy,b.x<b.rad&&(b.x=b.rad,b.vx*=-1),b.x>e.gph.width-b.rad&&(b.x=e.gph.width-b.rad,b.vx*=-1),b.y<b.rad&&(b.y=b.rad,b.vy*=-1),b.y>e.gph.height-b.rad&&(b.y=e.gph.height-b.rad,b.vy*=-1),r.push(b.x,b.y,s[16*t]/5);e.gph.shader(e.metaShader),e.metaShader.setUniform("metaballarray",r),e.gph.rect(0,0,e.gph.width,e.gph.height),e.image(e.gph,0,0,e.width,e.height),e.gph.resetShader()},p5Viz.mistyValleyVars=function(t){t.angle2=0,t.mistStarsX=[t.width/2],t.mistStarsY=[t.height/2]},p5Viz.mistyValley=function(i){i.mountaineering=!1,i.spoolingKeratin=!1,i.softspikyT=!1,i.vinylMode=!1,i.clear(),i.colorMode(i.HSB,360,100,100,100);var t=i.amp.getLevel(),e=i.fft.analyze();i.angle2-=.5,i.strokeWeight(8);for(let t=0;t<e.length;t++){var r=i.height-t*i.height/e.length;i.rainbow?i.stroke(e[t],80,50,i.map(r,i.height,0,30,0)):i.stroke(0,0,50*e[t]/225,i.map(r,i.height,0,30,0)),i.line(0,r,i.width,r)}i.strokeWeight(1),(.01<t||0==player.paused)&&(i.mistStarsX.push(Math.random()*i.width),i.mistStarsY.push(Math.random()*i.height)),(50<i.mistStarsX.length||t<.05||player.paused)&&(i.mistStarsX.slice(),i.mistStarsY.slice());for(let e=0;e<i.mistStarsX.length;e++){i.stroke(255,i.map(e,0,i.mistStarsX.length,0,100)),i.point(i.mistStarsX[e]+50*i.noise(i.frameCount/10,i.sin(e)),i.mistStarsY[e]+50*i.noise(i.frameCount/10,i.cos(e))),i.stroke(255,i.map(e,i.mistStarsX.length,0,100,0));for(let t=0;t<i.mistStarsX.length;t++){var o=i.mistStarsX[e]-i.mistStarsX[e+t],a=i.mistStarsY[e]-i.mistStarsY[e+t];Math.sqrt(o*o+a*a)<70&&i.line(i.mistStarsX[e]+50*i.noise(i.frameCount/10,i.sin(e)),i.mistStarsY[e]+50*i.noise(i.frameCount/10,i.cos(e)),i.mistStarsX[e+t]+50*i.noise(i.frameCount/10,i.sin(e+t)),i.mistStarsY[e+t]+50*i.noise(i.frameCount/10,i.cos(e+t)))}}i.strokeWeight(1);for(let t=0;t<e.length;t++){var s=t*i.height/e.length;i.rainbow?i.stroke(e[t],30,50,i.map(s,i.height,0,20,0)):i.stroke(0,0,30*e[t]/225,i.map(s,i.height,0,20,0)),i.line(0,s,i.width,s)}for(i.strokeWeight(8),x=0;x<8;x+=.1){i.stroke(0,0,80*Math.random()+20,60);var n=500*t+10*Math.random()*x/3,h=i.width/2+Math.cos(-i.angle2*Math.PI/180)*n,n=i.height/2+Math.sin(-i.angle2*Math.PI/180)*n;i.point(h,n),i.angle2+=9}i.strokeWeight(.3);for(let t=0;t<e.length;t++){var l=t*i.height/e.length;i.rainbow?i.stroke(e[t],10,30,i.map(l,i.height,0,20,0)):i.stroke(0,0,10*e[t]/225,i.map(l,i.height,0,20,0)),i.line(0,l,i.width,l)}},p5Viz.moleculeuniverseVars=function(t){t.MUfvel=0,t.MUovel=0},p5Viz.rotcircle=function(e,i,r,o,a,s,n){n.beginShape();for(let t=0;t<360;t+=4){var h=n.cos(t)*r+e,l=n.sin(t)*r+i,l=n.isoV(Math.cos(a)*Math.cos(s)*h+(Math.sin(o)*Math.sin(a)*Math.cos(s)-Math.cos(o)*Math.sin(s))*l,Math.cos(a)*Math.sin(s)*h+(Math.sin(o)*Math.sin(a)*Math.sin(s)-Math.cos(o)*Math.cos(s))*l,-Math.sin(a)*h+Math.sin(o)*Math.cos(a)*l);n.point(l.x,l.y)}n.endShape(n.CLOSE)},p5Viz.dotSphere=function(t,e,i,r,o){for(o.translate(t,e),o.stroke(255),longi=0;longi<360;longi+=r)for(colat=0;colat<180;colat+=r){var a=i*o.cos(longi)*o.sin(colat),s=i*o.sin(longi)*o.sin(colat),n=i*o.cos(colat);o.strokeWeight(o.map(Math.abs(colat-90),0,90,2,.1));n=o.rot120(o.frameCount/100,a,s,n),n=o.isoV(n.x,n.y,n.z);o.point(n.x,n.y)}},p5Viz.isoV=function(t,e,i){return{x:(t-i)*Math.cos(.46365),y:0-(e+(t+i)*Math.sin(.46365))}},p5Viz.rot120=function(t,e,i,r){var o,a=Math.cos(t/2),s=Math.sin(t/2)/Math.sqrt(3);f=e,g=i,h=r;var t=0*a-s*f-s*g-s*h,e=a*f+0*s+s*h-s*g,i=a*g-s*h+0*s+s*f,r=a*h+s*g-s*f+0*s,n=a;return f=-s,g=f,h=f,o=i,t=(a=t)*n-(s=e)*f-o*g-r*h,{x:e=a*f+s*n+o*h-r*g,y:i=a*g-s*h+o*n+r*f,z:r=a*h+s*g-o*f+r*n}},p5Viz.moleculeuniverse=function(t){t.mountaineering=!1,t.spoolingKeratin=!1,t.softspikyT=!1,t.vinylMode=!1,t.clear(),t.angleMode(t.DEGREES),t.colorMode(t.HSB,360,100,100,100),t.noFill();var e=.36*Math.min(t.width,t.height);let r;var o=t.fft.analyze(),a=Math.floor(o.length/64);for(t.translate(t.width/2,t.height/2+.11*t.height),i=0;i<64;i++){var s=5.625*i,n=a*i,h=.69*e,n=t.map(o[n],0,255,0,h/2);r=1==t.rainbow?t.color(5.625*i,100,100,100):t.color(0,0,Math.abs(100-200*i/64)),t.stroke(r),t.push(),t.MUfvel+=.003,t.strokeWeight(8),t.rotate(t.MUfvel),t.line(h*t.cos(s),h*t.sin(s),(n+h)*t.cos(s),(n+h)*t.sin(s)),t.noStroke();n=.6*e,h=n*t.cos(s),s=n*t.sin(s);t.fill(r),t.ctx.shadowBlur=10,t.ctx.shadowColor=r,t.circle(h,s,5),t.pop()}var l=.33*e;t.rotate(10*t.MUovel),t.stroke(0,0,100,100),t.strokeWeight(.4),t.ctx.shadowBlur=10,t.ctx.shadowColor="white",p5Viz.dotSphere(0,0,32,9,t),1==t.rainbow?t.stroke(t.frameCount%361,100,100,100,100):t.stroke(2*Math.abs(128-t.frameCount%255),100),t.strokeWeight(5),p5Viz.rotcircle(0,0,l,.9*t.MUovel,.4*t.MUovel,.1*t.MUovel,t),p5Viz.rotcircle(0,0,l,.2*t.MUovel,.85*t.MUovel,.5*t.MUovel,t),p5Viz.rotcircle(0,0,l,.3*t.MUovel,.2*t.MUovel,.7*t.MUovel,t),t.MUovel+=.008,t.ctx.shadowBlur=0},p5Viz.mountainsVars=function(t){t.mountaineering=!1},p5Viz.mountains=function(e){e.spoolingKeratin=!1,e.softspikyT=!1,e.vinylMode=!1,0==e.mountaineering&&(e.clear(),e.mountaineering=!0),e.ctx.shadowOffsetY=-2,e.ctx.shadowBlur=5,e.ctx.shadowColor="black",e.colorMode(e.HSB,360,100,100,100),e.noStroke(),e.translate(0,128);var i=e.fft.analyze(),t=e.fft.getCentroid(),t=e.map(t,1e3,8e3,0,1080)%360;1==e.rainbow?e.fill(t,80,80,100):e.fill(2*Math.abs(180-t)),e.beginShape(),e.vertex(0,e.frameCount%e.height);for(let t=0;t<e.width;t+=e.width/650){var r=e.abs(e.sin(e.frameCount/1e3)*e.width),r=650*(t+r)/e.width,r=e.floor(r%650);e.vertex(t,e.frameCount%e.height-i[r])}e.vertex(e.width,e.frameCount%e.height),e.endShape(),e.ctx.shadowOffsetY=0,e.ctx.shadowBlur=0},p5Viz.multiBarsVars=function(e){e.colorMode(e.HSB,360,100,100,100),e.multiBarsbarDirec=[],e.multiBarsCurrPos=[],e.multiBarsbarCol=[];for(let t=0;t<40;t++)e.multiBarsCurrPos[t]=Math.random()*e.height,e.multiBarsbarCol[t]=e.color(360*Math.random(),50,100,100),e.multiBarsbarDirec[t]=e.random([1,-1]);e.multiEquiGrph=e.createGraphics(e.width/2,e.height/2)},p5Viz.multiBars=function(e){e.mountaineering=!1,e.softspikyT=!1,e.spoolingKeratin=!1,e.vinylMode=!1;e.clear(),e.multiEquiGrph.colorMode(e.HSB,360,100,100,100),e.multiEquiGrph.noStroke(),e.fft.analyze(),e.multiEquiGrph.background(0,2);var i=e.fft.analyze(),r=e.multiEquiGrph.width/40;for(let t=0;t<40;t++)e.multiEquiGrph.fill(e.multiBarsbarCol[t]),e.multiEquiGrph.rect(t*r,e.multiBarsCurrPos[t],r,1),e.multiBarsCurrPos[t]+=15*i[600*t/40]*e.multiBarsbarDirec[t]/255,e.multiBarsCurrPos[t]<0&&(e.multiBarsCurrPos[t]=2,e.multiBarsbarDirec[t]=-e.multiBarsbarDirec[t]),e.multiBarsCurrPos[t]>e.multiEquiGrph.height&&(e.multiBarsCurrPos[t]=e.multiEquiGrph.height,e.multiBarsbarDirec[t]=-e.multiBarsbarDirec[t]);let t=e.multiEquiGrph.get();e.rainbow||t.filter(e.GRAY),e.tint(255,60),e.image(t,0,0,e.width,e.height)},p5Viz.outlinemountainrange=function(r){r.mountaineering=!1,r.spoolingKeratin=!1,r.softspikyT=!1,r.vinylMode=!1,r.clear(),r.colorMode(r.HSB,700,100,100,100),r.fill(r.frameCount%361,100,100,50);r.color(r.frameCount%361,100,100,50);r.noStroke(),r.fft.analyze();var t=r.fft.logAverages(r.fft.getOctaveBands(3)),o=r.ctx.createLinearGradient(0,0,r.width,0),a=r.ctx.createLinearGradient(0,0,r.width,0);for(let i=0;i<8;i++){let t,e;e=1==r.rainbow?(t=r.color(100*i,100,100,100),r.color(100*i,100,75,75)):(t=r.color(r.map(i,0,8,0,100),100),r.color(100*i,75)),o.addColorStop((r.frameCount/100+i)%8/8,t),a.addColorStop(1-(r.frameCount/100+i)%8/8,e)}for(r.ctx.save(),r.ctx.fillStyle=o,r.ctx.shadowBlur=10,r.ctx.shadowOffsetY=-10,r.ctx.shadowColor="black",r.beginShape(),r.vertex(0,r.height+1),i=0;i<t.length;i++){var e=r.map(i,0,t.length-1,0,r.width),s=r.map(t[i],0,256,.2*r.height,r.height);r.vertex(e,s)}r.vertex(r.width,r.height+1),r.endShape(r.CLOSE),r.ctx.fillStyle=a,r.ctx.shadowBlur=20,r.ctx.shadowOffsetY=0,r.ctx.shadowColor="white";var n=.2*Math.min(r.width,r.height),h=r.frameCount/1e3*r.width%r.width+n*r.noise(r.sin(r.frameCount/100)),l=r.frameCount/1e3*r.height%r.height;for(r.circle(h,r.height-l,n),r.ctx.fillStyle=o,r.ctx.shadowBlur=10,r.ctx.shadowOffsetY=10,r.ctx.shadowColor="black",r.beginShape(),r.vertex(0,0),i=0;i<t.length;i++){var c=r.map(i,0,t.length-1,0,r.width),p=r.map(t[i],0,256,0,.8*r.height);r.vertex(c,p)}r.vertex(r.width,0),r.endShape(r.CLOSE),r.ctx.restore()},p5Viz.radarVars=function(t){t.radarGrph=t.createGraphics(600,600),t.radarGrph.angleMode(t.DEGREES),t.radarGrph.clear()},p5Viz.radar=function(e){e.mountaineering=!1,e.spoolingKeratin=!1,e.softspikyT=!1,e.vinylMode=!1,e.clear();var i=e.fft.analyze();e.radarGrph.push(),e.radarGrph.colorMode(e.HSB,360,100,100,200),e.radarGrph.translate(e.radarGrph.width/2,e.radarGrph.height/2);var r=300*e.frameCount/360,o=.5*e.radarGrph.width;e.radarGrph.rotate(r),e.radarGrph.stroke(0,0,0,255),e.radarGrph.strokeWeight(2),e.radarGrph.line(0,0,o,0),e.radarGrph.noStroke();for(let t=0;t<600;t+=10){var a=o*t/600,s=.001+Math.log(1+i[600-t])/Math.log(4);e.rainbow?e.radarGrph.fill(r%360,100,25*s,80):e.radarGrph.fill(0,0,20+Math.abs(60-r%360*120/360),50*s),e.radarGrph.ellipse(a,0,s,s)}e.radarGrph.fill(0,30),e.radarGrph.arc(0,0,2*o,2*o,1,45),e.radarGrph.pop(),e.image(e.radarGrph,0,0,e.width,e.height)},p5Viz.rainbowblobsVars=function(e){e.rainbowblobs=[];for(let t=0;t<100;t++)e.rainbowblobs.push(new p5Viz.rainbowblob(Math.random()*e.width,Math.random()*e.height,4*Math.random()-2,4*Math.random()-2))},p5Viz.rainbowblob=function(t,e,i,r){this.pos=new p5.Vector(t,e),this.vel=new p5.Vector(i,r)},p5Viz.rainbowblobdraw=function(r){r.mountaineering=!1,r.spoolingKeratin=!1,r.softspikyT=!1,r.vinylMode=!1;r.colorMode(r.HSB,255,255,255,255),r.frameCount%5==0&&r.rainbowblobs.push(new p5Viz.rainbowblob(Math.random()*r.width,Math.random()*r.height,4*Math.random()-2,4*Math.random()-2)),r.clear();let t=.75;null!=r.amp.getLevel()&&(t=1.5*r.amp.getLevel());var o=r.map(t,0,1.5,27,343);for(let i=r.rainbowblobs.length-1;-1<i;i--){let t=r.rainbowblobs[i],e=new p5.Vector(t.pos.x,t.pos.y);e.sub(t.pos.x,r.height/2),e.normalize(),e.mult(-.15),t.vel.add(e),t.pos.add(t.vel),t.pos.x+=t.vel.x,(t.pos.y<-100||t.pos.x<-100||t.pos.x>r.width+100)&&r.rainbowblobs.splice(i,1)}for(let i=0;i<r.rainbowblobs.length;i++){var a=r.rainbowblobs[i],s=r.map(a.pos.x,0,r.width,0,255);1==r.rainbow?r.stroke(s,255,255,125):r.stroke(s,125),r.strokeWeight(3),r.point(a.pos.x,a.pos.y);let e=[];for(let t=0;t<r.rainbowblobs.length&&!(6<e.length);t++)i!=t&&r.dist(a.pos.x,a.pos.y,r.rainbowblobs[t].pos.x,r.rainbowblobs[t].pos.y)<o&&e.push(r.rainbowblobs[t]);if(0<e.length){r.strokeWeight(1),1==r.rainbow?(r.stroke(s,255,255,50),r.fill(s,255,255,50)):(r.stroke(s,50),r.fill(s,50)),r.beginShape(),r.curveVertex(a.pos.x,a.pos.y);for(let t=0;t<e.length;t++)r.curveVertex(e[t].pos.x,e[t].pos.y);r.endShape(r.CLOSE)}}},p5Viz.rotatingcosomosVars=function(e){e.rotstarsgrp=e.createGraphics(e.width,e.height),e.rotstarsgrp.clear(),e.rotstars=[];for(let t=0;t<400;t++)e.rotstars.push(new p5Viz.rotstar(e.rotstarsgrp))},p5Viz.rotstar=class{constructor(t){this.x=Math.random()*t.width-t.width/2,this.y=Math.random()*t.height-t.height/2,this.z=t.width/2,this.r=Math.sqrt(this.x*this.x+this.y*this.y),this.a=Math.random()*Math.PI*2,this.life=0}display(t,e){1==e.rainbow?(t.stroke(255-255*this.r*Math.sqrt(2)/t.width,100,100,100),t.strokeWeight(20-15*(this.z-2)/(.5*t.width-2))):(t.stroke(255*this.life/20,100),t.strokeWeight(15-13*(this.z-2)/(.5*t.width-2))),this.life++,20<this.life&&(this.life=20),t.point(this.x,this.y)}rotate(t,e){this.a=this.a+e.peakD.penergy/10,this.r=Math.sqrt(this.x*this.x+this.y*this.y),this.x=Math.cos(this.a)*this.r/(2*this.z/t.width),this.y=Math.sin(this.a)*this.r/(2*this.z/t.width),this.z=this.z-1,(this.z<2||this.x<-t.width/1.8||this.x>t.width/1.8||this.y<-t.width/1.8||this.y>t.width/1.8)&&(this.a=Math.random()*e.TWO_PI,this.z=t.width/2,this.x=Math.random()*t.width-t.width/2,this.y=Math.random()*t.height-t.height/2,this.life=0)}move(t){this.x=map(this.x/this.z,0,1,0,t.width/2),this.y=map(this.y/this.z,0,1,0,t.width/2),this.z=this.z-1,(this.z<2||this.x<-t.width/2||this.x>t.width/2||this.y<-t.height/2||this.y>t.height/2)&&(this.z=p.width/2,this.x=Math.random()*t.width-t.width/2,this.y=Math.random()*t.height-t.height/2)}},p5Viz.rotatingcosomos=function(e){e.mountaineering=!1,e.spoolingKeratin=!1,e.softspikyT=!1,e.vinylMode=!1,e.clear(),e.fft.analyze(),e.peakD.update(e.fft),e.rotstarsgrp.colorMode(e.HSB,255,100,100,100),e.rotstarsgrp.background(0,20),e.rotstarsgrp.push(),e.rotstarsgrp.translate(e.rotstarsgrp.width/2,e.rotstarsgrp.height/2);for(let t=0;t<400;t++)e.rotstars[t].display(e.rotstarsgrp,e),e.rotstars[t].rotate(e.rotstarsgrp,e);e.rotstarsgrp.pop(),e.colorMode(e.RGB,255,255,255,255),e.tint(255,208),e.image(e.rotstarsgrp,0,0,e.width,e.height),e.noTint()},p5Viz.runeVars=function(t){t.runeZarr=[],t.runeTileSize=t.width/120,t.zHeight=t.height/20,t.runeRows=[],t.runerowlength=30},p5Viz.runedrawFilledTriangles=function(r){for(let e=0,i=1;i<r.runeZarr.length;++e,++i){var o=r.runeZarr[e],a=r.runeZarr[i];for(let t=0;t<r.runerowlength-1;++t){var s={x:r.runeRows[e].xVals[t],y:r.runeRows[e].yVals[t]},n={x:r.runeRows[e].xVals[t+1],y:r.runeRows[e].yVals[t+1]},h={x:r.runeRows[i].xVals[t+1],y:r.runeRows[i].yVals[t+1]},l={x:r.runeRows[i].xVals[t],y:r.runeRows[i].yVals[t]};o[t+1]==a[t]&&a[t+1]!==o[t]&&r.abs(a[t+1]-o[t])<2||o[t]==a[t+1]&&o[t+1]!==a[t]?o[t+1]==a[t]&&a[t+1]!==o[t]&&r.abs(a[t+1]-o[t])<2?o[t]==o[t+1]&&o[t]==a[t]?(r.fill(r.runeShadeNeutral),r.runetri(r,s,n,l),a[t+1]>o[t]?r.fill(r.runeShadeDark):o[t+1]>a[t+1]&&r.fill(r.runeShadeLight),r.runetri(r,n,h,l)):o[t+1]==a[t+1]&&a[t]==a[t+1]?(r.fill(r.runeShadeNeutral),r.runetri(r,n,h,l),o[t]<a[t+1]?r.fill(r.runeShadeDark):r.fill(r.runeShadeLight),r.runetri(r,s,n,l)):o[t+1]==a[t+1]&&a[t]>o[t]&&r.fill(255,0,0):o[t]==a[t+1]&&o[t+1]!==a[t]&&(o[t]==o[t+1]&&o[t]==a[t+1]?(r.fill(r.runeShadeNeutral),r.runetri(r,s,n,h),a[t],o[t+1],r.fill(r.runeShadeDark),r.runetri(r,s,h,l)):o[t]==a[t+1]&&o[t+1]>o[t]?(r.fill(r.runeShadeDark),r.runetri(r,s,n,h),a[t]<o[t+1]&&r.fill(r.runeShadeNeutral),r.runetri(r,s,h,l)):o[t]==a[t+1]&&o[t+1]<o[t]&&(r.fill(r.runeShadeDark),r.runetri(r,s,n,h),a[t]>o[t+1]&&r.fill(r.runeShadeNeutral),r.runetri(r,s,h,l))):(o[t]==o[t+1]&&o[t]==a[t]&&o[t]==a[t+1]?r.fill(r.runeShadeNeutral):o[t]==a[t]&&o[t+1]==a[t+1]&&o[t+1]<o[t]||o[t]==o[t+1]&&a[t]==a[t+1]&&a[t]<o[t]?r.fill(r.runeShadeLight):(o[t]==a[t]&&o[t+1]==a[t+1]&&o[t+1]>o[t]||o[t]==o[t+1]&&a[t]==a[t+1]&&a[t]>o[t])&&r.fill(r.runeShadeDark),r.quad(s.x,s.y,n.x,n.y,h.x,h.y,l.x,l.y))}}},p5Viz.runeworldToScreenSpace=function(i){i.runeRows=[];let r=[],o=[];for(let e=0;e<i.runeZarr.length;++e){for(let t=0;t<i.runeZarr[0].length;++t){var a=t*i.runeTileSize*2,s=-t*i.runeTileSize;s-=i.zHeight*i.runeZarr[e][t],a+=2*i.runeTileSize*e,s+=i.runeTileSize*e,r.push(a),o.push(s)}i.runeRows.push({xVals:[...r],yVals:[...o]}),r=[],o=[]}},p5Viz.runetri=function(t,e,i,r){t.triangle(e.x,e.y,i.x,i.y,r.x,r.y)},p5Viz.runes=function(i){if(i.mountaineering=!1,i.spoolingKeratin=!1,i.softspikyT=!1,i.vinylMode=!1,i.colorMode(i.HSB,255,100,100,100),i.clear(),i.strokeWeight(.5),i.noiseDetail(1,1),i.rainbow){var t=.2*i.frameCount%360;i.stroke(t,100,60,70),i.runeShadeLight=i.color(t,100,50,100),i.runeShadeNeutral=i.color(t,90,60,90),i.runeShadeDark=i.color(t,80,70,80)}else{let t=.2*i.frameCount%720;360<t&&(t=720-t),i.stroke(t,70),i.runeShadeLight=i.color(t,100),i.runeShadeNeutral=i.color(t,90),i.runeShadeDark=i.color(t,80)}var r=2*i.runeTileSize;i.fft.analyze(),i.runeZarr=[];for(let e=0;e<i.runerowlength;++e){i.runeZarr.push([]);for(let t=0;t<i.runerowlength;++t){var o=Math.ceil(12*i.noise((1/r+e)/8,i.frameCount/1e3,(i.fft.getCentroid()/8e3+t)/15));i.runeZarr[e].push(o)}}i.translate(-i.runerowlength*r+i.width/2,i.height/2+6*i.zHeight),i.runeworldToScreenSpace(i),i.runedrawFilledTriangles(i),i.noiseDetail(4,.5)},p5Viz.sneksVars=function(e){e.wavhist=[];for(let t=0;t<712;t++)e.wavhist.push(0)},p5Viz.snek=function(e){e.mountaineering=!1,e.spoolingKeratin=!1,e.softspikyT=!1,e.vinylMode=!1,e.ctx.shadowBlur=10,e.ctx.shadowColor="white",e.colorMode(e.HSB,360,255,255,255),e.clear(),e.strokeWeight(6),e.fft.analyze();var t=e.amp.getLevel();e.wavhist.push(t),e.noFill(),1==e.rainbow?e.stroke(e.frameCount/10%361,255,255):e.stroke(Math.abs(180-e.frameCount/5%361)),e.translate(e.width/2,0),e.beginShape();for(let t=0;t<e.wavhist.length;t++){var i=e.map(e.wavhist[t],0,1,.1*t,t),r=e.map(i*e.cos(t),0,e.wavhist.length,0,2.3*e.width),i=e.map(e.wavhist[t],0,1,e.height,0);e.vertex(r,i/e.wavhist.length*t)}e.endShape(),712<e.wavhist.length&&e.wavhist.splice(0,1),e.ctx.shadowBlur=0},p5Viz.softspiketunnelVars=function(t){t.softspikyT=!1,t.sftSpkTunnT=0,t.sftSpkTunnTstep=.5},p5Viz.softspiketunnel=function(e){e.mountaineering=!1,e.spoolingKeratin=!1,e.vinylMode=!1,0==e.softspikyT&&(e.softspikyT=!0,e.clear()),e.ctx.shadowColor=e.color(0,100),e.ctx.shadowOffsetY=-5,e.ctx.shadowBlur=20;var t=.8*Math.min(e.width,e.height),i=e.fft.analyze(),r=e.fft.getCentroid();e.colorMode(e.HSB,600,100,100,100),e.rainbow?e.fill(e.map(r,800,8e3,0,600),100,100):e.fill(0,0,e.map(r,800,8e3,0,100),100),e.noStroke(),e.translate(e.width/2,e.height/2),e.rotate(e.frameCount/2),e.beginShape(),e.vertex(0,e.sftSpkTunnT);for(let t=0;t<i.length/1.5;t+=5)e.vertex(t,e.sftSpkTunnT-i[t]);e.vertex(e.width,e.sftSpkTunnT),e.endShape(),e.sftSpkTunnT>t&&(e.sftSpkTunnTstep=-.5),e.sftSpkTunnT<0&&(e.sftSpkTunnTstep=.5),e.sftSpkTunnT+=e.sftSpkTunnTstep,e.ctx.shadowOffsetY=0,e.ctx.shadowBlur=0},p5Viz.spectogramVars=function(e){e.spcgrm=e.createGraphics(e.width,100),e.spcgrm.pixelDensity(1),e.spcgrm.clear(),e.hzlst=[];for(let t=0;t<100;t++)e.hzlst.push(Math.pow(4,7*t/100));e.hzlst.reverse()},p5Viz.spectogram=function(i){i.mountaineering=!1,i.spoolingKeratin=!1,i.softspikyT=!1,i.vinylMode=!1,i.colorMode(i.HSB,360,100,100,100),i.clear();var r=i.frameCount%i.spcgrm.width;i.fft.analyze(),i.spcgrm.loadPixels();for(let e=0;e<i.spcgrm.height;e++){var o=i.hzlst[e],o=i.fft.getEnergy(o);let t;1==i.rainbow?t=i.color(i.map(o,50,255,640,300)%360,100,100):(t=i.color(0,100),t.setRed(360*(o-50)/205),t.setGreen(360*(o-50)/205),t.setBlue(360*(o-50)/205)),o<50&&(t=i.color(0,0,0,0));o=e*i.spcgrm.width+r;o*=4,i.spcgrm.pixels[0+o]=i.red(t),i.spcgrm.pixels[1+o]=i.green(t),i.spcgrm.pixels[2+o]=i.blue(t),i.spcgrm.pixels[3+o]=i.alpha(t)}i.spcgrm.updatePixels(),i.image(i.spcgrm,0,0,i.width,i.height)},p5Viz.spectrabars3dVars=function(t){t.spectraBars=[]},p5Viz.SpectrumBars=class{constructor(t){this.spectrum=t}getSpectrum(){for(let t=0;t<this.spectrum.length;t++)this.spectrum[t]*=.95;return this.spectrum}},p5Viz.spectra3dbars=function(t){t.mountaineering=!1,t.spoolingKeratin=!1,t.softspikyT=!1,t.vinylMode=!1,t.clear(),t.colorMode(t.HSB,255,255,255,255),t.strokeWeight(1);var e=t.fft.analyze();t.spectraBars.push(new p5Viz.SpectrumBars(e)),t.spectraBars.length>.0512*t.height&&t.spectraBars.splice(0,1);var r=.4*t.width/64;for(j=0;j<t.spectraBars.length;j++){var o=t.spectraBars[j].getSpectrum();for(i=0;i<64;i+=1){var a=t.map(i,64,0,1,.97),a=t.height-o[13*i]*a*t.height/255;1==t.rainbow?(t.fill(255*i/64,255,255,j+1),t.stroke(255*i/64,255,255,50+6*(j+1))):(t.fill(255*i/64,j+1),t.stroke(255*i/64,50+6*(j+1))),t.rect(12*j+2*r*i,a-4*i-10*(20-j/2),r,t.height-a)}}},p5Viz.spectrumcircleVars=function(t){t.rotateblocks=!0,t.numblocks3dspec=169,t.r3dspectrum=t.width/3,t.w3dspectrumblock=t.TWO_PI*t.r3dspectrum/t.numblocks3dspec},p5Viz.cubeit=function(t,e,i,r){var o=r.sin(i);w=o<0?(h=e*(.8+.3*o),t*(.6+.2*o)):(h=e*(.8-.3*o),t*(.6-.2*o)),w=180<i?(h=e*(.9+.1*(i-180)/180),t*(.9+.1*(i-180)/180)):(h=e*(.9-.1*i/180),t*(.9-.1*i/180)),h/=2,w/=2,r.quad(-w-w,h+0,-w-w,0-h,w-w,-h+w,w-w,h+w),r.quad(w+w,h+(w-w)/2,w+w,-h+(w-w)/2,w-w,-h+(w+w)/2,w-w,h+(w+w)/2),r.quad(-w+w,-h-w,-w-w,-h,w-w,-h+w,w+w,0-h)},p5Viz.spectrumcircle3d=function(i){i.mountaineering=!1,i.spoolingKeratin=!1,i.softspikyT=!1,i.vinylMode=!1,i.clear(),i.noStroke(),i.colorMode(i.HSB,255,100,100,100),i.translate(i.width/2-i.w3dspectrumblock/2,i.height/2-.1*i.height),i.ctx.save(),i.ctx.shadowBlur=5,i.ctx.shadowColor="black";var r=360/i.numblocks3dspec;let o=0;var a=i.fft.analyze();for(let e=0;e<i.numblocks3dspec;e++){i.push();let t=(i.floor(i.frameCount)+e)%i.numblocks3dspec;0==i.rotateblocks&&(t=e),tallness=i.sq(a[i.floor(2.7*t)]/255)*i.height/3,x=i.cos(o)*i.r3dspectrum,y=i.sin(o)*i.r3dspectrum*.2;var s=i.amp.getLevel(),s=(1+tallness/3)*(1+s/100);i.translate(x,y),1==i.rainbow?i.fill(i.map(t,i.numblocks3dspec,0,0,256),100,100,50):t>i.numblocks3dspec/2?i.fill(i.map(t,i.numblocks3dspec,0,0,256),50):i.fill(i.map(t,i.numblocks3dspec,0,256,0),50),p5Viz.cubeit(i.w3dspectrumblock,7*s,o,i),o-=r,i.pop()}i.ctx.restore()},p5Viz.sugarCubesVars=function(i){var t=.7*Math.min(i.width,i.height),r=t/10,o=.8*t;i.sugarTowerz=[];for(let e=0;e<10;e++)for(let t=0;t<10;t++){var a=e*r,s=t*r;new i.sugarTower(r,o,a,s,3*((e+t)*(e+t+1)/2+t),i)}},p5Viz.sugarTower=class{constructor(t,e,i,r,o,a){this.id=o,this.h=0,this.bounce=new a.sugarBounce(0,e),this.base=[[i-r,.5*(i+r-t)],[i-r-t,.5*(i+r)],[i-r,.5*(i+r+t)],[i-r+t,.5*(i+r)]],a.sugarTowerz.push(this)}draw(t){this.h=this.bounce.update(25600/(1+t.sugarSpec[this.id])),t.rainbow?t.fill(this.id,100,100,80):t.fill(0,0,50),t.quad(this.base[3][0],this.base[3][1],this.base[3][0],this.base[3][1]-this.h,this.base[2][0],this.base[2][1]-this.h,this.base[2][0],this.base[2][1]),t.rainbow?t.fill(this.id,100,100,80):t.fill(0,0,80),t.quad(this.base[2][0],this.base[2][1],this.base[2][0],this.base[2][1]-this.h,this.base[1][0],this.base[1][1]-this.h,this.base[1][0],this.base[1][1]),t.rainbow?t.fill(this.id,100,100,100):t.fill(0,0,100),t.quad(this.base[0][0],this.base[0][1]-this.h,this.base[1][0],this.base[1][1]-this.h,this.base[2][0],this.base[2][1]-this.h,this.base[3][0],this.base[3][1]-this.h)}},p5Viz.sugarBounce=class{constructor(t,e,i){this.diff=(e-t)/2,this.ang=Math.PI,this.mini=t,this.maxi=e}update(t){return this.ang+=2*Math.PI/t,this.mini+(Math.cos(this.ang)+1)/2*this.diff}},p5Viz.sugarCubes=function(e){e.mountaineering=!1,e.spoolingKeratin=!1,e.softspikyT=!1,e.vinylMode=!1,e.translate(e.width/2,e.height/3),e.sugarSpec=e.fft.analyze(),e.colorMode(e.HSB,580,100,100,100),e.rainbow?e.stroke(0,0,100):e.stroke(0,0,70),e.clear();for(let t=0;t<e.sugarTowerz.length;t++)e.sugarTowerz[t].draw(e)},p5Viz.targetNetVars=function(i){i.colorMode(i.HSB,255,255,255,255),i.ball=new i.targetBall(i),i.irisNetns=[];for(let e=0;e<i.width;e+=40)for(let t=0;t<i.height;t+=40)i.irisNetns.push(new i.irisNetn(i,e,t,40,i.ball))},p5Viz.targetBall=class{constructor(t){this.x=t.width/2,this.y=t.height/2,this.color=t.color(0,225),this.size=40,this.speed=t.createVector(40*Math.random()-20,40*Math.random()-20)}move(t){this.speed.x=-(this.x-t.targetx),this.speed.y=-(this.x-t.targetx),this.speed.normalize(),this.x<=0?this.x=t.width:this.x>=t.width&&(this.x=0),this.y<=0?this.y=t.height:this.y>=t.height&&(this.y=0),this.x+=this.speed.x,this.y+=this.speed.y,this.draw(t)}draw(t){t.fill(this.color),t.ellipse(this.x,this.y,this.size,this.size),t.fill(255,200),t.ellipse(this.x+this.size/5,this.y-this.size/5,this.size/5)}},p5Viz.irisNetn=class{constructor(t,e=0,i=0,r=50,o=null){this.x=e,this.y=i,this.size=r,this.iris=t.color(255*Math.random(),200,200),this.target=o}draw(t){t.noStroke(),r=Math.atan2(this.y-this.target.y,this.x-this.target.x),i=t.dist(this.x,this.y,this.target.x,this.target.y);let e=this.size-this.size/2*.75;e=i>e?e:i;var i=-e*Math.cos(r),r=-e*Math.sin(r);t.fill(this.iris),t.rect(this.x+i,this.y+r,3*this.size/4,3*this.size/4),t.fill(0),t.rect(this.x+i,this.y+r,3*this.size/8,3*this.size/8)}},p5Viz.targetNet=function(e){e.mountaineering=!1,e.spoolingKeratin=!1,e.softspikyT=!1,e.vinylMode=!1,e.fft.analyze(),e.noStroke();var t=Math.floor(e.width*e.height*e.fft.linAverages(4)[0]/200);e.targetx=Math.floor(t/e.height),e.targety=t%e.height;t=e.dist(0,0,e.targetx,e.targety);e.targetR=0!=t?t:1,e.colorMode(e.HSB,255,255,255,255),e.clear();for(let t=0;t<e.irisNetns.length;t++)e.irisNetns[t].draw(e);if(e.ball.move(e),!e.rainbow){let t=e.createImage(e.width,e.height);t.copy(e,0,0,e.width,e.height,0,0,e.width,e.height),t.filter(e.GRAY),e.image(t,0,0)}},p5Viz.vinylVars=function(t){t.vinylMode=!1},p5Viz.vinyl=function(t){t.mountaineering=!1,t.spoolingKeratin=!1,t.softspikyT=!1,t.vinylMode=!1,t.vinylMode=!0,t.fixview(t)},p5Viz.fixview=function(t){t.vinylMode?(vinylGrph.loop(),document.getElementById("MAINVIZ").style.display="none",document.getElementById("VINYL").style.display="block"):(vinylGrph.noLoop(),document.getElementById("MAINVIZ").style.display="block",document.getElementById("VINYL")&&(document.getElementById("VINYL").style.display="none"))};let vinylSk=function(i){i.Tonearm=class{constructor(){this.pos=i.createVector(180,0,-120),this.ang=i.createVector(i.HALF_PI,0,i.HALF_PI),this.angTarget=i.createVector(i.HALF_PI,0,i.HALF_PI)}rotate(){this.ang.x+=(this.angTarget.x-this.ang.x)/15,this.ang.y+=(this.angTarget.y-this.ang.y)/10,this.ang.y+=(this.angTarget.z-this.ang.z)/10,1==soundmode&&0<player.duration?i.tonearm.angTarget.y-=.005/player.duration:i.tonearm.angTarget.y-=25e-6}show(){i.push(),i.noStroke(),i.translate(this.pos.x,this.pos.y,this.pos.z),i.specularMaterial(10),i.cylinder(5,100),i.ambientMaterial(100),i.translate(0,0,180),i.box(3,90,3),i.translate(0,-43.5,0),i.box(10,3,3),i.translate(0,43.5,-180),i.translate(0,-50,0),i.rotateY(this.ang.y),0!=soundmode&&0!=player.paused||i.rotateX(Math.sin(i.platter.angle)/500),i.rotateX(this.ang.x),i.rotateZ(this.ang.z),i.specularMaterial(99,73,23),i.cylinder(12,12),i.rotateZ(-i.HALF_PI),i.translate(0,-35,-8),i.cylinder(15,15),i.translate(0,115,8),i.specularMaterial(50),i.cylinder(5,250),i.translate(0,125,0),i.sphere(5),i.rotateZ(i.PI/8),i.translate(0,25,0),i.cylinder(5,50),i.translate(0,25,0),i.specularMaterial(82,70,45),i.box(24,42,16),i.translate(12,10,0),i.box(32,5,3),i.translate(-12,-10,0),i.ambientMaterial(100),i.translate(0,20,-10),i.box(5,5,5),i.translate(0,1,-3),i.specularMaterial(255),i.box(1,1,3),i.pop()}},i.Platter=class{constructor(){this.pos=i.createVector(-50,0,0),this.angle=0,this.aspeed=0,this.atarget=0}rotate(){this.angle+=this.aspeed,this.aspeed+=(this.atarget-this.aspeed)/16,this.discheight+=(this.disctarget-this.discheight)/8}show(){i.push(),i.noStroke(),i.specularMaterial(50),i.translate(this.pos.x,this.pos.y,this.pos.z),i.rotateY(this.angle),i.cylinder(100,20),i.translate(0,-15,0),i.cylinder(180,20,32,1),i.translate(0,-12,0),i.ambientMaterial(50),i.cylinder(180,4,24,1,!0,!0),i.specularMaterial(50),i.translate(0,-6,0),i.cylinder(4,12,24,1),i.pop()}},i.Cabinet=class{constructor(){this.height=70}show(){i.push(),i.noStroke(),i.texture(t),i.translate(0,this.height/2,0),i.box(500,this.height,400);for(let e=-170;e<171;e+=340)for(let t=-220;t<221;t+=440)i.push(),i.translate(t,this.height/2+5,e),i.ambientMaterial(90),i.cylinder(25,10),i.pop();i.pop(),i.ambientMaterial(40),i.box(480,4,380)}},i.Lamp=class{constructor(){this.pos=i.createVector(500,-150,-200),this.h=150,this.w=150,this.on=!1}show(){i.push(),i.translate(this.pos.x,this.pos.y,this.pos.z),this.on&&i.pointLight(203,92,13,this.pos.x,this.pos.y-175,this.pos.z),i.specularMaterial(255),i.noStroke(),i.cylinder(5,150),i.translate(0,-.75*this.h,0),i.sphere(this.w/4),i.specularMaterial(155,0,0,240),i.cylinder(this.w,this.w,24,1,!1,!1),i.push(),i.translate(0,-.25*this.h,0),i.rotateX(i.HALF_PI),i.cylinder(1,2*this.w),i.rotateZ(i.HALF_PI),i.cylinder(1,2*this.w),i.pop(),i.translate(0,1.5*this.h,0),i.specularMaterial(203,92,13),i.ellipsoid(.7*this.w,.9*this.h,.7*this.w),i.translate(-3*this.w,.86*this.w,this.w),i.rotateX(i.HALF_PI),i.specularMaterial(0),i.box(8*this.w,4*this.w,20),i.pop()}},i.Record=class{constructor(){this.height=-233,this.target=-233,this.anglex=0,this.anglextarget=0,this.rotate=0}move(){this.height+=(this.target-this.height)/8,this.anglex+=(this.anglextarget-this.anglex)/6}show(){i.push(),i.noStroke(),i.translate(i.platter.pos.x,i.platter.pos.y,i.platter.pos.z),i.translate(0,this.height,0),i.rotateX(this.anglex),-35<this.height&&("B"==i.side?this.rotate+=i.platter.aspeed:this.rotate-=i.platter.aspeed),i.rotateY(this.rotate),i.specularMaterial(0),i.cylinder(180,1,24,1,!0,!0),i.ambientMaterial(155,0,0),i.cylinder(60,3,24,1,!0,!0),i.ambientMaterial(0),i.cylinder(4,4),i.ambientMaterial(200,0,0),i.translate(0,0,-30),i.box(40,4,20),i.pop()}};let t;i.counter1=61,i.counter2=31,i.counter3=31,i.rotAngle=1,i.rotatev=0,i.side="A",i.zoom=.3,i.zvel=.01,i.preload=function(){t=i.loadImage("../js/vizualizer/assets/teak.jpeg")},i.setup=function(){let t=i.createCanvas(i.windowWidth,i.windowHeight,i.WEBGL);t.id("VINYL"),i.lamp=new i.Lamp,i.tonearm=new i.Tonearm,i.platter=new i.Platter,i.cabinet=new i.Cabinet,i.record=new i.Record,player.onplay=function(){i.tonearm.angTarget.x=i.HALF_PI-.02,i.counter3=0,i.counter1=30,i.tonearm.angTarget.y=-i.PI/4},player.onended=function(){i.returnToneArm,playnext()},player.onpause=function(){i.tonearm.angTarget.x=i.HALF_PI,i.platter.atarget=0,i.counter2=0},i.lamp.on=!0,i.rotatev=-.12,i.zvel=.055},i.draw=function(){i.clear(),i.setScene(),i.lamp.show(),i.cabinet.show(),i.platter.rotate(),i.platter.show(),i.tonearm.rotate(),i.tonearm.show(),i.record.move(),i.record.show(),i.checkKeys(),i.controlTiming()},i.controlTiming=function(){i.counter1+=1,i.counter2+=1,i.counter3+=1,30==i.counter1&&(i.record.target=-29),60==i.counter1&&(i.platter.atarget=-.06,0==i.tonearm.angTarget.y&&(i.tonearm.angTarget.y=-.35)),30==i.counter2&&(i.platter.atarget=0,i.tonearm.angTarget.y=0),30==i.counter3&&1==soundmode&&1==soundmode&&player.play()},i.setScene=function(){i.background(0),i.lamp.on?(i.ambientLight(150),i.pointLight(203,92,13,200,550,200)):(i.ambientLight(50),i.pointLight(50,50,50,-200,-150,0)),i.zoom+=i.zvel,(i.zoom<.1||i.zoom>.01*i.height)&&(i.zoom-=i.zvel,i.zvel*=-1),i.zvel*=.9,i.scale(i.zoom),i.rotateX(-i.PI/8),i.rotateY(i.PI/12+i.rotAngle),i.rotAngle+=i.rotatev,i.rotatev*=.92},i.windowResized=function(){i.resizeCanvas(i.windowWidth,i.windowHeight,!0)},i.keyPressed=function(){73==i.keyCode&&(i.tonearm.angTarget.y<-i.PI||0==soundmode||0==player.paused?(i.tonearm.angTarget.x=i.HALF_PI,i.platter.atarget=0,i.counter2=0,1==soundmode&&player.pause()):-.1<i.tonearm.ang.y&&(i.record.target=-233)),75==i.keyCode&&(1==soundmode&&player.paused?(i.tonearm.angTarget.x=i.HALF_PI-.02,i.counter3=0):-233==i.record.target?(0==i.record.anglextarget?(i.record.anglextarget=-i.PI,i.side="A"):(i.record.anglextarget=0,i.side="B"),i.counter1=0):i.counter1=31,1==soundmode&&player.play(),i.tonearm.angTarget.y=-i.PI/4),"g"==i.key&&(i.lamp.on=!i.lamp.on)},i.returnToneArm=function(){i.tonearm.angTarget.y=0,i.tonearm.angTarget.x=i.HALF_PI,i.platter.atarget=0,i.counter2=0},i.checkKeys=function(){i.keyIsDown(76)&&(i.rotatev-=.005),i.keyIsDown(74)&&(i.rotatev+=.005),i.keyIsDown(65)&&(i.rotatev+=.005),i.keyIsDown(68)&&(i.rotatev-=.005),i.keyIsDown(87)&&(i.zvel+=.003),i.keyIsDown(83)&&(i.zvel-=.003)}},vinylGrph=new p5(vinylSk,"ctx");function Voronoi(){this.vertices=null,this.edges=null,this.cells=null,this.toRecycle=null,this.beachsectionJunkyard=[],this.circleEventJunkyard=[],this.vertexJunkyard=[],this.edgeJunkyard=[],this.cellJunkyard=[]}p5Viz.vlcVars=function(e){e.dotPos=new Array;for(let t=0;t++;t)append(dotPos,[e.width/2,e.height/2])},p5Viz.vlc=function(e){e.mountaineering=!1,e.spoolingKeratin=!1,e.softspikyT=!1,e.vinylMode=!1,e.translate(0,.1*e.height),e.clear(),e.noFill(),e.colorMode(e.HSB,255,100,100,100),e.fft.analyze();var r=e.fft.logAverages(e.fft.getOctaveBands(3));let o;for(maxR=Math.round(.5*e.width),i=0;i<r.length;i++){var a=4.7*i,s=(e.frameCount,Math.round(.5*e.width),i*(400/r.length)),s=(e.frameCount+s)%400,n=.05*maxR/(.05+(400-s)/400*4.95),h=r[i]%360;o=1==e.rainbow?e.color(e.map(Math.pow(s,2),0,Math.pow(400,2),0,512)%256,100,100):e.color(e.map(Math.pow(s,2),0,Math.pow(400,2),0,512)%256,100),e.stroke(o),e.strokeWeight(3);let t=e.dotPos[i];for(null==t&&(t=e.createVector(0,0)),e.beginShape(),j=0;j<t.y;j++)ccang=(h+j)%360,cx=n*e.cos(ccang)*1.8,cy=n*e.sin(ccang)*1.8,e.vertex(cx+e.width/2,cy+e.height/2);e.endShape(),e.dotPos[i]=e.createVector(a,h)}},Voronoi.prototype.reset=function(){if(this.beachline||(this.beachline=new this.RBTree),this.beachline.root)for(var t=this.beachline.getFirst(this.beachline.root);t;)this.beachsectionJunkyard.push(t),t=t.rbNext;this.beachline.root=null,this.circleEvents||(this.circleEvents=new this.RBTree),this.circleEvents.root=this.firstCircleEvent=null,this.vertices=[],this.edges=[],this.cells=[]},Voronoi.prototype.sqrt=Math.sqrt,Voronoi.prototype.abs=Math.abs,Voronoi.prototype.ε=Voronoi.ε=1e-9,Voronoi.prototype.invε=Voronoi.invε=1/Voronoi.ε,Voronoi.prototype.equalWithEpsilon=function(t,e){return this.abs(t-e)<1e-9},Voronoi.prototype.greaterThanWithEpsilon=function(t,e){return 1e-9<t-e},Voronoi.prototype.greaterThanOrEqualWithEpsilon=function(t,e){return e-t<1e-9},Voronoi.prototype.lessThanWithEpsilon=function(t,e){return 1e-9<e-t},Voronoi.prototype.lessThanOrEqualWithEpsilon=function(t,e){return t-e<1e-9},Voronoi.prototype.RBTree=function(){this.root=null},Voronoi.prototype.RBTree.prototype.rbInsertSuccessor=function(t,e){var i,r,o;if(t){if(e.rbPrevious=t,e.rbNext=t.rbNext,t.rbNext&&(t.rbNext.rbPrevious=e),t.rbNext=e,t.rbRight){for(t=t.rbRight;t.rbLeft;)t=t.rbLeft;t.rbLeft=e}else t.rbRight=e;i=t}else i=this.root?(t=this.getFirst(this.root),e.rbPrevious=null,(e.rbNext=t).rbPrevious=e,t.rbLeft=e,t):(e.rbPrevious=e.rbNext=null,this.root=e,null);for(e.rbLeft=e.rbRight=null,e.rbParent=i,e.rbRed=!0,t=e;i&&i.rbRed;)i===(r=i.rbParent).rbLeft?(o=r.rbRight)&&o.rbRed?(i.rbRed=o.rbRed=!1,r.rbRed=!0,t=r):(t===i.rbRight&&(this.rbRotateLeft(i),i=(t=i).rbParent),i.rbRed=!1,r.rbRed=!0,this.rbRotateRight(r)):(o=r.rbLeft)&&o.rbRed?(i.rbRed=o.rbRed=!1,r.rbRed=!0,t=r):(t===i.rbLeft&&(this.rbRotateRight(i),i=(t=i).rbParent),i.rbRed=!1,r.rbRed=!0,this.rbRotateLeft(r)),i=t.rbParent;this.root.rbRed=!1},Voronoi.prototype.RBTree.prototype.rbRemoveNode=function(t){t.rbNext&&(t.rbNext.rbPrevious=t.rbPrevious),t.rbPrevious&&(t.rbPrevious.rbNext=t.rbNext),t.rbNext=t.rbPrevious=null;var e,i,r=t.rbParent,o=t.rbLeft,a=t.rbRight,s=o?a?this.getFirst(a):o:a;if(r?r.rbLeft===t?r.rbLeft=s:r.rbRight=s:this.root=s,o&&a?(e=s.rbRed,s.rbRed=t.rbRed,((s.rbLeft=o).rbParent=s)!==a?(r=s.rbParent,s.rbParent=t.rbParent,t=s.rbRight,r.rbLeft=t,(s.rbRight=a).rbParent=s):(s.rbParent=r,t=(r=s).rbRight)):(e=t.rbRed,t=s),t&&(t.rbParent=r),!e)if(t&&t.rbRed)t.rbRed=!1;else{do{if(t===this.root)break;if(t===r.rbLeft){if((i=r.rbRight).rbRed&&(i.rbRed=!1,r.rbRed=!0,this.rbRotateLeft(r),i=r.rbRight),i.rbLeft&&i.rbLeft.rbRed||i.rbRight&&i.rbRight.rbRed){i.rbRight&&i.rbRight.rbRed||(i.rbLeft.rbRed=!1,i.rbRed=!0,this.rbRotateRight(i),i=r.rbRight),i.rbRed=r.rbRed,r.rbRed=i.rbRight.rbRed=!1,this.rbRotateLeft(r),t=this.root;break}}else if((i=r.rbLeft).rbRed&&(i.rbRed=!1,r.rbRed=!0,this.rbRotateRight(r),i=r.rbLeft),i.rbLeft&&i.rbLeft.rbRed||i.rbRight&&i.rbRight.rbRed){i.rbLeft&&i.rbLeft.rbRed||(i.rbRight.rbRed=!1,i.rbRed=!0,this.rbRotateLeft(i),i=r.rbLeft),i.rbRed=r.rbRed,r.rbRed=i.rbLeft.rbRed=!1,this.rbRotateRight(r),t=this.root;break}}while(i.rbRed=!0,r=(t=r).rbParent,!t.rbRed);t&&(t.rbRed=!1)}},Voronoi.prototype.RBTree.prototype.rbRotateLeft=function(t){var e=t,i=t.rbRight,t=e.rbParent;t?t.rbLeft===e?t.rbLeft=i:t.rbRight=i:this.root=i,i.rbParent=t,e.rbParent=i,e.rbRight=i.rbLeft,e.rbRight&&(e.rbRight.rbParent=e),i.rbLeft=e},Voronoi.prototype.RBTree.prototype.rbRotateRight=function(t){var e=t,i=t.rbLeft,t=e.rbParent;t?t.rbLeft===e?t.rbLeft=i:t.rbRight=i:this.root=i,i.rbParent=t,e.rbParent=i,e.rbLeft=i.rbRight,e.rbLeft&&(e.rbLeft.rbParent=e),i.rbRight=e},Voronoi.prototype.RBTree.prototype.getFirst=function(t){for(;t.rbLeft;)t=t.rbLeft;return t},Voronoi.prototype.RBTree.prototype.getLast=function(t){for(;t.rbRight;)t=t.rbRight;return t},Voronoi.prototype.Diagram=function(t){this.site=t},Voronoi.prototype.Cell=function(t){this.site=t,this.halfedges=[],this.closeMe=!1},Voronoi.prototype.Cell.prototype.init=function(t){return this.site=t,this.halfedges=[],this.closeMe=!1,this},Voronoi.prototype.createCell=function(t){var e=this.cellJunkyard.pop();return e?e.init(t):new this.Cell(t)},Voronoi.prototype.Cell.prototype.prepareHalfedges=function(){for(var t,e=this.halfedges,i=e.length;i--;)(t=e[i].edge).vb&&t.va||e.splice(i,1);return e.sort(function(t,e){return e.angle-t.angle}),e.length},Voronoi.prototype.Cell.prototype.getNeighborIds=function(){for(var t,e=[],i=this.halfedges.length;i--;)null!==(t=this.halfedges[i].edge).lSite&&t.lSite.voronoiId!=this.site.voronoiId?e.push(t.lSite.voronoiId):null!==t.rSite&&t.rSite.voronoiId!=this.site.voronoiId&&e.push(t.rSite.voronoiId);return e},Voronoi.prototype.Cell.prototype.getBbox=function(){for(var t,e,i=this.halfedges,r=i.length,o=1/0,a=1/0,s=-1/0,n=-1/0;r--;)(t=(e=i[r].getStartpoint()).x)<o&&(o=t),(e=e.y)<a&&(a=e),s<t&&(s=t),n<e&&(n=e);return{x:o,y:a,width:s-o,height:n-a}},Voronoi.prototype.Cell.prototype.pointIntersection=function(t,e){for(var i,r,o=this.halfedges,a=o.length;a--;){if(r=(i=o[a]).getStartpoint(),i=i.getEndpoint(),!(r=(e-r.y)*(i.x-r.x)-(t-r.x)*(i.y-r.y)))return 0;if(0<r)return-1}return 1},Voronoi.prototype.Vertex=function(t,e){this.x=t,this.y=e},Voronoi.prototype.Edge=function(t,e){this.lSite=t,this.rSite=e,this.va=this.vb=null},Voronoi.prototype.Halfedge=function(t,e,i){var r;this.site=e,this.edge=t,i?this.angle=Math.atan2(i.y-e.y,i.x-e.x):(r=t.va,i=t.vb,this.angle=t.lSite===e?Math.atan2(i.x-r.x,r.y-i.y):Math.atan2(r.x-i.x,i.y-r.y))},Voronoi.prototype.createHalfedge=function(t,e,i){return new this.Halfedge(t,e,i)},Voronoi.prototype.Halfedge.prototype.getStartpoint=function(){return this.edge.lSite===this.site?this.edge.va:this.edge.vb},Voronoi.prototype.Halfedge.prototype.getEndpoint=function(){return this.edge.lSite===this.site?this.edge.vb:this.edge.va},Voronoi.prototype.createVertex=function(t,e){var i=this.vertexJunkyard.pop();return i?(i.x=t,i.y=e):i=new this.Vertex(t,e),this.vertices.push(i),i},Voronoi.prototype.createEdge=function(t,e,i,r){var o=this.edgeJunkyard.pop();return o?(o.lSite=t,o.rSite=e,o.va=o.vb=null):o=new this.Edge(t,e),this.edges.push(o),i&&this.setEdgeStartpoint(o,t,e,i),r&&this.setEdgeEndpoint(o,t,e,r),this.cells[t.voronoiId].halfedges.push(this.createHalfedge(o,t,e)),this.cells[e.voronoiId].halfedges.push(this.createHalfedge(o,e,t)),o},Voronoi.prototype.createBorderEdge=function(t,e,i){var r=this.edgeJunkyard.pop();return r?(r.lSite=t,r.rSite=null):r=new this.Edge(t,null),r.va=e,r.vb=i,this.edges.push(r),r},Voronoi.prototype.setEdgeStartpoint=function(t,e,i,r){t.va||t.vb?t.lSite===i?t.vb=r:t.va=r:(t.va=r,t.lSite=e,t.rSite=i)},Voronoi.prototype.setEdgeEndpoint=function(t,e,i,r){this.setEdgeStartpoint(t,i,e,r)},Voronoi.prototype.Beachsection=function(){},Voronoi.prototype.createBeachsection=function(t){var e=this.beachsectionJunkyard.pop();return(e=e||new this.Beachsection).site=t,e},Voronoi.prototype.leftBreakPoint=function(t,e){var i=t.site,r=i.x,o=i.y,a=o-e;if(!a)return r;var s=t.rbPrevious;if(!s)return-1/0;var n=(i=s.site).x,h=i.y,t=h-e;if(!t)return n;s=n-r,i=1/a-1/t,e=s/t;return i?(-e+this.sqrt(e*e-2*i*(s*s/(-2*t)-h+t/2+o-a/2)))/i+r:(r+n)/2},Voronoi.prototype.rightBreakPoint=function(t,e){var i=t.rbNext;if(i)return this.leftBreakPoint(i,e);t=t.site;return t.y===e?t.x:1/0},Voronoi.prototype.detachBeachsection=function(t){this.detachCircleEvent(t),this.beachline.rbRemoveNode(t),this.beachsectionJunkyard.push(t)},Voronoi.prototype.removeBeachsection=function(t){var e=t.circleEvent,i=e.x,r=e.ycenter,o=this.createVertex(i,r),a=t.rbPrevious,s=t.rbNext,n=[t],h=Math.abs;this.detachBeachsection(t);for(var l=a;l.circleEvent&&h(i-l.circleEvent.x)<1e-9&&h(r-l.circleEvent.ycenter)<1e-9;)a=l.rbPrevious,n.unshift(l),this.detachBeachsection(l),l=a;n.unshift(l),this.detachCircleEvent(l);for(var c=s;c.circleEvent&&h(i-c.circleEvent.x)<1e-9&&h(r-c.circleEvent.ycenter)<1e-9;)s=c.rbNext,n.push(c),this.detachBeachsection(c),c=s;n.push(c),this.detachCircleEvent(c);for(var p=n.length,d=1;d<p;d++)c=n[d],l=n[d-1],this.setEdgeStartpoint(c.edge,l.site,c.site,o);l=n[0],(c=n[p-1]).edge=this.createEdge(l.site,c.site,void 0,o),this.attachCircleEvent(l),this.attachCircleEvent(c)},Voronoi.prototype.addBeachsection=function(t){for(var e,i,r,o,a=t.x,s=t.y,n=this.beachline.root;n;)if(1e-9<(r=this.leftBreakPoint(n,s)-a))n=n.rbLeft;else{if(!(1e-9<(o=a-this.rightBreakPoint(n,s)))){-1e-9<r?(e=n.rbPrevious,i=n):-1e-9<o?i=(e=n).rbNext:e=i=n;break}if(!n.rbRight){e=n;break}n=n.rbRight}var h,l,c,p,d,u,g,f,y,b,m=this.createBeachsection(t);if(this.beachline.rbInsertSuccessor(e,m),e||i){if(e===i)return this.detachCircleEvent(e),i=this.createBeachsection(e.site),this.beachline.rbInsertSuccessor(m,i),m.edge=i.edge=this.createEdge(e.site,m.site),this.attachCircleEvent(e),void this.attachCircleEvent(i);!e||i?e!==i&&(this.detachCircleEvent(e),this.detachCircleEvent(i),l=(h=e.site).x,b=h.y,c=t.x-l,g=t.y-b,d=(p=i.site).x-l,u=p.y-b,b=this.createVertex((u*(f=c*c+g*g)-g*(y=d*d+u*u))/(g=2*(c*u-g*d))+l,(c*y-d*f)/g+b),this.setEdgeStartpoint(i.edge,h,p,b),m.edge=this.createEdge(h,t,void 0,b),i.edge=this.createEdge(t,p,void 0,b),this.attachCircleEvent(e),this.attachCircleEvent(i)):m.edge=this.createEdge(e.site,m.site)}},Voronoi.prototype.CircleEvent=function(){this.arc=null,this.rbLeft=null,this.rbNext=null,this.rbParent=null,this.rbPrevious=null,this.rbRed=!1,this.rbRight=null,this.site=null,this.x=this.y=this.ycenter=0},Voronoi.prototype.attachCircleEvent=function(t){var e=t.rbPrevious,i=t.rbNext;if(e&&i){var r=e.site,o=t.site,a=i.site;if(r!==a){var s=o.x,n=o.y,h=r.x-s,l=r.y-n,c=a.x-s,e=a.y-n,i=2*(h*e-l*c);if(!(-2e-12<=i)){var r=h*h+l*l,a=c*c+e*e,l=(e*r-l*a)/i,i=(h*a-c*r)/i,n=i+n,p=this.circleEventJunkyard.pop();(p=p||new this.CircleEvent).arc=t,p.site=o,p.x=l+s,p.y=n+this.sqrt(l*l+i*i),p.ycenter=n,t.circleEvent=p;for(var d=null,u=this.circleEvents.root;u;)if(p.y<u.y||p.y===u.y&&p.x<=u.x){if(!u.rbLeft){d=u.rbPrevious;break}u=u.rbLeft}else{if(!u.rbRight){d=u;break}u=u.rbRight}this.circleEvents.rbInsertSuccessor(d,p),d||(this.firstCircleEvent=p)}}}},Voronoi.prototype.detachCircleEvent=function(t){var e=t.circleEvent;e&&(e.rbPrevious||(this.firstCircleEvent=e.rbNext),this.circleEvents.rbRemoveNode(e),this.circleEventJunkyard.push(e),t.circleEvent=null)},Voronoi.prototype.connectEdge=function(t,e){var i=t.vb;if(i)return!0;var r,o,a=t.va,s=e.xl,n=e.xr,h=e.yt,l=e.yb,c=t.lSite,p=t.rSite,d=c.x,u=c.y,g=p.x,f=p.y,y=(d+g)/2,e=(u+f)/2;if(this.cells[c.voronoiId].closeMe=!0,this.cells[p.voronoiId].closeMe=!0,f!==u&&(o=e-(r=(d-g)/(f-u))*y),void 0===r){if(y<s||n<=y)return!1;if(g<d){if(!a||a.y<h)a=this.createVertex(y,h);else if(a.y>=l)return!1;i=this.createVertex(y,l)}else{if(!a||a.y>l)a=this.createVertex(y,l);else if(a.y<h)return!1;i=this.createVertex(y,h)}}else if(r<-1||1<r)if(g<d){if(!a||a.y<h)a=this.createVertex((h-o)/r,h);else if(a.y>=l)return!1;i=this.createVertex((l-o)/r,l)}else{if(!a||a.y>l)a=this.createVertex((l-o)/r,l);else if(a.y<h)return!1;i=this.createVertex((h-o)/r,h)}else if(u<f){if(!a||a.x<s)a=this.createVertex(s,r*s+o);else if(a.x>=n)return!1;i=this.createVertex(n,r*n+o)}else{if(!a||a.x>n)a=this.createVertex(n,r*n+o);else if(a.x<s)return!1;i=this.createVertex(s,r*s+o)}return t.va=a,t.vb=i,!0},Voronoi.prototype.clipEdge=function(t,e){var i=t.va.x,r=t.va.y,o=0,a=1,s=t.vb.x-i,n=t.vb.y-r,h=i-e.xl;if(0==s&&h<0)return!1;var l=-h/s;if(s<0){if(l<o)return!1;l<a&&(a=l)}else if(0<s){if(a<l)return!1;o<l&&(o=l)}if(h=e.xr-i,0==s&&h<0)return!1;if(l=h/s,s<0){if(a<l)return!1;o<l&&(o=l)}else if(0<s){if(l<o)return!1;l<a&&(a=l)}if(h=r-e.yt,0==n&&h<0)return!1;if(l=-h/n,n<0){if(l<o)return!1;l<a&&(a=l)}else if(0<n){if(a<l)return!1;o<l&&(o=l)}if(h=e.yb-r,0==n&&h<0)return!1;if(l=h/n,n<0){if(a<l)return!1;o<l&&(o=l)}else if(0<n){if(l<o)return!1;l<a&&(a=l)}return 0<o&&(t.va=this.createVertex(i+o*s,r+o*n)),a<1&&(t.vb=this.createVertex(i+a*s,r+a*n)),(0<o||a<1)&&(this.cells[t.lSite.voronoiId].closeMe=!0,this.cells[t.rSite.voronoiId].closeMe=!0),!0},Voronoi.prototype.clipEdges=function(t){for(var e,i=this.edges,r=i.length,o=Math.abs;r--;)e=i[r],this.connectEdge(e,t)&&this.clipEdge(e,t)&&!(o(e.va.x-e.vb.x)<1e-9&&o(e.va.y-e.vb.y)<1e-9)||(e.va=e.vb=null,i.splice(r,1))},Voronoi.prototype.closeCells=function(t){for(var e,i,r,o,a,s,n,h,l,c=t.xl,p=t.xr,d=t.yt,u=t.yb,g=this.cells,f=g.length,y=Math.abs;f--;)if((e=g[f]).prepareHalfedges()&&e.closeMe){for(o=(r=e.halfedges).length,i=0;i<o;){if(s=r[i].getEndpoint(),h=r[(i+1)%o].getStartpoint(),1e-9<=y(s.x-h.x)||1e-9<=y(s.y-h.y))switch(!0){case this.equalWithEpsilon(s.x,c)&&this.lessThanWithEpsilon(s.y,u):if(l=this.equalWithEpsilon(h.x,c),n=this.createVertex(c,l?h.y:u),a=this.createBorderEdge(e.site,s,n),i++,r.splice(i,0,this.createHalfedge(a,e.site,null)),o++,l)break;s=n;case this.equalWithEpsilon(s.y,u)&&this.lessThanWithEpsilon(s.x,p):if(l=this.equalWithEpsilon(h.y,u),n=this.createVertex(l?h.x:p,u),a=this.createBorderEdge(e.site,s,n),i++,r.splice(i,0,this.createHalfedge(a,e.site,null)),o++,l)break;s=n;case this.equalWithEpsilon(s.x,p)&&this.greaterThanWithEpsilon(s.y,d):if(l=this.equalWithEpsilon(h.x,p),n=this.createVertex(p,l?h.y:d),a=this.createBorderEdge(e.site,s,n),i++,r.splice(i,0,this.createHalfedge(a,e.site,null)),o++,l)break;s=n;case this.equalWithEpsilon(s.y,d)&&this.greaterThanWithEpsilon(s.x,c):if(l=this.equalWithEpsilon(h.y,d),n=this.createVertex(l?h.x:c,d),a=this.createBorderEdge(e.site,s,n),i++,r.splice(i,0,this.createHalfedge(a,e.site,null)),o++,l)break;if(s=n,l=this.equalWithEpsilon(h.x,c),n=this.createVertex(c,l?h.y:u),a=this.createBorderEdge(e.site,s,n),i++,r.splice(i,0,this.createHalfedge(a,e.site,null)),o++,l)break;if(s=n,l=this.equalWithEpsilon(h.y,u),n=this.createVertex(l?h.x:p,u),a=this.createBorderEdge(e.site,s,n),i++,r.splice(i,0,this.createHalfedge(a,e.site,null)),o++,l)break;if(s=n,l=this.equalWithEpsilon(h.x,p),n=this.createVertex(p,l?h.y:d),a=this.createBorderEdge(e.site,s,n),i++,r.splice(i,0,this.createHalfedge(a,e.site,null)),o++,l)break;default:throw"Voronoi.closeCells() > this makes no sense!"}i++}e.closeMe=!1}},Voronoi.prototype.quantizeSites=function(t){for(var e,i=this.ε,r=t.length;r--;)(e=t[r]).x=Math.floor(e.x/i)*i,e.y=Math.floor(e.y/i)*i},Voronoi.prototype.recycle=function(t){if(t){if(!(t instanceof this.Diagram))throw"Voronoi.recycleDiagram() > Need a Diagram object.";this.toRecycle=t}},Voronoi.prototype.compute=function(t,e){var i=new Date;this.reset(),this.toRecycle&&(this.vertexJunkyard=this.vertexJunkyard.concat(this.toRecycle.vertices),this.edgeJunkyard=this.edgeJunkyard.concat(this.toRecycle.edges),this.cellJunkyard=this.cellJunkyard.concat(this.toRecycle.cells),this.toRecycle=null);var r=t.slice(0);r.sort(function(t,e){var i=e.y-t.y;return i||e.x-t.x});for(var o,a,s,n=r.pop(),h=0,l=this.cells;;)if(s=this.firstCircleEvent,n&&(!s||n.y<s.y||n.y===s.y&&n.x<s.x))n.x===o&&n.y===a||(l[h]=this.createCell(n),n.voronoiId=h++,this.addBeachsection(n),a=n.y,o=n.x),n=r.pop();else{if(!s)break;this.removeBeachsection(s.arc)}this.clipEdges(e),this.closeCells(e);t=new Date,e=new this.Diagram;return e.cells=this.cells,e.edges=this.edges,e.vertices=this.vertices,e.execTime=t.getTime()-i.getTime(),this.reset(),e},"undefined"!=typeof module&&(module.exports=Voronoi),p5Viz.voronoiflowerVars=function(i){i.voronoiHue=255*Math.random(),i.voronoi=new Voronoi,i.voronoiBounds={xl:1,xr:i.width-1,yt:1,yb:i.height-1},i.voronoiBobs=[];for(let e=0;e<600;e++){let t=p5.Vector.random2D();t.mult(Math.random()*Math.max(i.width,i.height)/4),t.add(i.width/2,i.height/2),i.voronoiBobs[e]=new i.Bob(t.x,t.y,i)}},p5Viz.Bob=function(t,e,o){this.pos=new p5.Vector(t,e),this.vel=p5.Vector.random2D(),this.acc=new p5.Vector(0,0),this.target=new p5.Vector(t,e),this.move=function(e,t){this.vel.mult(.95);var i=o.dist(this.pos.x,this.pos.y,this.target.x,this.target.y);let r=i<50?i/50:1;if(1<i){let t=new p5.Vector(this.target.x,this.target.y);t.sub(this.pos),t.normalize(),t.mult(r),this.acc.add(t)}if(t<e){e=o.dist(this.pos.x,this.pos.y,o.width/2,o.height/2);let t=new p5.Vector(this.pos.x,this.pos.y);t.sub(new p5.Vector(o.width/2,o.height/2)),t.normalize(),t.mult(5/e*50),this.acc.add(t)}this.vel.limit(5),this.vel.add(this.acc),this.pos.add(this.vel),this.acc.mult(0)}},p5Viz.voronoiflower=function(i){i.mountaineering=!1,i.spoolingKeratin=!1,i.softspikyT=!1,i.vinylMode=!1,i.colorMode(i.HSB,255,255,255,255);var t=i.amp.getLevel();let e=0;null!=t&&(e=2*t);var r=i.map(Math.sin(.05*i.frameCount),-1,1,.01,.5);i.clear();for(let t=0;t<i.voronoiBobs.length;t++)i.voronoiBobs[t].move(e,r);let o=[];for(let t=0;t<i.voronoiBobs.length;t++){var a=(i.voronoiHue+10*i.voronoiBobs[t].vel.mag())%255,s=20*i.voronoiBobs[t].vel.mag();o.push({x:i.voronoiBobs[t].pos.x,y:i.voronoiBobs[t].pos.y,color:i.color(a,200,200,s)})}i.voronoi.recycle(i.diagram),i.diagram=i.voronoi.compute(o,i.voronoiBounds);for(let e=0;e<i.diagram.cells.length;e++)if(i.diagram.cells[e].halfedges.length){i.rainbow?(i.stroke(127),i.strokeWeight(.1)):i.noStroke(),i.fill(i.diagram.cells[e].site.color),i.beginShape();for(let t=0;t<i.diagram.cells[e].halfedges.length;t++){var n=i.diagram.cells[e].halfedges[t].getStartpoint();i.vertex(n.x,n.y)}i.endShape(i.CLOSE)}for(let t=0;t<i.voronoiBobs.length;t++)i.rainbow?(i.stroke(255,100),i.strokeWeight(3)):(i.stroke(i.voronoiHue,255,255,5*i.voronoiBobs[t].vel.mag()),i.strokeWeight(1.5*i.voronoiBobs[t].vel.mag())),i.point(i.voronoiBobs[t].pos.x,i.voronoiBobs[t].pos.y);i.voronoiHue=(i.voronoiHue+1)%255},p5Viz.waveit=function(e){e.mountaineering=!1,e.spoolingKeratin=!1,e.softspikyT=!1,e.vinylMode=!1,e.ctx.save(),e.ctx.shadowBlur=10,e.ctx.shadowColor="white",e.clear(),e.fft.analyze();var i=e.fft.waveform();e.strokeWeight(8),e.colorMode(e.HSB,360,100,100,100),1==e.rainbow?e.stroke(e.frameCount%361,100,100,100):e.stroke(2*Math.abs(180-e.frameCount%361),100),e.noFill(),e.beginShape();for(let t=0;t<i.length;t+=4)e.vertex(e.map(t,0,i.length,0,e.width),e.map(i[t],-1,1,.1*e.height,.9*e.height));e.endShape(),e.ctx.restore()},p5Viz.wonkyCloudBallsVars=function(t){let e=[0,0];for(t.colorMode(t.RGB,255,255,255,255),t.redcloud=t.createImage(255,255),t.greencloud=t.createImage(255,255),t.bluecloud=t.createImage(255,255),t.redcloud.loadPixels(),t.greencloud.loadPixels(),t.bluecloud.loadPixels(),e[0]=0;e[0]<255;e[0]+=1)for(e[1]=0;e[1]<255;e[1]+=1){var i=4*t.dist(e[1],e[0],127.5,127.5);i<255&&(t.redcloud.set(e[0],e[1],t.color(2*i,i,i,255-i)),t.greencloud.set(e[0],e[1],t.color(i,2*i,i,255-i)),t.bluecloud.set(e[0],e[1],t.color(i,i,2*i,255-i)))}t.redcloud.updatePixels(),t.greencloud.updatePixels(),t.bluecloud.updatePixels()},p5Viz.wonkyCloudBalls=function(r){r.imageMode(r.CENTER),r.clear(),r.translate(r.width/2,r.height/2);var o=r.fft.analyze();for(let i=0;i<640;i+=16){var a=(1-o[i]/255)**3,s=a*r.width/2,n=a*r.height/2,h=r.frameCount/100,a=2*Math.PI*r.noise(i,h);let t={},e={};t.r=r.noise(1e3,h)*a,t.g=r.noise(2e3,h)*a,t.b=r.noise(3e3,h)*a,e.r=r.noise(11e3,h)*a,e.g=r.noise(12e3,h)*a,e.b=r.noise(13e3,h)*a,r.image(r.redcloud,s*Math.cos(t.r),n*Math.cos(e.r)),r.image(r.greencloud,s*Math.cos(t.g),n*Math.cos(e.g)),r.image(r.bluecloud,s*Math.cos(t.b),n*Math.cos(e.b))}if(!r.rainbow){let t=r.get();t.filter(r.GRAY),r.image(t,0,0)}r.imageMode(r.CORNER)},p5Viz.xponentialScapeVars=function(t){t.xpLand=t.createGraphics(100,100)},p5Viz.xponentialScape=function(i){i.mountaineering=!1,i.softspikyT=!1,i.spoolingKeratin=!1,i.vinylMode=!1;var r=i.fft.analyze().sort(function(t,e){return e-t})[300]/255;i.clear(),i.xpLand.clear(),i.noiseSeed(3),i.xpLand.colorMode(i.HSB,360,100,100,100),i.xpLand.strokeCap(i.SQUARE),i.xpLand.strokeWeight(2);for(let e=0;e<=i.xpLand.width;e+=2)for(let t=0;t<=i.xpLand.height;t+=2){var o=i.frameCount/100,a=i.noise(e/100,t/100,o)+i.noise(e/50,t/50,o)+i.noise(e/10,t/10,o),a=Math.exp(-Math.pow(a,2))/Math.exp(1),o=360*i.noise(e/50,t/50,o)*r;i.xpLand.stroke(o,100,10+90*a,100),i.xpLand.line(e,t,e,t-10-90*a)}if(i.rainbow)i.image(i.xpLand,0,0,i.width,i.height);else{let t=i.xpLand.get();t.filter(i.GRAY),i.image(t,0,0,i.width,i.height)}i.noiseSeed(i.millis())},p5Viz.zeotropeVars=function(e){e.gph.colorMode(e.HSB,42,100,84,100),e.gphcam=e.gph.createCamera(),e.gph.noStroke(),e.gphcam.setPosition(0,-500,1080),e.gphcam.lookAt(0,0,0);let i=e.createGraphics(500,500);e.zeosprites=[];for(let t=0;t<42;t++)i.clear(),i.tint(e.gph.color(t,100,100,90)),i.image(e.dancerAnimn[t%14],0,0,500,500),e.zeosprites.push(i.get())},p5Viz.zeotrope=function(e){e.mountaineering=!1,e.spoolingKeratin=!1,e.softspikyT=!1,e.vinylMode=!1,e.clear(),e.frameRate(60),e.gph.colorMode(e.HSB,42,100,84,100),e.gph.clear();var i=1e3*+Math.PI/42;let r=0;var o=e.fft.analyze();for(let t=0;t<42;t++){e.gph.push();var a=(Math.floor(e.frameCount/2)+t)%42,s=Math.log(256-o[3*a])/Math.log(16),s=1e3*+Math.PI/42+200*(8-s*s*s)/8,n=500*e.cos(r),h=500*e.sin(r);e.gph.translate(n,-100-s/2,h),e.gph.fill(a,100,84,90),e.gph.box(i,s,i),e.gph.texture(e.zeosprites[a]),e.gph.translate(0,s/2+i/2,0),e.gph.box(i),r+=360/42,e.gph.pop()}e.noTint(),e.rainbow?e.image(e.gph,0,0,e.width,e.height):(e.grayScale.clear(),e.grayScale.image(e.gph,0,0,e.width,e.height),e.grayScale.filter(e.GRAY),e.image(e.grayScale,0,0,e.width,e.height))};